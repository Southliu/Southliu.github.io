{"version":3,"file":"page_login_index.ae5a6c0d.js","sources":["../../../src/pages/login/index.tsx"],"sourcesContent":["import type { ILoginData } from './model'\nimport type { FormProps } from 'antd'\nimport type { AppDispatch, RootState } from '@/stores'\nimport type { IThemeType } from '@/stores/public'\nimport { message } from 'antd'\nimport { setThemeValue } from '@/stores/public'\nimport { Form, Button, Input } from 'antd'\nimport { useEffect, useState } from 'react'\nimport { PASSWORD_RULE, THEME_KEY } from '@/utils/config'\nimport { UserOutlined, LockOutlined } from '@ant-design/icons'\nimport { login } from '@/servers/login'\nimport { useTitle } from '@/hooks/useTitle'\nimport { useToken } from '@/hooks/useToken'\nimport { useDispatch, useSelector } from 'react-redux'\nimport { useNavigate } from 'react-router-dom'\nimport { setPermissions, setUserInfo } from '@/stores/user'\nimport { permissionsToArray } from '@/utils/permissions'\nimport { getFirstMenu } from '@/menus/utils/helper'\nimport { defaultMenus } from '@/menus'\nimport Logo from '@/assets/images/logo.svg'\n\nfunction Login() {\n  useTitle('登录')\n  const navigate = useNavigate()\n  const dispatch: AppDispatch = useDispatch()\n  const [getToken, setToken] = useToken()\n  const [isLoading, setLoading] = useState(false)\n  const permissions = useSelector((state: RootState) => state.user.permissions)\n  const themeCache = (localStorage.getItem(THEME_KEY) || 'light') as IThemeType\n\n  useEffect(() => {\n    if (!themeCache) {\n      localStorage.setItem(THEME_KEY, 'light')\n    }\n    if (themeCache === 'dark') {\n      document.body.className = 'theme-dark'\n    }\n    dispatch(setThemeValue(themeCache === 'dark' ? 'dark' : 'light'))\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [themeCache])\n\n  useEffect(() => {\n    // 如果存在token，则直接进入页面\n    if (getToken()) {\n      const firstMenu = getFirstMenu(defaultMenus, permissions)\n      navigate(firstMenu)\n    } \n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  /**\n   * 处理登录\n   * @param values - 表单数据\n   */\n  const handleFinish: FormProps['onFinish'] = async (values: ILoginData) => {\n    try {\n      setLoading(true)\n      const { data } = await login(values)\n      const { data: { token, user, permissions } } = data\n\n      if (!permissions?.length || !token) {\n        return message.error({ content: '用户暂无权限登录', key: 'permissions' })\n      }\n\n      const newPermissions = permissionsToArray(permissions)\n      const firstMenu = getFirstMenu(defaultMenus, newPermissions)\n      setToken(token)\n      dispatch(setUserInfo(user))\n      dispatch(setPermissions(newPermissions))\n      navigate(firstMenu)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  /**\n   * 处理失败\n   * @param errors - 错误信息\n   */\n  const handleFinishFailed: FormProps['onFinishFailed'] = errors => {\n    console.error('错误信息:', errors)\n  }\n\n  return (\n    <>\n      <div className={`\n        ${themeCache === 'dark' ? 'bg-black text-white' : 'bg-light-400'}\n        w-screen\n        h-screen\n        relative\n      `}>\n        <div className={`\n          w-300px\n          h-290px\n          p-30px\n          rounded-5px\n          ${themeCache === 'dark' ? 'bg-black bg-dark-200' : 'bg-white'}\n          box-border\n          absolute\n          left-1/2\n          top-1/2\n          -translate-x-1/2\n          -translate-y-1/2\n        `}>\n         <div className=\"pb-30px pt-10px flex items-center justify-center\">\n            <img\n              className=\"mr-2 object-contain\"\n              width=\"30\"\n              height=\"30\"\n              src={Logo}\n              alt=\"LOGO\"\n            />\n            <span className=\"text-xl font-bold tracking-2px\">系统登录</span>\n          </div>\n          <Form\n            name=\"horizontal_login\"\n            autoComplete=\"on\"\n            onFinish={handleFinish}\n            onFinishFailed={handleFinishFailed}\n            initialValues={{\n              username: 'admin',\n              password: 'admin123456'\n            }}\n          >\n            <Form.Item\n              name=\"username\"\n              rules={[{ required: true, message: '请输入用户名' }]}\n            >\n              <Input\n                allow-clear=\"true\"\n                placeholder=\"用户名\"\n                data-test=\"username\"\n                autoComplete=\"username\"\n                addonBefore={<UserOutlined className='change' />}\n              />\n            </Form.Item>\n\n            <Form.Item\n              name=\"password\"\n              rules={[\n                { required: true, message: '请输入密码' },\n                PASSWORD_RULE\n              ]}\n            >\n              <Input.Password\n                placeholder=\"密码\"\n                autoComplete=\"current-password\"\n                addonBefore={<LockOutlined className='change' />}\n              />\n            </Form.Item>\n\n            <Form.Item>\n              <Button\n                type=\"primary\"\n                htmlType=\"submit\"\n                className=\"w-full mt-5px rounded-5px tracking-2px\"\n                loading={isLoading}\n              >\n                登录\n              </Button>\n            </Form.Item>\n          </Form>\n        </div>\n      </div>\n    </>\n  )\n}\n\nexport default Login"],"names":["Login","useTitle","navigate","useNavigate","dispatch","useDispatch","getToken","setToken","useToken","isLoading","setLoading","useState","permissions","useSelector","state","themeCache","THEME_KEY","useEffect","setThemeValue","firstMenu","getFirstMenu","defaultMenus","jsx","Fragment","jsxs","Logo","Form","values","data","login","token","user","message","newPermissions","permissionsToArray","setUserInfo","setPermissions","errors","Input","UserOutlined","PASSWORD_RULE","LockOutlined","Button"],"mappings":"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"}