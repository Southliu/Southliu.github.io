import{r as e,j as t}from"./react@18.3.1.B8wSySjr.js";import{w as l}from"./index.DADN55vA.js";import{R as r}from"./react-resizable@3.0.5_react-dom@18.3.1_react@18.3.1.Au7ZTFm0.js";import{a as o}from"./ahooks@3.7.11_react@18.3.1.Bv9dpIj3.js";import{w as n,p as s,x as i,c as a,s as c,S as d,y as u}from"./antd@5.20.2_react-dom@18.3.1_react@18.3.1.DlBlFBZr.js";import{o as h,p,e as g}from"./@ant-design_icons@5.3.7_react-dom@18.3.1_react@18.3.1.BlZw1_ee.js";import{u as m}from"./react-i18next@14.1.1_i18next@23.11.4_react-dom@18.3.1_react@18.3.1.DJVsM5yd.js";function f(e){switch(e){case"large":return 54;case"middle":return 46;default:return 38}}function v(e){for(let t=0;t<e.length;t++){const r=e[t];void 0===r.ellipsis&&(r.ellipsis=!0),r.render||(r.render=e=>e||(0===e?e:l))}return e}function x(e){const{onResize:l,width:o,...n}=e;return o?t.jsx(r,{width:o,height:0,handle:t.jsx("span",{className:"react-resizable-handle",onClick:e=>{e.stopPropagation()}}),onResize:l,draggableOpts:{enableUserSelectHack:!1},children:t.jsx("th",{...n})}):t.jsx("th",{...n})}function b(e,t){switch(t.type){case"changeScroll":let l=t.curScrollTop||0,r=t.scrollHeight||0;const o=t.tableScrollY||0;return r<=0&&(r=0),0!==r&&o===e.tableScrollY&&(r=e.scrollHeight),e.scrollHeight&&l>e.scrollHeight&&(l=e.scrollHeight),{...e,curScrollTop:l,scrollHeight:r,tableScrollY:o};case"reset":return{...e,curScrollTop:0,scrollHeight:0};default:throw new Error("表格：未知错误类型!")}}function w(e){return"number"==typeof e&&isFinite(e)}const j=e.createContext({dispatch:void 0,renderLen:1,start:0,offsetStart:0,rowHeight:46,totalLen:0});function H(l){const{children:r,...o}=l,{renderLen:n,start:s,offsetStart:i}=e.useContext(j);let a=null;if(r&&null!==r){const e=null==r?void 0:r[1];a=Array.isArray(e)&&e.length?[null==r?void 0:r[0],e.slice(s,s+n).map((e=>Array.isArray(e)?e[0]:e))]:r}return t.jsx("tbody",{...o,style:{transform:`translateY(-${i}px)`},children:a})}const y={rowHeight:38,curScrollTop:0,scrollHeight:0,tableScrollY:0};let S=0;function N(l){var r,n,s,i,a;const{style:c,children:d,...u}=l,{width:h,...p}=c,[g,m]=e.useReducer(b,y),f=e.useRef(null),v=e.useRef(null),[x,H]=e.useState((null==(s=null==(n=null==(r=null==d?void 0:d[2])?void 0:r.props)?void 0:n.data)?void 0:s.length)??0);e.useEffect((()=>{var e,t,l,r,o,n;w(null==(l=null==(t=null==(e=null==d?void 0:d[1])?void 0:e.props)?void 0:t.data)?void 0:l.length)&&H(null==(n=null==(o=null==(r=null==d?void 0:d[1])?void 0:r.props)?void 0:o.data)?void 0:n.length)}),[d]);const N=e.useMemo((()=>{let e="auto";return g.rowHeight&&x&&(e=g.rowHeight*x),e}),[g.rowHeight,x]);let C=0;C="string"==typeof S?null==(a=null==(i=f.current)?void 0:i.parentNode)?void 0:a.offsetHeight:S,w(N)&&Number(N)<C&&(C=N),C<=0&&(C=0);const T=e.useMemo((()=>{let e=1;if(g.rowHeight&&x&&C)if(C<=0)e=0;else{const t=5+(C/g.rowHeight|0);e=t>x?x:t}return e}),[g.rowHeight,x,C]);let z=g.rowHeight?g.curScrollTop/g.rowHeight|0:0,k=g.rowHeight?g.curScrollTop%g.rowHeight:0;g.curScrollTop&&g.rowHeight&&g.curScrollTop>g.rowHeight?z>x-T?k=0:z>1&&(z-=1,k+=g.rowHeight):z=0,e.useEffect((()=>{var e;const t=null==(e=f.current)?void 0:e.parentNode;t&&(t.scrollTop=0),m({type:"reset"})}),[x]);const E=o((e=>{var t,l;const r=(null==(t=null==e?void 0:e.target)?void 0:t.scrollTop)??0;if(r!==g.curScrollTop){const t=(null==(l=null==e?void 0:e.target)?void 0:l.scrollHeight)-C;m({type:"changeScroll",curScrollTop:r,scrollHeight:t,tableScrollY:C})}}),{wait:60});return e.useEffect((()=>{var e;const t=null==(e=null==f?void 0:f.current)?void 0:e.parentNode;return t&&t.addEventListener("scroll",(e=>E.run(e))),()=>{t.removeEventListener("scroll",(e=>E.run(e)))}}),[f,g.curScrollTop,C,g.scrollHeight,E]),t.jsx("div",{className:"virtualTable",ref:f,style:{width:"100%",position:"relative",height:N,boxSizing:"border-box",paddingTop:g.curScrollTop},children:t.jsx(j.Provider,{value:{dispatch:m,rowHeight:g.rowHeight,start:z,offsetStart:k,renderLen:T,totalLen:x},children:t.jsx("table",{...u,ref:v,style:{...p,width:h,position:"relative"},children:d})})})}function C(l){const{columns:r,className:o,getTableChecks:c}=l,[d,u]=e.useState(!1),[p,g]=e.useState([]),[m,f]=e.useState([]),v={...l};delete v.getTableChecks,e.useEffect((()=>{b(r)}),[r]);const x=()=>{u(!d)},b=e=>{if(!(null==e?void 0:e.length))return[];const t=[],l=[];for(let r=0;r<(null==e?void 0:e.length);r++){const o=e[r],{dataIndex:n}=o;!o.hidden&&n&&(null==l||l.push(n)),t.push({label:o.title,value:n})}g(t),f(l)},w=e=>{f(e)},j=()=>{x(),c(m)};return t.jsx(n,{content:()=>t.jsxs("div",{className:"min-w-130px",children:[t.jsx(s.Group,{className:"flex flex-col !px-12px",value:m,onChange:w,children:null==p?void 0:p.map((e=>t.jsx("div",{children:t.jsx(s,{value:e.value,children:e.label})},e.value)))}),t.jsx(i,{className:"!mt-10px !mb-5px"}),t.jsxs("div",{className:"flex justify-end px-10px",children:[t.jsx(a,{size:"small",className:"mr-5px",onClick:x,children:"取消"}),t.jsx(a,{type:"primary",size:"small",onClick:j,children:"筛选"})]})]}),trigger:"click",placement:"bottom",overlayInnerStyle:{padding:"12px 0 10px"},open:d,onOpenChange:x,children:t.jsx("div",{...v,className:`${o} inline-block cursor-pointer`,children:t.jsx(h,{})})})}function T(l){const{isLoading:r,isVirtual:o,isCreate:n,isZebra:s=!0,isBordered:i=!0,isOperate:h=!0,scrollX:b,scrollY:w,rowClassName:j,size:T,leftContent:z,rightContent:k,getPage:E,onCreate:R}=l,{t:_}=m(),[L]=function(){const[t,l]=e.useState(!0);return[(e,r)=>{if(!(null==r?void 0:r.length)||!(null==e?void 0:e.length))return e||[];if(t)return l(!1),e||[];for(let t=0;t<(null==e?void 0:e.length);t++){const l=e[t];l.hidden=!r.includes(l.dataIndex)}return e}]}(),[Y,$]=e.useState(v(l.columns)),B=e.useRef(null),[A,I]=e.useState([]);e.useEffect((()=>{$(v(l.columns))}),[l.columns]),e.useEffect((()=>{n&&!R&&c.warning(_("public.createMethodWarning"))}),[n]),e.useEffect((()=>{h&&!E&&c.warning(_("public.getPageWarning"))}),[E]);const M=function(e){var t,l;const r=document.documentElement.clientHeight||document.body.clientHeight,o=(null==(l=null==(t=null==e?void 0:e.getBoundingClientRect)?void 0:t.call(e))?void 0:l.top)||0,n=document.getElementById("pagination"),s=r-o-((null==n?void 0:n.offsetHeight)||0);return s>0?s-65:450}(B.current),P=e=>(t,{size:l})=>{const r=[...Y];r[e]={...r[e],width:l.width},$(r)},O=function(e){const{height:t,size:l}=e;return S=t,y.rowHeight=f(l),{table:N,body:{wrapper:H}}}({height:M,size:T||"small"}),K=e.useMemo((()=>({header:{cell:x},body:{wrapper:O.body.wrapper},table:O.table})),[O]),W=o?K:{header:{cell:x}},F={...l.scroll,x:b??"max-content",y:w||M||void 0};return t.jsxs("div",{id:"table",className:`\n        overflow-auto\n        ${!1!==i?"bordered":""}\n        ${!1!==s?"zebra":""}\n      `,children:[h&&t.jsxs("div",{className:"flex justify-between !mb-10px",children:[t.jsxs("div",{className:"flex flex-wrap items-center",children:[!!n&&t.jsx(a,{type:"primary",className:"mr-10px",icon:t.jsx(p,{}),onClick:R,children:_("public.create")}),z]}),t.jsxs("div",{className:"flex flex-wrap items-center",children:[k?t.jsx("div",{className:"mr-10px",children:k}):void 0,t.jsx(g,{className:"mr-10px transform rotate-270 cursor-pointer",disabled:!!r,onClick:E}),t.jsx(C,{className:"mr-10px",columns:Y,getTableChecks:e=>{I(e)}})]})]}),!M&&t.jsx(d,{}),M&&t.jsx("div",{ref:B,children:t.jsx(u,{size:"small",rowKey:"id",pagination:!1,loading:r,...l,rowClassName:(e,t,l)=>`${("string"==typeof j?j:null==j?void 0:j(e,t,l))||""} ${`!h-${f(T)}px`}`,style:{borderRadius:10,borderRight:"1px solid rgba(0, 0, 0, .05)",borderBottom:"1px solid rgba(0, 0, 0, .05)",overflow:"auto",...l.style},bordered:!1!==i,scroll:F,components:W,columns:L(Y,A).map(((e,t)=>({...e,onHeaderCell:e=>({width:e.width,onResize:P(t)})})))})})]})}export{T as B};
