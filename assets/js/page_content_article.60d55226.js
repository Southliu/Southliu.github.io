import{r as n,j as a}from"./react.76efb1e3.js";import{a as U,u as J}from"./react-redux.bad75fc1.js";import{u as M,b as K}from"./components_Fullscreen.5db0d3c8.js";import{c as x}from"./layouts.43869c63.js";import{U as W,D as Y}from"./components_Buttons.45a932db.js";import{B as H}from"./components_Content.c71bf899.js";import{B as Z}from"./components_Search.4b6e031b.js";import{B as ee}from"./components_Table.7421b869.js";import{B as te}from"./components_Pagination.29811a9b.js";import{u as ae,a as se}from"./react-router.9cd949e8.js";import{I as ne,m as V,h as oe}from"./antd.469ebff6.js";import{d as L,I as w,c as j,A as re,e as ce}from"./components_Business.a1f9c3ad.js";import{g as ie}from"./components_Count.0fccd205.js";import{r as q}from"./react-activation.7038d76e.js";import{g as le,s as ue,a as me,h as de,i as pe,j as fe,u as ge}from"./components_GlobalSearch.5998c80c.js";import{B as he}from"./components_Form.8f581885.js";import{S as xe}from"./components_Bottom.a10f1e76.js";function G(e){const o=L+e?`${e} - ${L}`:"";n.useEffect(()=>{document.title=o},[o]),q.useActivate(()=>{document.title=o})}function Q(e){return a.jsxs(a.Fragment,{children:[a.jsx(ne,{...e,placeholder:"请输入"}),a.jsx("div",{className:"mb-5px text-red",children:"注：标题不能含有敏感信息!"})]})}const Ge=Object.freeze(Object.defineProperty({__proto__:null,default:Q},Symbol.toStringTag,{value:"Module"})),be=[{label:"用户名",name:"username",component:"Input"},{label:"标题",name:"title",component:"Input"}],ye=e=>[{title:"ID",dataIndex:"id",width:400,fixed:"left"},{title:"用户名",dataIndex:"username",width:400,fixed:"left"},{title:"标题",dataIndex:"title",width:400},{title:"内容",dataIndex:"content",width:400},{title:"操作",dataIndex:"operate",width:200,fixed:"right",render:(o,d)=>e(o,d)}],Se=[{label:"用户名",name:"username",rules:w,component:"Input"},{label:"嵌套数据",name:["user","name","test"],rules:w,component:"Input"},{label:"标题",name:"title",rules:w,component:"customize",render:Q},{label:"内容",name:"content",component:"Editor"}];function je(e){return j.get("/content/article/index",{params:e})}function Pe(e){return j.get(`/content/article/${e}`)}function Ie(e){return j.post("/content/article",e)}function $e(e,o){return j.put(`/content/article/${e}`,o)}function Te(e){return j.delete(`/content/article/${e}`)}const B={page:1,pageSize:20};function Ce(){G("文章管理");const e=ae(),o=U(),d=n.useRef(null),{permissions:c}=M(),[u,i]=n.useState(!1),[b,p]=n.useState(B.page),[h,P]=n.useState(B.pageSize),[E,I]=n.useState(0),[R,A]=n.useState([]),[$,v]=V.useMessage(),y=J(r=>r.public.isRefreshPage),f="/content/article",m={page:x(`${f}/index`,c),create:x(`${f}/create`,c),update:x(`${f}/update`,c),delete:x(`${f}/delete`,c)},T=r=>{p(1),g({page:1,pageSize:h,...r})},g=n.useCallback(async r=>{try{i(!0);const{code:t,data:s}=await je(r);if(Number(t)===200){const{items:l,total:N}=s;I(N),A(l)}}finally{i(!1)}},[]);n.useEffect(()=>{m.page&&!y&&g({...B})},[m.page]),n.useEffect(()=>{y&&(o(K(!1)),D())},[y]);const C=()=>{e("/content/article/option?type=create")},S=r=>{e(`/content/article/option?type=update&id=${r}`)},D=()=>{var s;const t={...((s=d.current)==null?void 0:s.getFieldsValue())||{},page:b,pageSize:h};g(t)},k=async r=>{try{i(!0);const{code:t,message:s}=await Te(r);Number(t)===200&&($.success(s||"删除成功"),D())}finally{i(!1)}},F=(r,t)=>{var l;p(r),P(t);const s=(l=d.current)==null?void 0:l.getFieldsValue();g({...s,page:r,pageSize:t})},_=(r,t)=>a.jsxs(a.Fragment,{children:[m.update===!0&&a.jsx(W,{className:"mr-5px",isLoading:u,onClick:()=>S(t.id)}),m.delete===!0&&a.jsx(Y,{className:"mr-5px",isLoading:u,handleDelete:()=>k(t.id)})]});return a.jsx(H,{isPermission:m.page,children:a.jsxs(a.Fragment,{children:[v,a.jsx(Z,{formRef:d,list:be,data:B,isLoading:u,isCreate:m.create,onCreate:C,handleFinish:T}),a.jsx(ee,{loading:u,columns:ye(_),dataSource:R}),a.jsx(te,{disabled:u,current:b,pageSize:h,total:E,onChange:F})]})})}const Qe=Object.freeze(Object.defineProperty({__proto__:null,default:Ce},Symbol.toStringTag,{value:"Module"})),De=Array.from({length:20}).map((e,o)=>({key:o.toString(),title:`content${o+1}`,description:`description of content${o+1}`})),_e=De.filter(e=>Number(e.key)>10).map(e=>e.key),O={content:"<h4>初始化内容</h4>",transfer:_e},z="/content/article";function Be(){const{pathname:e,search:o}=se(),d=e+o,c=ie(o,"id"),u=n.useRef(null),i=U(),[b,p]=n.useState(!1),[h,P]=n.useState(""),[E,I]=n.useState(O),[R,A]=V.useMessage(),{permissions:$,isCollapsed:v,isPhone:y}=M(),f="文章管理",m=`${re}${f}`,T=`${ce(c,f)}`;G(c?T:m);const g="/content/article",C={create:x(`${g}/create`,$),update:x(`${g}/update`,$)};n.useEffect(()=>{const t=le(z);!y&&!v&&(i(ue(t)),i(me(z)))},[]);const S=n.useCallback((t=e)=>{if(t==="/")return;const s=c?T:m,l={label:s,key:d,nav:["内容管理","文章管理",s]};i(de(l.key)),i(pe(l.nav)),i(fe(l))},[c,e,o]);n.useEffect(()=>{S()},[S]),q.useActivate(()=>{S()}),n.useEffect(()=>{c?k(c):D()},[]);const D=()=>{P(""),I(O)},k=async t=>{try{P(t),p(!0);const{code:s,data:l}=await Pe(t);if(Number(s)!==200)return;I(l)}finally{p(!1)}},F=()=>{var t;(t=u.current)==null||t.handleSubmit()},_=t=>{var s;(s=u.current)==null||s.handleReset(),t&&i(K(!0)),i(ge({key:d,nextPath:z}))},r=async t=>{var s;try{p(!0);const l=()=>h?$e(h,t):Ie(t),{code:N,message:X}=await l();if(Number(N)!==200)return;R.success(X||"操作成功"),(s=u.current)==null||s.handleReset(),_(!0)}finally{p(!1)}};return a.jsx(H,{isPermission:c?C.update:C.create,children:a.jsxs(a.Fragment,{children:[A,a.jsx("div",{className:"mb-50px",children:a.jsx(oe,{spinning:b,children:a.jsx(he,{formRef:u,list:Se,data:E,labelCol:{span:5},handleFinish:r})})}),a.jsx(xe,{isLoading:b,goBack:()=>_(),handleSubmit:F})]})})}const Xe=Object.freeze(Object.defineProperty({__proto__:null,default:Be},Symbol.toStringTag,{value:"Module"}));export{Ge as C,Qe as i,Xe as o,G as u};
