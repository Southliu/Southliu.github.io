import{a as w,F,j as i,S as X}from"./components_Bottom.f649ec7b.js";import{r as n}from"./react.017637b6.js";import{u as O,a as S}from"./react-redux.dedf6ab1.js";import{a as V}from"./components_Fullscreen.839103dc.js";import{U as H,D as J}from"./components_Buttons.6453ecd4.js";import{B as q}from"./components_Content.6cc24515.js";import{B as W}from"./components_Search.8995727e.js";import{B as Y}from"./components_Table.6befc622.js";import{B as Z}from"./components_Pagination.dce7768e.js";import{u as ee,a as te}from"./react-router.fee81168.js";import{I as ae,m as G,g as se}from"./antd.b8eb8a06.js";import{c as K,I as z,r as I,g as ne,A as oe,d as re}from"./components_Business.4504c7d5.js";import{r as M}from"./react-activation.d5ae3aea.js";import{c as ce,e as ie,f as le,s as ue,h as pe,b as de,i as me}from"./components_GlobalSearch.0f782fbe.js";import{B as fe}from"./components_Form.1ef0af4d.js";function Q(t){const a=K+t?`${t} - ${K}`:"";n.exports.useEffect(()=>{document.title=a},[a]),M.exports.useActivate(()=>{document.title=a})}const _e=t=>{const a=[];for(let l=0;l<t.length;l++){const{id:r,operation:u}=t[l];a.push(`/${r}`);for(let c=0;c<u.length;c++)a.push(`/${r}/${u[c]}`)}return a},x=(t,a)=>!a||a.length===0?!1:a.includes(t);function he(t){return w(F,{children:[i(ae,{...t,placeholder:"请输入"}),i("div",{className:"mb-5px text-red",children:"注：标题不能含有敏感信息!"})]})}const ge=[{label:"用户名",name:"username",component:"Input"},{label:"标题",name:"title",component:"Input"}],xe=t=>[{title:"ID",dataIndex:"id",width:400,fixed:"left"},{title:"用户名",dataIndex:"username",width:400,fixed:"left"},{title:"标题",dataIndex:"title",width:400},{title:"内容",dataIndex:"content",width:400},{title:"操作",dataIndex:"operate",width:200,fixed:"right",render:(a,l)=>t(a,l)}],be=[{label:"用户名",name:"username",rules:z,component:"Input"},{label:"嵌套数据",name:["user","name","test"],rules:z,component:"Input"},{label:"标题",name:"title",rules:z,component:"customize",render:he},{label:"内容",name:"content",component:"Editor"}];function ye(t){return I.get("/content/article/index",{params:t})}function Pe(t){return I.get(`/content/article/${t}`)}function Se(t){return I.post("/content/article",t)}function Ie(t,a){return I.put(`/content/article/${t}`,a)}function $e(t){return I.delete(`/content/article/${t}`)}const v={page:1,pageSize:20};function Ke(){Q("文章管理");const t=ee(),a=O(),l=n.exports.useRef(null),[r,u]=n.exports.useState(!1),[c,b]=n.exports.useState(v.page),[m,$]=n.exports.useState(v.pageSize),[T,L]=n.exports.useState(0),[B,C]=n.exports.useState([]),g=S(s=>s.user.permissions),y=S(s=>s.public.isRefreshPage),f="/content/article",d={page:x(`${f}/index`,g),create:x(`${f}/create`,g),update:x(`${f}/update`,g),delete:x(`${f}/delete`,g)},D=s=>{b(1),h({page:1,pageSize:m,...s})},h=n.exports.useCallback(async s=>{try{u(!0);const{data:{data:e}}=await ye(s),{items:o,total:p}=e;L(p),C(o)}finally{u(!1)}},[]);n.exports.useEffect(()=>{d.page&&!y&&h({...v})},[d.page]),n.exports.useEffect(()=>{y&&(a(V(!1)),A())},[y]);const R=()=>{t("/content/article/option?type=create")},P=s=>{t(`/content/article/option?type=update&id=${s}`)},A=()=>{var o;const e={...((o=l.current)==null?void 0:o.getFieldsValue())||{},page:c,pageSize:m};h(e)},k=async s=>{try{u(!0);const{data:e}=await $e(s);(e==null?void 0:e.code)===200&&(G.success((e==null?void 0:e.message)||"删除成功"),A())}finally{u(!1)}},N=(s,e)=>{var p;b(s),$(e);const o=(p=l.current)==null?void 0:p.getFieldsValue();h({...o,page:s,pageSize:e})},E=(s,e)=>w(F,{children:[d.update===!0&&i(H,{className:"mr-5px",isLoading:r,onClick:()=>P(e.id)}),d.delete===!0&&i(J,{className:"mr-5px",isLoading:r,handleDelete:()=>k(e.id)})]});return i(q,{isPermission:d.page,children:w(F,{children:[i(W,{formRef:l,list:ge,data:v,isLoading:r,isCreate:d.create,onCreate:R,handleFinish:D}),i(Y,{loading:r,columns:xe(E),dataSource:B}),i(Z,{disabled:r,current:c,pageSize:m,total:T,onChange:N})]})})}const j={content:"<h4>初始化内容</h4>"},_="/content/article";function je(){const{pathname:t,search:a}=te(),l=t+a,r=ne(a,"id"),u=n.exports.useRef(null),c=O(),[b,m]=n.exports.useState(!1),[$,T]=n.exports.useState(""),[L,B]=n.exports.useState(j),C=S(e=>e.user.permissions),g=S(e=>e.menu.isCollapsed),y=S(e=>e.menu.isPhone),f="文章管理",d=`${oe}${f}`,D=`${re(r,f)}`;Q(r?D:d);const h="/content/article",R={create:x(`${h}/create`,C),update:x(`${h}/update`,C)};n.exports.useEffect(()=>{const e=ce(_);!y&&!g&&(c(ie(e)),c(le(_)))},[]);const P=n.exports.useCallback((e=t)=>{if(e==="/")return;const o=r?D:d,p={label:o,key:l,nav:["内容管理","文章管理",o]};c(ue(p.key)),c(pe(p.nav)),c(de(p))},[r,t,a]);n.exports.useEffect(()=>{P()},[P]),M.exports.useActivate(()=>{P()}),n.exports.useEffect(()=>{r?k(r):A()},[]);const A=()=>{T(""),B(j)},k=async e=>{try{T(e),m(!0);const{data:{data:o}}=await Pe(e);B(o)}finally{m(!1)}},N=()=>{var e;(e=u.current)==null||e.handleSubmit()},E=e=>{var o;(o=u.current)==null||o.handleReset(),e&&c(V(!0)),c(me({key:l,nextPath:_}))},s=async e=>{var o;try{m(!0);const p=()=>$?Ie($,e):Se(e),{data:U}=await p();G.success((U==null?void 0:U.message)||"操作成功"),(o=u.current)==null||o.handleReset(),E(!0)}finally{m(!1)}};return i(q,{isPermission:r?R.update:R.creae,children:w(F,{children:[i("div",{className:"mb-50px",children:i(se,{spinning:b,children:i(fe,{formRef:u,list:be,data:L,labelCol:{span:5},handleFinish:s})})}),i(X,{isLoading:b,goBack:()=>E(),handleSubmit:N})]})})}export{Ke as P,je as a,x as c,_e as p,Q as u};
