import{r as s,j as a}from"./react.402eeaf7.js";import{a as U,u as X}from"./react-redux.a23d062c.js";import{u as M,b as K}from"./components_Fullscreen.dc33051e.js";import{c as x}from"./layouts.81f68454.js";import{U as J,D as W}from"./components_Buttons.72d70265.js";import{B as H}from"./components_Content.6a26484c.js";import{B as Y}from"./components_Search.00df5fcf.js";import{B as Z}from"./components_Table.240f2427.js";import{B as ee}from"./components_Pagination.752ec5df.js";import{u as te,a as ae}from"./react-router.6ca0c4e9.js";import{I as se,m as V,h as ne}from"./antd.2a715811.js";import{b as N,I as z,r as P,A as oe,c as re}from"./components_Business.97a40718.js";import{g as ce}from"./components_Count.3df16e01.js";import{r as q}from"./react-activation.23049be8.js";import{g as ie,s as le,a as ue,h as me,i as de,j as pe,u as fe}from"./components_GlobalSearch.04adc41b.js";import{B as ge}from"./components_Form.e497ef41.js";import{S as he}from"./components_Bottom.f8da3917.js";function G(t){const n=N+t?`${t} - ${N}`:"";s.useEffect(()=>{document.title=n},[n]),q.useActivate(()=>{document.title=n})}function Q(t){return a.jsxs(a.Fragment,{children:[a.jsx(se,{...t,placeholder:"请输入"}),a.jsx("div",{className:"mb-5px text-red",children:"注：标题不能含有敏感信息!"})]})}const qe=Object.freeze(Object.defineProperty({__proto__:null,default:Q},Symbol.toStringTag,{value:"Module"})),xe=[{label:"用户名",name:"username",component:"Input"},{label:"标题",name:"title",component:"Input"}],be=t=>[{title:"ID",dataIndex:"id",width:400,fixed:"left"},{title:"用户名",dataIndex:"username",width:400,fixed:"left"},{title:"标题",dataIndex:"title",width:400},{title:"内容",dataIndex:"content",width:400},{title:"操作",dataIndex:"operate",width:200,fixed:"right",render:(n,d)=>t(n,d)}],ye=[{label:"用户名",name:"username",rules:z,component:"Input"},{label:"嵌套数据",name:["user","name","test"],rules:z,component:"Input"},{label:"标题",name:"title",rules:z,component:"customize",render:Q},{label:"内容",name:"content",component:"Editor"}];function Se(t){return P.get("/content/article/index",{params:t})}function je(t){return P.get(`/content/article/${t}`)}function Pe(t){return P.post("/content/article",t)}function Ie(t,n){return P.put(`/content/article/${t}`,n)}function $e(t){return P.delete(`/content/article/${t}`)}const E={page:1,pageSize:20};function Te(){G("文章管理");const t=te(),n=U(),d=s.useRef(null),{permissions:c}=M(),[l,i]=s.useState(!1),[b,p]=s.useState(E.page),[h,I]=s.useState(E.pageSize),[R,$]=s.useState(0),[A,v]=s.useState([]),[T,k]=V.useMessage(),y=X(r=>r.public.isRefreshPage),f="/content/article",m={page:x(`${f}/index`,c),create:x(`${f}/create`,c),update:x(`${f}/update`,c),delete:x(`${f}/delete`,c)},C=r=>{p(1),g({page:1,pageSize:h,...r})},g=s.useCallback(async r=>{try{i(!0);const{code:e,data:o}=await Se(r);if(Number(e)===200){const{items:u,total:j}=o;$(j),v(u)}}finally{i(!1)}},[]);s.useEffect(()=>{m.page&&!y&&g({...E})},[m.page]),s.useEffect(()=>{y&&(n(K(!1)),_())},[y]);const D=()=>{t("/content/article/option?type=create")},S=r=>{t(`/content/article/option?type=update&id=${r}`)},_=()=>{var o;const e={...((o=d.current)==null?void 0:o.getFieldsValue())||{},page:b,pageSize:h};g(e)},F=async r=>{try{i(!0);const e=await $e(r);(e==null?void 0:e.code)===200&&(T.success((e==null?void 0:e.message)||"删除成功"),_())}finally{i(!1)}},w=(r,e)=>{var u;p(r),I(e);const o=(u=d.current)==null?void 0:u.getFieldsValue();g({...o,page:r,pageSize:e})},B=(r,e)=>a.jsxs(a.Fragment,{children:[m.update===!0&&a.jsx(J,{className:"mr-5px",isLoading:l,onClick:()=>S(e.id)}),m.delete===!0&&a.jsx(W,{className:"mr-5px",isLoading:l,handleDelete:()=>F(e.id)})]});return a.jsx(H,{isPermission:m.page,children:a.jsxs(a.Fragment,{children:[k,a.jsx(Y,{formRef:d,list:xe,data:E,isLoading:l,isCreate:m.create,onCreate:D,handleFinish:C}),a.jsx(Z,{loading:l,columns:be(B),dataSource:A}),a.jsx(ee,{disabled:l,current:b,pageSize:h,total:R,onChange:w})]})})}const Ge=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"})),Ce=Array.from({length:20}).map((t,n)=>({key:n.toString(),title:`content${n+1}`,description:`description of content${n+1}`})),De=Ce.filter(t=>Number(t.key)>10).map(t=>t.key),O={content:"<h4>初始化内容</h4>",transfer:De},L="/content/article";function _e(){const{pathname:t,search:n}=ae(),d=t+n,c=ce(n,"id"),l=s.useRef(null),i=U(),[b,p]=s.useState(!1),[h,I]=s.useState(""),[R,$]=s.useState(O),[A,v]=V.useMessage(),{permissions:T,isCollapsed:k,isPhone:y}=M(),f="文章管理",m=`${oe}${f}`,C=`${re(c,f)}`;G(c?C:m);const g="/content/article",D={create:x(`${g}/create`,T),update:x(`${g}/update`,T)};s.useEffect(()=>{const e=ie(L);!y&&!k&&(i(le(e)),i(ue(L)))},[]);const S=s.useCallback((e=t)=>{if(e==="/")return;const o=c?C:m,u={label:o,key:d,nav:["内容管理","文章管理",o]};i(me(u.key)),i(de(u.nav)),i(pe(u))},[c,t,n]);s.useEffect(()=>{S()},[S]),q.useActivate(()=>{S()}),s.useEffect(()=>{c?F(c):_()},[]);const _=()=>{I(""),$(O)},F=async e=>{try{I(e),p(!0);const{data:o}=await je(e);$(o)}finally{p(!1)}},w=()=>{var e;(e=l.current)==null||e.handleSubmit()},B=e=>{var o;(o=l.current)==null||o.handleReset(),e&&i(K(!0)),i(fe({key:d,nextPath:L}))},r=async e=>{var o;try{p(!0);const u=()=>h?Ie(h,e):Pe(e),{data:j}=await u();A.success((j==null?void 0:j.message)||"操作成功"),(o=l.current)==null||o.handleReset(),B(!0)}finally{p(!1)}};return a.jsx(H,{isPermission:c?D.update:D.create,children:a.jsxs(a.Fragment,{children:[v,a.jsx("div",{className:"mb-50px",children:a.jsx(ne,{spinning:b,children:a.jsx(ge,{formRef:l,list:ye,data:R,labelCol:{span:5},handleFinish:r})})}),a.jsx(he,{isLoading:b,goBack:()=>B(),handleSubmit:w})]})})}const Qe=Object.freeze(Object.defineProperty({__proto__:null,default:_e},Symbol.toStringTag,{value:"Module"}));export{qe as C,Ge as i,Qe as o,G as u};
