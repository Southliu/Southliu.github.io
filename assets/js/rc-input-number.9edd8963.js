import{b as y,g as ee,r as Le,d as q,e as We}from"./@babel_runtime.3e487d10.js";import{r as t}from"./react.bfbbfd99.js";import{c as ne}from"./classnames.aa374d53.js";import{E as je,A as Ye,h as Ie,F as X,n as ze,K as B}from"./rc-util.4aaadd18.js";import{n as we,t as Ee,g as N,a as Re,v as Ge,b as Z}from"./@rc-component_mini-decimal.ca4d3454.js";var Je=200,Qe=600;function Xe(e){var l=e.prefixCls,o=e.upNode,C=e.downNode,v=e.upDisabled,m=e.downDisabled,g=e.onStep,c=t.useRef(),p=t.useRef();p.current=g;var b=function(R,F){R.preventDefault(),p.current(F);function _(){p.current(F),c.current=setTimeout(_,Je)}c.current=setTimeout(_,Qe)},s=function(){clearTimeout(c.current)};if(t.useEffect(function(){return s},[]),je())return null;var f="".concat(l,"-handler"),d=ne(f,"".concat(f,"-up"),y({},"".concat(f,"-up-disabled"),v)),E=ne(f,"".concat(f,"-down"),y({},"".concat(f,"-down-disabled"),m)),h={unselectable:"on",role:"button",onMouseUp:s,onMouseLeave:s};return t.createElement("div",{className:"".concat(f,"-wrap")},t.createElement("span",ee({},h,{onMouseDown:function(R){b(R,!0)},"aria-label":"Increase Value","aria-disabled":v,className:d}),o||t.createElement("span",{unselectable:"on",className:"".concat(l,"-handler-up-inner")})),t.createElement("span",ee({},h,{onMouseDown:function(R){b(R,!1)},"aria-label":"Decrease Value","aria-disabled":m,className:E}),C||t.createElement("span",{unselectable:"on",className:"".concat(l,"-handler-down-inner")})))}function ye(e){var l=typeof e=="number"?we(e):Ee(e).fullStr,o=l.includes(".");return o?Ee(l.replace(/(\d)\.(\d)/g,"$1$2.")).fullStr:e+"0"}function Ze(e,l){var o=t.useRef(null);function C(){try{var m=e.selectionStart,g=e.selectionEnd,c=e.value,p=c.substring(0,m),b=c.substring(g);o.current={start:m,end:g,value:c,beforeTxt:p,afterTxt:b}}catch{}}function v(){if(e&&o.current&&l)try{var m=e.value,g=o.current,c=g.beforeTxt,p=g.afterTxt,b=g.start,s=m.length;if(m.endsWith(p))s=m.length-o.current.afterTxt.length;else if(m.startsWith(c))s=c.length;else{var f=c[b-1],d=m.indexOf(f,b-1);d!==-1&&(s=d+1)}e.setSelectionRange(s,s)}catch(E){Ye(!1,"Something warning of cursor restore. Please fire issue about this: ".concat(E.message))}}return[C,v]}const en=function(){var e=t.useRef(0),l=function(){Ie.cancel(e.current)};return t.useEffect(function(){return l},[]),function(o){l(),e.current=Ie(function(){o()})}};var nn=["prefixCls","className","style","min","max","step","defaultValue","value","disabled","readOnly","upHandler","downHandler","keyboard","controls","stringMode","parser","formatter","precision","decimalSeparator","onChange","onInput","onPressEnter","onStep"],Ce=function(l,o){return l||o.isEmpty()?o.toString():o.toNumber()},he=function(l){var o=N(l);return o.isInvalidate()?null:o},an=t.forwardRef(function(e,l){var o,C=e.prefixCls,v=C===void 0?"rc-input-number":C,m=e.className,g=e.style,c=e.min,p=e.max,b=e.step,s=b===void 0?1:b,f=e.defaultValue,d=e.value,E=e.disabled,h=e.readOnly,M=e.upHandler,R=e.downHandler,F=e.keyboard,_=e.controls,De=_===void 0?!0:_,ae=e.stringMode,O=e.parser,U=e.formatter,w=e.precision,D=e.decimalSeparator,A=e.onChange,L=e.onInput,W=e.onPressEnter,j=e.onStep,Ve=Le(e,nn),re="".concat(v,"-input"),k=t.useRef(null),xe=t.useState(!1),te=q(xe,2),ue=te[0],oe=te[1],I=t.useRef(!1),K=t.useRef(!1),P=t.useRef(!1),Me=t.useState(function(){return N(d??f)}),ie=q(Me,2),i=ie[0],se=ie[1];function _e(a){d===void 0&&se(a)}var Y=t.useCallback(function(a,n){if(!n)return w>=0?w:Math.max(Re(a),Re(s))},[w,s]),z=t.useCallback(function(a){var n=String(a);if(O)return O(n);var u=n;return D&&(u=u.replace(D,".")),u.replace(/[^\w.-]+/g,"")},[O,D]),le=t.useRef(""),ce=t.useCallback(function(a,n){if(U)return U(a,{userTyping:n,input:String(le.current)});var u=typeof a=="number"?we(a):a;if(!n){var r=Y(u,n);if(Ge(u)&&(D||r>=0)){var S=D||".";u=Z(u,S,r)}}return u},[U,Y,D]),Ue=t.useState(function(){var a=f??d;return i.isInvalidate()&&["string","number"].includes(We(a))?Number.isNaN(a)?"":a:ce(i.toString(),!1)}),fe=q(Ue,2),$=fe[0],de=fe[1];le.current=$;function T(a,n){de(ce(a.isInvalidate()?a.toString(!1):a.toString(!n),n))}var V=t.useMemo(function(){return he(p)},[p,w]),x=t.useMemo(function(){return he(c)},[c,w]),ve=t.useMemo(function(){return!V||!i||i.isInvalidate()?!1:V.lessEquals(i)},[V,i]),me=t.useMemo(function(){return!x||!i||i.isInvalidate()?!1:i.lessEquals(x)},[x,i]),Ke=Ze(k.current,ue),pe=q(Ke,2),Pe=pe[0],$e=pe[1],ge=function(n){return V&&!n.lessEquals(V)?V:x&&!x.lessEquals(n)?x:null},G=function(n){return!ge(n)},J=function(n,u){var r=n,S=G(r)||r.isEmpty();if(!r.isEmpty()&&!u&&(r=ge(r)||r,S=!0),!h&&!E&&S){var H=r.toString(),Q=Y(H,u);return Q>=0&&(r=N(Z(H,".",Q)),G(r)||(r=N(Z(H,".",Q,!0)))),r.equals(i)||(_e(r),A==null||A(r.isEmpty()?null:Ce(ae,r)),d===void 0&&T(r,u)),r}return i},Te=en(),be=function a(n){if(Pe(),de(n),!K.current){var u=z(n),r=N(u);r.isNaN()||J(r,!0)}L==null||L(n),Te(function(){var S=n;O||(S=n.replace(/ã€‚/g,".")),S!==n&&a(S)})},He=function(){K.current=!0},Fe=function(){K.current=!1,be(k.current.value)},Oe=function(n){be(n.target.value)},Se=function(n){var u;if(!(n&&ve||!n&&me)){I.current=!1;var r=N(P.current?ye(s):s);n||(r=r.negate());var S=(i||N(0)).add(r.toString()),H=J(S,!1);j==null||j(Ce(ae,H),{offset:P.current?ye(s):s,type:n?"up":"down"}),(u=k.current)===null||u===void 0||u.focus()}},Ne=function(n){var u=N(z($)),r=u;u.isNaN()?r=i:r=J(u,n),d!==void 0?T(i,!1):r.isNaN()||T(r,!1)},ke=function(){I.current=!0},qe=function(n){var u=n.which,r=n.shiftKey;I.current=!0,r?P.current=!0:P.current=!1,u===B.ENTER&&(K.current||(I.current=!1),Ne(!1),W==null||W(n)),F!==!1&&!K.current&&[B.UP,B.DOWN].includes(u)&&(Se(B.UP===u),n.preventDefault())},Be=function(){I.current=!1,P.current=!1},Ae=function(){Ne(!1),oe(!1),I.current=!1};return X(function(){i.isInvalidate()||T(i,!1)},[w]),X(function(){var a=N(d);se(a);var n=N(z($));(!a.equals(n)||!I.current||U)&&T(a,I.current)},[d]),X(function(){U&&$e()},[$]),t.createElement("div",{className:ne(v,m,(o={},y(o,"".concat(v,"-focused"),ue),y(o,"".concat(v,"-disabled"),E),y(o,"".concat(v,"-readonly"),h),y(o,"".concat(v,"-not-a-number"),i.isNaN()),y(o,"".concat(v,"-out-of-range"),!i.isInvalidate()&&!G(i)),o)),style:g,onFocus:function(){oe(!0)},onBlur:Ae,onKeyDown:qe,onKeyUp:Be,onCompositionStart:He,onCompositionEnd:Fe,onBeforeInput:ke},De&&t.createElement(Xe,{prefixCls:v,upNode:M,downNode:R,upDisabled:ve,downDisabled:me,onStep:Se}),t.createElement("div",{className:"".concat(re,"-wrap")},t.createElement("input",ee({autoComplete:"off",role:"spinbutton","aria-valuemin":c,"aria-valuemax":p,"aria-valuenow":i.isInvalidate()?null:i.toString(),step:s},Ve,{ref:ze(k,l),className:re,value:$,onChange:Oe,disabled:E,readOnly:h}))))});an.displayName="InputNumber";export{an as I};
