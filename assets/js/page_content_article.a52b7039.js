import{r as n,j as a}from"./react.e58b2294.js";import{u as _,a as P}from"./react-redux.95773f8e.js";import{b as K}from"./components_Fullscreen.c1798143.js";import{c as x}from"./layouts.123eba59.js";import{U as M,D as Q}from"./components_Buttons.f67a8601.js";import{B as O}from"./components_Content.63b8b171.js";import{B as X}from"./components_Search.00806cc4.js";import{B as H}from"./components_Table.ad60f8e3.js";import{B as J}from"./components_Pagination.18bf9eae.js";import{u as W,a as Y}from"./react-router.d965eaa6.js";import{I as Z,m as V,g as ee}from"./antd.a9b3ffac.js";import{c as U,I as L,r as I,g as te,A as ae,d as se}from"./components_Business.ac78b8d1.js";import{r as q}from"./react-activation.27c4d2cc.js";import{g as ne,s as oe,a as re,h as ie,i as ce,j as le,u as ue}from"./components_GlobalSearch.77d489aa.js";import{B as me}from"./components_Form.2b8ebf99.js";import{S as de}from"./components_Bottom.856be48f.js";function G(t){const o=U+t?`${t} - ${U}`:"";n.useEffect(()=>{document.title=o},[o]),q.useActivate(()=>{document.title=o})}function pe(t){return a.jsxs(a.Fragment,{children:[a.jsx(Z,{...t,placeholder:"请输入"}),a.jsx("div",{className:"mb-5px text-red",children:"注：标题不能含有敏感信息!"})]})}const fe=[{label:"用户名",name:"username",component:"Input"},{label:"标题",name:"title",component:"Input"}],ge=t=>[{title:"ID",dataIndex:"id",width:400,fixed:"left"},{title:"用户名",dataIndex:"username",width:400,fixed:"left"},{title:"标题",dataIndex:"title",width:400},{title:"内容",dataIndex:"content",width:400},{title:"操作",dataIndex:"operate",width:200,fixed:"right",render:(o,d)=>t(o,d)}],he=[{label:"用户名",name:"username",rules:L,component:"Input"},{label:"嵌套数据",name:["user","name","test"],rules:L,component:"Input"},{label:"标题",name:"title",rules:L,component:"customize",render:pe},{label:"内容",name:"content",component:"Editor"}];function xe(t){return I.get("/content/article/index",{params:t})}function ye(t){return I.get(`/content/article/${t}`)}function be(t){return I.post("/content/article",t)}function Se(t,o){return I.put(`/content/article/${t}`,o)}function Pe(t){return I.delete(`/content/article/${t}`)}const k={page:1,pageSize:20};function _e(){G("文章管理");const t=W(),o=_(),d=n.useRef(null),[i,u]=n.useState(!1),[c,y]=n.useState(k.page),[p,$]=n.useState(k.pageSize),[j,A]=n.useState(0),[T,D]=n.useState([]),h=P(s=>s.user.permissions),b=P(s=>s.public.isRefreshPage),f="/content/article",m={page:x(`${f}/index`,h),create:x(`${f}/create`,h),update:x(`${f}/update`,h),delete:x(`${f}/delete`,h)},B=s=>{y(1),g({page:1,pageSize:p,...s})},g=n.useCallback(async s=>{try{u(!0);const{data:{data:e}}=await xe(s),{items:r,total:l}=e;A(l),D(r)}finally{u(!1)}},[]);n.useEffect(()=>{m.page&&!b&&g({...k})},[m.page]),n.useEffect(()=>{b&&(o(K(!1)),E())},[b]);const C=()=>{t("/content/article/option?type=create")},S=s=>{t(`/content/article/option?type=update&id=${s}`)},E=()=>{var r;const e={...((r=d.current)==null?void 0:r.getFieldsValue())||{},page:c,pageSize:p};g(e)},F=async s=>{try{u(!0);const{data:e}=await Pe(s);(e==null?void 0:e.code)===200&&(V.success((e==null?void 0:e.message)||"删除成功"),E())}finally{u(!1)}},v=(s,e)=>{var l;y(s),$(e);const r=(l=d.current)==null?void 0:l.getFieldsValue();g({...r,page:s,pageSize:e})},R=(s,e)=>a.jsxs(a.Fragment,{children:[m.update===!0&&a.jsx(M,{className:"mr-5px",isLoading:i,onClick:()=>S(e.id)}),m.delete===!0&&a.jsx(Q,{className:"mr-5px",isLoading:i,handleDelete:()=>F(e.id)})]});return a.jsx(O,{isPermission:m.page,children:a.jsxs(a.Fragment,{children:[a.jsx(X,{formRef:d,list:fe,data:k,isLoading:i,isCreate:m.create,onCreate:C,handleFinish:B}),a.jsx(H,{loading:i,columns:ge(R),dataSource:T}),a.jsx(J,{disabled:i,current:c,pageSize:p,total:j,onChange:v})]})})}const Ie=Array.from({length:20}).map((t,o)=>({key:o.toString(),title:`content${o+1}`,description:`description of content${o+1}`})),$e=Ie.filter(t=>Number(t.key)>10).map(t=>t.key),z={content:"<h4>初始化内容</h4>",transfer:$e},N="/content/article";function Ke(){const{pathname:t,search:o}=Y(),d=t+o,i=te(o,"id"),u=n.useRef(null),c=_(),[y,p]=n.useState(!1),[$,j]=n.useState(""),[A,T]=n.useState(z),D=P(e=>e.user.permissions),h=P(e=>e.menu.isCollapsed),b=P(e=>e.menu.isPhone),f="文章管理",m=`${ae}${f}`,B=`${se(i,f)}`;G(i?B:m);const g="/content/article",C={create:x(`${g}/create`,D),update:x(`${g}/update`,D)};n.useEffect(()=>{const e=ne(N);!b&&!h&&(c(oe(e)),c(re(N)))},[]);const S=n.useCallback((e=t)=>{if(e==="/")return;const r=i?B:m,l={label:r,key:d,nav:["内容管理","文章管理",r]};c(ie(l.key)),c(ce(l.nav)),c(le(l))},[i,t,o]);n.useEffect(()=>{S()},[S]),q.useActivate(()=>{S()}),n.useEffect(()=>{i?F(i):E()},[]);const E=()=>{j(""),T(z)},F=async e=>{try{j(e),p(!0);const{data:{data:r}}=await ye(e);T(r)}finally{p(!1)}},v=()=>{var e;(e=u.current)==null||e.handleSubmit()},R=e=>{var r;(r=u.current)==null||r.handleReset(),e&&c(K(!0)),c(ue({key:d,nextPath:N}))},s=async e=>{var r;try{p(!0);const l=()=>$?Se($,e):be(e),{data:w}=await l();V.success((w==null?void 0:w.message)||"操作成功"),(r=u.current)==null||r.handleReset(),R(!0)}finally{p(!1)}};return a.jsx(O,{isPermission:i?C.update:C.create,children:a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"mb-50px",children:a.jsx(ee,{spinning:y,children:a.jsx(me,{formRef:u,list:he,data:A,labelCol:{span:5},handleFinish:s})})}),a.jsx(de,{isLoading:y,goBack:()=>R(),handleSubmit:v})]})})}export{_e as P,Ke as a,G as u};
