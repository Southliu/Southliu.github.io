import{a as w,F,j as c,S as X}from"./components_Bottom.ec4afff7.js";import{r as s}from"./react.017637b6.js";import{u as O,a as I}from"./react-redux.dedf6ab1.js";import{b as V}from"./components_Fullscreen.d338cd5e.js";import{c as x}from"./layouts.eb3aab1b.js";import{U as H,D as J}from"./components_Buttons.60892b3f.js";import{B as q}from"./components_Content.21c428a3.js";import{B as W}from"./components_Search.28535630.js";import{B as Y}from"./components_Table.366f0caa.js";import{B as Z}from"./components_Pagination.470b1f0d.js";import{u as ee,a as te}from"./react-router.f2f697d9.js";import{I as ae,m as G,g as se}from"./antd.9976a9b6.js";import{c as j,I as z,r as y,g as ne,A as oe,d as re}from"./components_Business.4feef370.js";import{r as M}from"./react-activation.d5ae3aea.js";import{g as ce,s as ie,a as le,h as ue,i as pe,j as de,u as me}from"./components_GlobalSearch.6244d8a1.js";import{B as fe}from"./components_Form.dde643c8.js";function Q(t){const o=j+t?`${t} - ${j}`:"";s.exports.useEffect(()=>{document.title=o},[o]),M.exports.useActivate(()=>{document.title=o})}function he(t){return w(F,{children:[c(ae,{...t,placeholder:"请输入"}),c("div",{className:"mb-5px text-red",children:"注：标题不能含有敏感信息!"})]})}const ge=[{label:"用户名",name:"username",component:"Input"},{label:"标题",name:"title",component:"Input"}],xe=t=>[{title:"ID",dataIndex:"id",width:400,fixed:"left"},{title:"用户名",dataIndex:"username",width:400,fixed:"left"},{title:"标题",dataIndex:"title",width:400},{title:"内容",dataIndex:"content",width:400},{title:"操作",dataIndex:"operate",width:200,fixed:"right",render:(o,d)=>t(o,d)}],be=[{label:"用户名",name:"username",rules:z,component:"Input"},{label:"嵌套数据",name:["user","name","test"],rules:z,component:"Input"},{label:"标题",name:"title",rules:z,component:"customize",render:he},{label:"内容",name:"content",component:"Editor"}];function Pe(t){return y.get("/content/article/index",{params:t})}function Se(t){return y.get(`/content/article/${t}`)}function Ie(t){return y.post("/content/article",t)}function ye(t,o){return y.put(`/content/article/${t}`,o)}function $e(t){return y.delete(`/content/article/${t}`)}const v={page:1,pageSize:20};function je(){Q("文章管理");const t=ee(),o=O(),d=s.exports.useRef(null),[r,u]=s.exports.useState(!1),[i,b]=s.exports.useState(v.page),[m,$]=s.exports.useState(v.pageSize),[T,L]=s.exports.useState(0),[B,C]=s.exports.useState([]),g=I(a=>a.user.permissions),P=I(a=>a.public.isRefreshPage),f="/content/article",p={page:x(`${f}/index`,g),create:x(`${f}/create`,g),update:x(`${f}/update`,g),delete:x(`${f}/delete`,g)},D=a=>{b(1),h({page:1,pageSize:m,...a})},h=s.exports.useCallback(async a=>{try{u(!0);const{data:{data:e}}=await Pe(a),{items:n,total:l}=e;L(l),C(n)}finally{u(!1)}},[]);s.exports.useEffect(()=>{p.page&&!P&&h({...v})},[p.page]),s.exports.useEffect(()=>{P&&(o(V(!1)),E())},[P]);const R=()=>{t("/content/article/option?type=create")},S=a=>{t(`/content/article/option?type=update&id=${a}`)},E=()=>{var n;const e={...((n=d.current)==null?void 0:n.getFieldsValue())||{},page:i,pageSize:m};h(e)},k=async a=>{try{u(!0);const{data:e}=await $e(a);(e==null?void 0:e.code)===200&&(G.success((e==null?void 0:e.message)||"删除成功"),E())}finally{u(!1)}},N=(a,e)=>{var l;b(a),$(e);const n=(l=d.current)==null?void 0:l.getFieldsValue();h({...n,page:a,pageSize:e})},A=(a,e)=>w(F,{children:[p.update===!0&&c(H,{className:"mr-5px",isLoading:r,onClick:()=>S(e.id)}),p.delete===!0&&c(J,{className:"mr-5px",isLoading:r,handleDelete:()=>k(e.id)})]});return c(q,{isPermission:p.page,children:w(F,{children:[c(W,{formRef:d,list:ge,data:v,isLoading:r,isCreate:p.create,onCreate:R,handleFinish:D}),c(Y,{loading:r,columns:xe(A),dataSource:B}),c(Z,{disabled:r,current:i,pageSize:m,total:T,onChange:N})]})})}const K={content:"<h4>初始化内容</h4>"},_="/content/article";function Ke(){const{pathname:t,search:o}=te(),d=t+o,r=ne(o,"id"),u=s.exports.useRef(null),i=O(),[b,m]=s.exports.useState(!1),[$,T]=s.exports.useState(""),[L,B]=s.exports.useState(K),C=I(e=>e.user.permissions),g=I(e=>e.menu.isCollapsed),P=I(e=>e.menu.isPhone),f="文章管理",p=`${oe}${f}`,D=`${re(r,f)}`;Q(r?D:p);const h="/content/article",R={create:x(`${h}/create`,C),update:x(`${h}/update`,C)};s.exports.useEffect(()=>{const e=ce(_);!P&&!g&&(i(ie(e)),i(le(_)))},[]);const S=s.exports.useCallback((e=t)=>{if(e==="/")return;const n=r?D:p,l={label:n,key:d,nav:["内容管理","文章管理",n]};i(ue(l.key)),i(pe(l.nav)),i(de(l))},[r,t,o]);s.exports.useEffect(()=>{S()},[S]),M.exports.useActivate(()=>{S()}),s.exports.useEffect(()=>{r?k(r):E()},[]);const E=()=>{T(""),B(K)},k=async e=>{try{T(e),m(!0);const{data:{data:n}}=await Se(e);B(n)}finally{m(!1)}},N=()=>{var e;(e=u.current)==null||e.handleSubmit()},A=e=>{var n;(n=u.current)==null||n.handleReset(),e&&i(V(!0)),i(me({key:d,nextPath:_}))},a=async e=>{var n;try{m(!0);const l=()=>$?ye($,e):Ie(e),{data:U}=await l();G.success((U==null?void 0:U.message)||"操作成功"),(n=u.current)==null||n.handleReset(),A(!0)}finally{m(!1)}};return c(q,{isPermission:r?R.update:R.creae,children:w(F,{children:[c("div",{className:"mb-50px",children:c(se,{spinning:b,children:c(fe,{formRef:u,list:be,data:L,labelCol:{span:5},handleFinish:a})})}),c(X,{isLoading:b,goBack:()=>A(),handleSubmit:N})]})})}export{je as P,Ke as a,Q as u};
