import{j as e,r as l}from"./react.a7da97a2.js";import{I as n}from"./@iconify_react.bcaf6c88.js";import{u as s}from"./ahooks.93e76957.js";import{a as t}from"./react-redux.5cd65198.js";import{L as a}from"./components_Business.8bae5923.js";import{c as o}from"./@reduxjs_toolkit.fb91ade4.js";import{u as i}from"./components_Fullscreen.8cfdd543.js";import{u as r}from"./react-i18next.1d91db1a.js";import{u as c}from"./react-router.31c22429.js";import{M as u,I as d,T as p}from"./antd.850acb68.js";const h=o({name:"menu",initialState:{isPhone:!1,isCollapsed:!1,selectedKeys:"dashboard",openKeys:["Dashboard"],menuList:[]},reducers:{toggleCollapsed:(e,l)=>{e.isCollapsed=!!l.payload},togglePhone:(e,l)=>{e.isPhone=!!l.payload},setSelectedKeys:(e,l)=>{e.selectedKeys=l.payload},setOpenKeys:(e,l)=>{e.openKeys=l.payload},setMenuList:(e,l)=>{e.menuList=l.payload}}}),{toggleCollapsed:m,togglePhone:v,setSelectedKeys:x,setOpenKeys:f,setMenuList:g}=h.actions,b=h.reducer,y=o({name:"tabs",initialState:{isLock:!1,isMaximize:!1,activeKey:"",nav:[],tabs:[]},reducers:{toggleLock:(e,l)=>{e.isLock=!!l.payload},toggleMaximize:(e,l)=>{e.isMaximize=!!l.payload},setActiveKey:(e,l)=>{e.activeKey=l.payload},setNav:(e,l)=>{e.nav=l.payload},switchTabsLang:(e,l)=>{const{tabs:n}=e,{payload:s}=l;for(let t=0;t<(null==n?void 0:n.length);t++){const e=n[t];e.label="en"===s?e.labelEn:e.labelZh}},addTabs:(e,l)=>{const{tabs:n}=e,{payload:s}=l;n.find((e=>e.key===s.key))||n.push(s),(null==n?void 0:n.length)&&(n[0].closable=(null==n?void 0:n.length)>1)},closeTabs:(e,l)=>{var n;const{tabs:s}=e,{payload:t}=l,a=s.findIndex((e=>e.key===t));if(a>=0&&s.splice(a,1),t===e.activeKey){let l="";l=0===a?(null==(n=null==s?void 0:s[a])?void 0:n.key)||"":s[a-1].key,e.activeKey=l,e.isLock=!0}(null==s?void 0:s.length)&&(s[0].closable=(null==s?void 0:s.length)>1)},closeTabGoNext:(e,l)=>{const{tabs:n}=e,{payload:s}=l,{key:t,nextPath:a}=s,o=n.findIndex((e=>e.key===t));o>=0&&n.splice(o,1),t===e.activeKey&&(e.activeKey=a,e.isLock=!0),(null==n?void 0:n.length)&&(n[0].closable=(null==n?void 0:n.length)>1)},closeLeft:(e,l)=>{const{tabs:n}=e,{payload:s}=l,t=n.findIndex((e=>e.key===s));t>=0&&n.splice(0,t),e.activeKey=n[0].key,(null==n?void 0:n.length)&&(n[0].closable=(null==n?void 0:n.length)>1)},closeRight:(e,l)=>{const{tabs:n}=e,{payload:s}=l,t=n.findIndex((e=>e.key===s));t>=0&&n.splice(t+1,n.length-t-1),e.activeKey=n[n.length-1].key,(null==n?void 0:n.length)&&(n[0].closable=(null==n?void 0:n.length)>1)},closeOther:(e,l)=>{const{tabs:n}=e,{payload:s}=l,t=n.find((e=>e.key===s));t&&(e.tabs=[t],e.activeKey=t.key,e.isLock=!0),n[0].closable=!1},closeAllTab:e=>{e.tabs=[]}}}),{toggleLock:k,toggleMaximize:j,setActiveKey:w,setNav:E,switchTabsLang:N,addTabs:L,closeTabs:K,closeTabGoNext:A,closeLeft:C,closeRight:S,closeOther:I,closeAllTab:T}=y.actions,P=y.reducer;function M(e){const l=Z(e),n=[];if(l.length>0&&n.push(l[0]),l.length>2){let e="/"+l[0];for(let s=1;s<l.length-1;s++)e+="/"+l[s],n.push(e)}return n}function R(e,l,n){const s=[],t=Z(l);let a=0;const o=t.length;for(let i=0;i<n.length;i++){const{path:l}=n[i];if((null==l?void 0:l[a])===t[a]&&(s.push("en"===e?n[i].labelEn:n[i].label),a<o-1&&a++),a===o)return s}return s}function Z(e){if(!e||"string"!=typeof e)return[];const l=(null==e?void 0:e.split("/"))||[];return""===(null==l?void 0:l[0])&&l.shift(),l}function _(e){var l,n,s,t,o;const{menus:i,permissions:r,value:c}=e;let{currentPath:u,result:d}=e;if(!(null==i?void 0:i.length)||!c)return[];u||(u=[]),d||(d=[]);const p=localStorage.getItem(a);for(let a=0;a<i.length;a++)if(G(i[a])){u.push({label:i[a].label,labelZh:i[a].label,labelEn:i[a].labelEn,path:Z(i[a].key)});const e=_({menus:i[a].children,permissions:r,value:c,currentPath:u,result:d});e.length?d.concat(e):u.pop()}else if(("en"===p&&(null==(s=null==(n=null==(l=i[a])?void 0:l.labelEn)?void 0:n.toLocaleUpperCase())?void 0:s.includes(null==c?void 0:c.toLocaleUpperCase()))||"en"!==p&&(null==(o=null==(t=i[a])?void 0:t.label)?void 0:o.includes(c)))&&D(i[a],r)){u.push({label:i[a].label,labelZh:i[a].label,labelEn:i[a].labelEn,path:Z(i[a].key)});const e=R(p,i[a].key,u),{label:l,labelEn:n,key:s}=i[a];d.push({label:l,labelEn:n,key:s,nav:e})}return d}function O(e){var l;const{menus:n,permissions:s,key:t}=e,o=localStorage.getItem(a);let{fatherNav:i,result:r}=e;if(!(null==n?void 0:n.length))return r;i||(i=[]),(null==r?void 0:r.key)||(r={key:"",label:"",labelZh:"",labelEn:"",nav:[]});for(let a=0;a<n.length;a++){if(!t||r.key)return r;const{label:e,labelEn:c,children:u}=n[a],d="en"===o?c:e;if(G(n[a])){i.push({label:d,labelZh:e,labelEn:c});const l=O({menus:u,permissions:s,key:t,fatherNav:i,result:r});(null==l?void 0:l.key)?r=l:i.pop()}else if((null==(l=n[a])?void 0:l.key)===t&&D(n[a],s)){const{key:l}=n[a];i.push({label:d,labelZh:e,labelEn:c}),l&&(r={label:e,labelZh:e,labelEn:c,key:l,nav:i})}}return r}function z(e,l){const n=[],s=JSON.parse(JSON.stringify(e)),t=localStorage.getItem(a);for(let a=0;a<s.length;a++){if(G(s[a])){const e=z(s[a].children,l);s[a].children=(null==e?void 0:e.length)?e:void 0}(D(s[a],l)||G(s[a]))&&("en"===t&&(s[a].label=s[a].labelEn),n.push(s[a]))}return n}function F(e,l,n=""){if(n)return n;for(let s=0;s<e.length;s++){if(G(e[s])&&!n){const t=F(e[s].children,l,n);if(t)return n=t}D(e[s],l)&&!G(e[s])&&(n=e[s].key)}return n}function U(e){var l;const n=[];for(let s=0;s<(null==e?void 0:e.length);s++){const t=e[s];let a=[];(null==(l=t.children)?void 0:l.length)&&(a=U(t.children));const o={...t};(null==a?void 0:a.length)&&(o.children=a),delete o.labelEn,n.push(o)}return n}function $(e){const l=[];for(let n=0;n<(null==e?void 0:e.length);n++){const s=e[n];l.push({label:s,labelZh:s,labelEn:s})}return l}function D(e,l){return null==l?void 0:l.includes((null==e?void 0:e.rule)||"")}function G(e){var l;return Boolean(null==(l=e.children)?void 0:l.length)}function q(s){const{list:a,active:o,onCancel:u,changActive:d}=s,{t:p,i18n:h}=r(),{permissions:m,menuList:v}=i(),x=c(),g=t(),b=h.language;return e.jsxs(e.Fragment,{children:[!(null==a?void 0:a.length)&&e.jsxs("div",{className:"flex flex-col items-center pt-5 text-warm-gray-400",children:[e.jsx(n,{className:"text-40px",icon:"mdi:archive-cancel-outline"}),e.jsx("span",{className:"mt-1",children:p("public.notSearchContent")})]}),(null==a?void 0:a.length)>0&&e.jsx("div",{className:"mt-5",children:null==a?void 0:a.map((s=>{var t;return e.jsxs("div",{className:`\n                h-56px\n                mt-8px\n                px-14px\n                rounded-4px\n                cursor-pointer\n                flex\n                items-center\n                justify-between\n                shadow-md\n                border\n                border-light-500\n                ${o===s.key?"bg-blue-500 text-white":""}\n              `,onClick:()=>(e=>{x(e);const l=O({menus:v,permissions:m,key:e});g(L(l)),g(w(e));const n=M(e);g(f(n)),u()})(s.key),onMouseEnter:()=>{return e=s.key,void d(e);var e},children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(n,{className:"text-lg mr-1",icon:"gg:menu-boxed"}),s.nav&&(null==(t=s.nav)?void 0:t.length)>0&&s.nav.map(((n,s)=>e.jsxs(l.Fragment,{children:[s>0&&e.jsx("span",{className:"mx-5px",children:">"}),e.jsx("span",{children:n})]},n))),!s.nav&&e.jsx("span",{children:"en"===b?s.labelEn:s.label})]}),e.jsx(n,{className:"icon text-20px p-2px mr-5px",icon:"ant-design:enter-outlined"})]},s.key)}))})]})}const B={icon:"_icon_1eshe_1"};function J(){const{t:l}=r();return e.jsxs("div",{className:"flex items-center text-dark-50",children:[e.jsxs("span",{className:"mr-14px flex items-center",children:[e.jsx(n,{className:`${B.icon} text-20px p-2px mr-5px`,icon:"ant-design:enter-outlined"}),e.jsx("span",{children:l("public.confirm")})]}),e.jsxs("span",{className:"mr-14px flex items-center",children:[e.jsx(n,{className:`${B.icon} text-20px p-2px mr-5px`,icon:"mdi-arrow-up-thin"}),e.jsx(n,{className:`${B.icon} text-20px p-2px mr-5px`,icon:"mdi-arrow-down-thin"}),e.jsx("span",{children:l("public.switch")})]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(n,{className:`${B.icon} text-20px p-2px mr-5px`,icon:"mdi:keyboard-esc"}),e.jsx("span",{children:l("public.close")})]})]})}function H(a){const o=c(),p=l.useRef(null),{modalRef:h}=a,{t:m}=r(),{permissions:v,menuList:x}=i(),[g,b]=l.useState(""),[y,k]=l.useState(""),[j,E]=l.useState([]),[N,K]=l.useState(!1),A=t();l.useImperativeHandle(h,(()=>({toggle:()=>{K(!N)}}))),l.useLayoutEffect((()=>(N&&setTimeout((()=>{var e;null==(e=p.current)||e.focus({cursor:"end"})}),0),()=>{b(""),k(""),E([])})),[N]);const C=()=>{K(!1)},S=()=>{if(y){o(y);const e=O({menus:x,permissions:v,key:y});A(L(e)),A(w(y));const l=M(y);A(f(l)),C()}},I=s((e=>{var l;const n=_({menus:x,permissions:v,value:e});(null==n?void 0:n.length)?(k((null==(l=null==n?void 0:n[0])?void 0:l.key)||""),E(n)):(k(""),E([]))}),{wait:200}),[T]=(P={ArrowUp:()=>{if(!j.length)return null;const e=j.findIndex((e=>e.key===y));if(0===e)return null;const l=j[e-1].key;k(l)},ArrowDown:()=>{if(!j.length)return null;const e=j.length-1,l=j.findIndex((e=>e.key===y));if(l===e)return null;const n=j[l+1].key;k(n)},Enter:S},[e=>{var l,n,s,t,a;switch(e.key){case"ArrowUp":null==(l=P.ArrowUp)||l.call(P);break;case"ArrowDown":null==(n=P.ArrowDown)||n.call(P);break;case"ArrowLeft":null==(s=P.ArrowLeft)||s.call(P);break;case"ArrowRight":null==(t=P.ArrowRight)||t.call(P);break;case"Enter":null==(a=P.Enter)||a.call(P)}}]);var P;return l.useEffect((()=>{if(j.length)return window.addEventListener("keydown",T),()=>{window.removeEventListener("keydown",T)}}),[j,y,T]),e.jsxs(u,{className:"rounded-100px",open:N,closable:!1,onCancel:C,footer:e.jsx(J,{}),children:[e.jsx(d,{ref:p,value:g,placeholder:m("public.inputPleaseEnter"),allowClear:!0,prefix:e.jsx(n,{className:"text-lg text-warm-gray-400",icon:"ant-design:search-outlined"}),onChange:e=>{const{value:l}=e.target;b(l),I.run(l)},onPressEnter:S}),e.jsx(q,{list:j,active:y,onCancel:C,changActive:e=>{k(e)}})]})}function Q(){const{t:s}=r(),t=l.useRef(null);return e.jsxs(e.Fragment,{children:[e.jsx(p,{title:s("public.search"),children:e.jsx(n,{className:"flex items-center justify-center text-lg mr-3 cursor-pointer",icon:"uil-search",onClick:()=>{var e;null==(e=t.current)||e.toggle()}})}),e.jsx(H,{modalRef:t})]})}export{Q as G,x as a,Z as b,F as c,O as d,w as e,z as f,M as g,U as h,E as i,L as j,T as k,S as l,C as m,I as n,K as o,j as p,N as q,k as r,f as s,m as t,g as u,v,$ as w,A as x,b as y,P as z};
