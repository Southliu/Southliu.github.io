import{r as s,j as a}from"./react.981c89a4.js";import{a as z,u as M}from"./react-redux.013ca0b6.js";import{u as _,b as K}from"./components_Fullscreen.5c803250.js";import{c as x}from"./layouts.26760549.js";import{U as Q,D as X}from"./components_Buttons.ebec7860.js";import{B as O}from"./components_Content.1396454a.js";import{B as H}from"./components_Search.57568f1b.js";import{B as J}from"./components_Table.54f76119.js";import{B as W}from"./components_Pagination.cd27b53e.js";import{u as Y,a as Z}from"./react-router.c2da9238.js";import{I as ee,m as V,g as te}from"./antd.c52db168.js";import{c as N,I as w,r as I,g as ae,A as se,d as ne}from"./components_Business.0c4299c0.js";import{r as q}from"./react-activation.fd665b9e.js";import{g as oe,s as re,a as ce,h as ie,i as le,j as ue,u as me}from"./components_GlobalSearch.2deb09dd.js";import{B as de}from"./components_Form.3d2fbff8.js";import{S as pe}from"./components_Bottom.609f1833.js";function G(t){const n=N+t?`${t} - ${N}`:"";s.useEffect(()=>{document.title=n},[n]),q.useActivate(()=>{document.title=n})}function fe(t){return a.jsxs(a.Fragment,{children:[a.jsx(ee,{...t,placeholder:"请输入"}),a.jsx("div",{className:"mb-5px text-red",children:"注：标题不能含有敏感信息!"})]})}const ge=[{label:"用户名",name:"username",component:"Input"},{label:"标题",name:"title",component:"Input"}],he=t=>[{title:"ID",dataIndex:"id",width:400,fixed:"left"},{title:"用户名",dataIndex:"username",width:400,fixed:"left"},{title:"标题",dataIndex:"title",width:400},{title:"内容",dataIndex:"content",width:400},{title:"操作",dataIndex:"operate",width:200,fixed:"right",render:(n,d)=>t(n,d)}],xe=[{label:"用户名",name:"username",rules:w,component:"Input"},{label:"嵌套数据",name:["user","name","test"],rules:w,component:"Input"},{label:"标题",name:"title",rules:w,component:"customize",render:fe},{label:"内容",name:"content",component:"Editor"}];function ye(t){return I.get("/content/article/index",{params:t})}function be(t){return I.get(`/content/article/${t}`)}function Se(t){return I.post("/content/article",t)}function Ie(t,n){return I.put(`/content/article/${t}`,n)}function Pe(t){return I.delete(`/content/article/${t}`)}const E={page:1,pageSize:20};function Ke(){G("文章管理");const t=Y(),n=z(),d=s.useRef(null),{permissions:c}=_(),[l,i]=s.useState(!1),[y,p]=s.useState(E.page),[h,P]=s.useState(E.pageSize),[R,$]=s.useState(0),[j,k]=s.useState([]),b=M(r=>r.public.isRefreshPage),f="/content/article",m={page:x(`${f}/index`,c),create:x(`${f}/create`,c),update:x(`${f}/update`,c),delete:x(`${f}/delete`,c)},T=r=>{p(1),g({page:1,pageSize:h,...r})},g=s.useCallback(async r=>{try{i(!0);const{data:{data:e}}=await ye(r),{items:o,total:u}=e;$(u),k(o)}finally{i(!1)}},[]);s.useEffect(()=>{m.page&&!b&&g({...E})},[m.page]),s.useEffect(()=>{b&&(n(K(!1)),B())},[b]);const D=()=>{t("/content/article/option?type=create")},S=r=>{t(`/content/article/option?type=update&id=${r}`)},B=()=>{var o;const e={...((o=d.current)==null?void 0:o.getFieldsValue())||{},page:y,pageSize:h};g(e)},A=async r=>{try{i(!0);const{data:e}=await Pe(r);(e==null?void 0:e.code)===200&&(V.success((e==null?void 0:e.message)||"删除成功"),B())}finally{i(!1)}},F=(r,e)=>{var u;p(r),P(e);const o=(u=d.current)==null?void 0:u.getFieldsValue();g({...o,page:r,pageSize:e})},C=(r,e)=>a.jsxs(a.Fragment,{children:[m.update===!0&&a.jsx(Q,{className:"mr-5px",isLoading:l,onClick:()=>S(e.id)}),m.delete===!0&&a.jsx(X,{className:"mr-5px",isLoading:l,handleDelete:()=>A(e.id)})]});return a.jsx(O,{isPermission:m.page,children:a.jsxs(a.Fragment,{children:[a.jsx(H,{formRef:d,list:ge,data:E,isLoading:l,isCreate:m.create,onCreate:D,handleFinish:T}),a.jsx(J,{loading:l,columns:he(C),dataSource:j}),a.jsx(W,{disabled:l,current:y,pageSize:h,total:R,onChange:F})]})})}const $e=Array.from({length:20}).map((t,n)=>({key:n.toString(),title:`content${n+1}`,description:`description of content${n+1}`})),je=$e.filter(t=>Number(t.key)>10).map(t=>t.key),U={content:"<h4>初始化内容</h4>",transfer:je},L="/content/article";function Oe(){const{pathname:t,search:n}=Z(),d=t+n,c=ae(n,"id"),l=s.useRef(null),i=z(),[y,p]=s.useState(!1),[h,P]=s.useState(""),[R,$]=s.useState(U),{permissions:j,isCollapsed:k,isPhone:b}=_(),f="文章管理",m=`${se}${f}`,T=`${ne(c,f)}`;G(c?T:m);const g="/content/article",D={create:x(`${g}/create`,j),update:x(`${g}/update`,j)};s.useEffect(()=>{const e=oe(L);!b&&!k&&(i(re(e)),i(ce(L)))},[]);const S=s.useCallback((e=t)=>{if(e==="/")return;const o=c?T:m,u={label:o,key:d,nav:["内容管理","文章管理",o]};i(ie(u.key)),i(le(u.nav)),i(ue(u))},[c,t,n]);s.useEffect(()=>{S()},[S]),q.useActivate(()=>{S()}),s.useEffect(()=>{c?A(c):B()},[]);const B=()=>{P(""),$(U)},A=async e=>{try{P(e),p(!0);const{data:{data:o}}=await be(e);$(o)}finally{p(!1)}},F=()=>{var e;(e=l.current)==null||e.handleSubmit()},C=e=>{var o;(o=l.current)==null||o.handleReset(),e&&i(K(!0)),i(me({key:d,nextPath:L}))},r=async e=>{var o;try{p(!0);const u=()=>h?Ie(h,e):Se(e),{data:v}=await u();V.success((v==null?void 0:v.message)||"操作成功"),(o=l.current)==null||o.handleReset(),C(!0)}finally{p(!1)}};return a.jsx(O,{isPermission:c?D.update:D.create,children:a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"mb-50px",children:a.jsx(te,{spinning:y,children:a.jsx(de,{formRef:l,list:xe,data:R,labelCol:{span:5},handleFinish:r})})}),a.jsx(pe,{isLoading:y,goBack:()=>C(),handleSubmit:F})]})})}export{Ke as P,Oe as a,G as u};
