import{r as n,j as a}from"./react.ab566f72.js";import{a as N,u as Q}from"./react-redux.7715edfc.js";import{u as O,b as U}from"./components_Fullscreen.548d6423.js";import{c as x}from"./layouts.285bed3b.js";import{U as X,D as H}from"./components_Buttons.1286822e.js";import{B as K}from"./components_Content.67fac38b.js";import{B as J}from"./components_Search.68b927e1.js";import{B as W}from"./components_Table.9d12c2b5.js";import{B as Y}from"./components_Pagination.9418f1c2.js";import{u as Z,a as ee}from"./react-router.e8592fb4.js";import{I as te,m as M,g as ae}from"./antd.d195a08c.js";import{b as z,I as F,r as P,A as ne,c as se}from"./components_Business.a1227ce9.js";import{g as oe}from"./components_Count.86d84d70.js";import{r as V}from"./react-activation.8e58fa4c.js";import{g as re,s as ce,a as ie,h as le,i as ue,j as me,u as de}from"./components_GlobalSearch.43da730b.js";import{B as pe}from"./components_Form.f68ce3f4.js";import{S as fe}from"./components_Bottom.0da9126f.js";function q(t){const s=z+t?`${t} - ${z}`:"";n.useEffect(()=>{document.title=s},[s]),V.useActivate(()=>{document.title=s})}function G(t){return a.jsxs(a.Fragment,{children:[a.jsx(te,{...t,placeholder:"请输入"}),a.jsx("div",{className:"mb-5px text-red",children:"注：标题不能含有敏感信息!"})]})}const Ve=Object.freeze(Object.defineProperty({__proto__:null,default:G},Symbol.toStringTag,{value:"Module"})),ge=[{label:"用户名",name:"username",component:"Input"},{label:"标题",name:"title",component:"Input"}],he=t=>[{title:"ID",dataIndex:"id",width:400,fixed:"left"},{title:"用户名",dataIndex:"username",width:400,fixed:"left"},{title:"标题",dataIndex:"title",width:400},{title:"内容",dataIndex:"content",width:400},{title:"操作",dataIndex:"operate",width:200,fixed:"right",render:(s,d)=>t(s,d)}],xe=[{label:"用户名",name:"username",rules:F,component:"Input"},{label:"嵌套数据",name:["user","name","test"],rules:F,component:"Input"},{label:"标题",name:"title",rules:F,component:"customize",render:G},{label:"内容",name:"content",component:"Editor"}];function be(t){return P.get("/content/article/index",{params:t})}function ye(t){return P.get(`/content/article/${t}`)}function Se(t){return P.post("/content/article",t)}function je(t,s){return P.put(`/content/article/${t}`,s)}function Pe(t){return P.delete(`/content/article/${t}`)}const E={page:1,pageSize:20};function Ie(){q("文章管理");const t=Z(),s=N(),d=n.useRef(null),{permissions:c}=O(),[l,i]=n.useState(!1),[b,p]=n.useState(E.page),[h,I]=n.useState(E.pageSize),[R,$]=n.useState(0),[T,v]=n.useState([]),y=Q(r=>r.public.isRefreshPage),f="/content/article",m={page:x(`${f}/index`,c),create:x(`${f}/create`,c),update:x(`${f}/update`,c),delete:x(`${f}/delete`,c)},C=r=>{p(1),g({page:1,pageSize:h,...r})},g=n.useCallback(async r=>{try{i(!0);const{code:e,data:o}=await be(r);if(Number(e)===200){const{items:u,total:j}=o;$(j),v(u)}}finally{i(!1)}},[]);n.useEffect(()=>{m.page&&!y&&g({...E})},[m.page]),n.useEffect(()=>{y&&(s(U(!1)),_())},[y]);const D=()=>{t("/content/article/option?type=create")},S=r=>{t(`/content/article/option?type=update&id=${r}`)},_=()=>{var o;const e={...((o=d.current)==null?void 0:o.getFieldsValue())||{},page:b,pageSize:h};g(e)},k=async r=>{try{i(!0);const e=await Pe(r);(e==null?void 0:e.code)===200&&(M.success((e==null?void 0:e.message)||"删除成功"),_())}finally{i(!1)}},A=(r,e)=>{var u;p(r),I(e);const o=(u=d.current)==null?void 0:u.getFieldsValue();g({...o,page:r,pageSize:e})},B=(r,e)=>a.jsxs(a.Fragment,{children:[m.update===!0&&a.jsx(X,{className:"mr-5px",isLoading:l,onClick:()=>S(e.id)}),m.delete===!0&&a.jsx(H,{className:"mr-5px",isLoading:l,handleDelete:()=>k(e.id)})]});return a.jsx(K,{isPermission:m.page,children:a.jsxs(a.Fragment,{children:[a.jsx(J,{formRef:d,list:ge,data:E,isLoading:l,isCreate:m.create,onCreate:D,handleFinish:C}),a.jsx(W,{loading:l,columns:he(B),dataSource:T}),a.jsx(Y,{disabled:l,current:b,pageSize:h,total:R,onChange:A})]})})}const qe=Object.freeze(Object.defineProperty({__proto__:null,default:Ie},Symbol.toStringTag,{value:"Module"})),$e=Array.from({length:20}).map((t,s)=>({key:s.toString(),title:`content${s+1}`,description:`description of content${s+1}`})),Te=$e.filter(t=>Number(t.key)>10).map(t=>t.key),L={content:"<h4>初始化内容</h4>",transfer:Te},w="/content/article";function Ce(){const{pathname:t,search:s}=ee(),d=t+s,c=oe(s,"id"),l=n.useRef(null),i=N(),[b,p]=n.useState(!1),[h,I]=n.useState(""),[R,$]=n.useState(L),{permissions:T,isCollapsed:v,isPhone:y}=O(),f="文章管理",m=`${ne}${f}`,C=`${se(c,f)}`;q(c?C:m);const g="/content/article",D={create:x(`${g}/create`,T),update:x(`${g}/update`,T)};n.useEffect(()=>{const e=re(w);!y&&!v&&(i(ce(e)),i(ie(w)))},[]);const S=n.useCallback((e=t)=>{if(e==="/")return;const o=c?C:m,u={label:o,key:d,nav:["内容管理","文章管理",o]};i(le(u.key)),i(ue(u.nav)),i(me(u))},[c,t,s]);n.useEffect(()=>{S()},[S]),V.useActivate(()=>{S()}),n.useEffect(()=>{c?k(c):_()},[]);const _=()=>{I(""),$(L)},k=async e=>{try{I(e),p(!0);const{data:o}=await ye(e);$(o)}finally{p(!1)}},A=()=>{var e;(e=l.current)==null||e.handleSubmit()},B=e=>{var o;(o=l.current)==null||o.handleReset(),e&&i(U(!0)),i(de({key:d,nextPath:w}))},r=async e=>{var o;try{p(!0);const u=()=>h?je(h,e):Se(e),{data:j}=await u();M.success((j==null?void 0:j.message)||"操作成功"),(o=l.current)==null||o.handleReset(),B(!0)}finally{p(!1)}};return a.jsx(K,{isPermission:c?D.update:D.create,children:a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"mb-50px",children:a.jsx(ae,{spinning:b,children:a.jsx(pe,{formRef:l,list:xe,data:R,labelCol:{span:5},handleFinish:r})})}),a.jsx(fe,{isLoading:b,goBack:()=>B(),handleSubmit:A})]})})}const Ge=Object.freeze(Object.defineProperty({__proto__:null,default:Ce},Symbol.toStringTag,{value:"Module"}));export{Ve as C,qe as i,Ge as o,q as u};
