import{r as y}from"./react@18.2.0-9cdefec6.js";import{_ as J,e as P,a as V,q as te,m as D,d as re,b as fe,g as Ie,h as Ae,i as ge,k as xe,j as ve,c as Q}from"./@babel_runtime@7.19.0-130d17ca.js";import{w as H,y as Ue,z as Le,t as We}from"./rc-util@5.24.4_biqbaboplfbrettd7655fr4n2y-ae37cd3a.js";import{S as je}from"./async-validator@4.2.5-f1555ba6.js";import{j as _,F as He}from"./@ant-design_icons@4.7.0_biqbaboplfbrettd7655fr4n2y-770bcbdb.js";var q="RC_FORM_INTERNAL_HOOKS",k=function(){H(!1,"Can not find FormContext. Please make sure you wrap Field under Form.")},Y=y.createContext({getFieldValue:k,getFieldsValue:k,getFieldError:k,getFieldWarning:k,getFieldsError:k,isFieldsTouched:k,isFieldTouched:k,isFieldValidating:k,isFieldsValidating:k,resetFields:k,setFields:k,setFieldValue:k,setFieldsValue:k,validateFields:k,submit:k,getInternalHooks:function(){return k(),{dispatch:k,initEntityValue:k,registerField:k,useSubscribe:k,setInitialValues:k,destroyForm:k,setCallbacks:k,registerWatch:k,getFields:k,setValidateMessages:k,setPreserve:k,getInitialValue:k}}});function se(o){return o==null?[]:Array.isArray(o)?o:[o]}var T="'${name}' is not a valid ${type}",ke={default:"Validation error on field '${name}'",required:"'${name}' is required",enum:"'${name}' must be one of [${enum}]",whitespace:"'${name}' cannot be empty",date:{format:"'${name}' is invalid for format date",parse:"'${name}' could not be parsed as date",invalid:"'${name}' is invalid date"},types:{string:T,method:T,array:T,object:T,number:T,date:T,boolean:T,integer:T,float:T,regexp:T,email:T,url:T,hex:T},string:{len:"'${name}' must be exactly ${len} characters",min:"'${name}' must be at least ${min} characters",max:"'${name}' cannot be longer than ${max} characters",range:"'${name}' must be between ${min} and ${max} characters"},number:{len:"'${name}' must equal ${len}",min:"'${name}' cannot be less than ${min}",max:"'${name}' cannot be greater than ${max}",range:"'${name}' must be between ${min} and ${max}"},array:{len:"'${name}' must be exactly ${len} in length",min:"'${name}' cannot be less than ${min} in length",max:"'${name}' cannot be greater than ${max} in length",range:"'${name}' must be between ${min} and ${max} in length"},pattern:{mismatch:"'${name}' does not match pattern ${pattern}"}};function ne(o){return Array.isArray(o)?De(o):J(o)==="object"&&o!==null?_e(o):o}function _e(o){if(Object.getPrototypeOf(o)===Object.prototype){var a={};for(var r in o)a[r]=ne(o[r]);return a}return o}function De(o){return o.map(function(a){return ne(a)})}function O(o){return se(o)}function j(o,a){var r=Ue(o,a);return r}function W(o,a,r){var t=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,e=Le(o,a,r,t);return e}function Ve(o,a){var r={};return a.forEach(function(t){var e=j(o,t);r=W(r,t,e)}),r}function B(o,a){return o&&o.some(function(r){return Ne(r,a)})}function Pe(o){return J(o)==="object"&&o!==null&&Object.getPrototypeOf(o)===Object.prototype}function Re(o,a){var r=Array.isArray(o)?P(o):V({},o);return a&&Object.keys(a).forEach(function(t){var e=r[t],n=a[t],s=Pe(e)&&Pe(n);r[t]=s?Re(e,n||{}):ne(n)}),r}function ee(o){for(var a=arguments.length,r=new Array(a>1?a-1:0),t=1;t<a;t++)r[t-1]=arguments[t];return r.reduce(function(e,n){return Re(e,n)},o)}function Ne(o,a){return!o||!a||o.length!==a.length?!1:o.every(function(r,t){return a[t]===r})}function ze(o,a){if(o===a)return!0;if(!o&&a||o&&!a||!o||!a||J(o)!=="object"||J(a)!=="object")return!1;var r=Object.keys(o),t=Object.keys(a),e=new Set([].concat(r,t));return P(e).every(function(n){var s=o[n],c=a[n];return typeof s=="function"&&typeof c=="function"?!0:s===c})}function Ke(o){var a=arguments.length<=1?void 0:arguments[1];return a&&a.target&&J(a.target)==="object"&&o in a.target?a.target[o]:a}function be(o,a,r){var t=o.length;if(a<0||a>=t||r<0||r>=t)return o;var e=o[a],n=a-r;return n>0?[].concat(P(o.slice(0,r)),[e],P(o.slice(r,a)),P(o.slice(a+1,t))):n<0?[].concat(P(o.slice(0,a)),P(o.slice(a+1,r+1)),[e],P(o.slice(r+1,t))):o}var qe=je;function Ge(o,a){return o.replace(/\$\{\w+\}/g,function(r){var t=r.slice(2,-1);return a[t]})}var we="CODE_LOGIC_ERROR";function ue(o,a,r,t,e){return le.apply(this,arguments)}function le(){return le=te(D().mark(function o(a,r,t,e,n){var s,c,u,i,l,d,f,F,p;return D().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return s=V({},t),delete s.ruleIndex,s.validator&&(c=s.validator,s.validator=function(){try{return c.apply(void 0,arguments)}catch(m){return console.error(m),Promise.reject(we)}}),u=null,s&&s.type==="array"&&s.defaultField&&(u=s.defaultField,delete s.defaultField),i=new qe(re({},a,[s])),l=ee({},ke,e.validateMessages),i.messages(l),d=[],g.prev=9,g.next=12,Promise.resolve(i.validate(re({},a,r),V({},e)));case 12:g.next=17;break;case 14:g.prev=14,g.t0=g.catch(9),g.t0.errors&&(d=g.t0.errors.map(function(m,v){var b=m.message,w=b===we?l.default:b;return y.isValidElement(w)?y.cloneElement(w,{key:"error_".concat(v)}):w}));case 17:if(!(!d.length&&u)){g.next=22;break}return g.next=20,Promise.all(r.map(function(m,v){return ue("".concat(a,".").concat(v),m,u,e,n)}));case 20:return f=g.sent,g.abrupt("return",f.reduce(function(m,v){return[].concat(P(m),P(v))},[]));case 22:return F=V(V({},t),{},{name:a,enum:(t.enum||[]).join(", ")},n),p=d.map(function(m){return typeof m=="string"?Ge(m,F):m}),g.abrupt("return",p);case 25:case"end":return g.stop()}},o,null,[[9,14]])})),le.apply(this,arguments)}function Je(o,a,r,t,e,n){var s=o.join("."),c=r.map(function(l,d){var f=l.validator,F=V(V({},l),{},{ruleIndex:d});return f&&(F.validator=function(p,h,g){var m=!1,v=function(){for(var E=arguments.length,C=new Array(E),N=0;N<E;N++)C[N]=arguments[N];Promise.resolve().then(function(){H(!m,"Your validator function has already return a promise. `callback` will be ignored."),m||g.apply(void 0,C)})},b=f(p,h,v);m=b&&typeof b.then=="function"&&typeof b.catch=="function",H(m,"`callback` is deprecated. Please return a promise instead."),m&&b.then(function(){g()}).catch(function(w){g(w||" ")})}),F}).sort(function(l,d){var f=l.warningOnly,F=l.ruleIndex,p=d.warningOnly,h=d.ruleIndex;return!!f==!!p?F-h:f?1:-1}),u;if(e===!0)u=new Promise(function(){var l=te(D().mark(function d(f,F){var p,h,g;return D().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:p=0;case 1:if(!(p<c.length)){v.next=12;break}return h=c[p],v.next=5,ue(s,a,h,t,n);case 5:if(g=v.sent,!g.length){v.next=9;break}return F([{errors:g,rule:h}]),v.abrupt("return");case 9:p+=1,v.next=1;break;case 12:f([]);case 13:case"end":return v.stop()}},d)}));return function(d,f){return l.apply(this,arguments)}}());else{var i=c.map(function(l){return ue(s,a,l,t,n).then(function(d){return{errors:d,rule:l}})});u=(e?Be(i):Ye(i)).then(function(l){return Promise.reject(l)})}return u.catch(function(l){return l}),u}function Ye(o){return oe.apply(this,arguments)}function oe(){return oe=te(D().mark(function o(a){return D().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Promise.all(a).then(function(e){var n,s=(n=[]).concat.apply(n,P(e));return s}));case 1:case"end":return t.stop()}},o)})),oe.apply(this,arguments)}function Be(o){return ce.apply(this,arguments)}function ce(){return ce=te(D().mark(function o(a){var r;return D().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=0,e.abrupt("return",new Promise(function(n){a.forEach(function(s){s.then(function(c){c.errors.length&&n([c]),r+=1,r===a.length&&n([])})})}));case 2:case"end":return e.stop()}},o)})),ce.apply(this,arguments)}var Qe=["name"],I=[];function Ce(o,a,r,t,e,n){return typeof o=="function"?o(a,r,"source"in n?{source:n.source}:{}):t!==e}var he=function(o){Ie(r,o);var a=Ae(r);function r(t){var e;if(ge(this,r),e=a.call(this,t),e.state={resetCount:0},e.cancelRegisterFunc=null,e.mounted=!1,e.touched=!1,e.dirty=!1,e.validatePromise=null,e.prevValidating=void 0,e.errors=I,e.warnings=I,e.cancelRegister=function(){var u=e.props,i=u.preserve,l=u.isListField,d=u.name;e.cancelRegisterFunc&&e.cancelRegisterFunc(l,i,O(d)),e.cancelRegisterFunc=null},e.getNamePath=function(){var u=e.props,i=u.name,l=u.fieldContext,d=l.prefixName,f=d===void 0?[]:d;return i!==void 0?[].concat(P(f),P(i)):[]},e.getRules=function(){var u=e.props,i=u.rules,l=i===void 0?[]:i,d=u.fieldContext;return l.map(function(f){return typeof f=="function"?f(d):f})},e.refresh=function(){!e.mounted||e.setState(function(u){var i=u.resetCount;return{resetCount:i+1}})},e.triggerMetaEvent=function(u){var i=e.props.onMetaChange;i==null||i(V(V({},e.getMeta()),{},{destroy:u}))},e.onStoreChange=function(u,i,l){var d=e.props,f=d.shouldUpdate,F=d.dependencies,p=F===void 0?[]:F,h=d.onReset,g=l.store,m=e.getNamePath(),v=e.getValue(u),b=e.getValue(g),w=i&&B(i,m);switch(l.type==="valueUpdate"&&l.source==="external"&&v!==b&&(e.touched=!0,e.dirty=!0,e.validatePromise=null,e.errors=I,e.warnings=I,e.triggerMetaEvent()),l.type){case"reset":if(!i||w){e.touched=!1,e.dirty=!1,e.validatePromise=null,e.errors=I,e.warnings=I,e.triggerMetaEvent(),h==null||h(),e.refresh();return}break;case"remove":{if(f){e.reRender();return}break}case"setField":{if(w){var E=l.data;"touched"in E&&(e.touched=E.touched),"validating"in E&&!("originRCField"in E)&&(e.validatePromise=E.validating?Promise.resolve([]):null),"errors"in E&&(e.errors=E.errors||I),"warnings"in E&&(e.warnings=E.warnings||I),e.dirty=!0,e.triggerMetaEvent(),e.reRender();return}if(f&&!m.length&&Ce(f,u,g,v,b,l)){e.reRender();return}break}case"dependenciesUpdate":{var C=p.map(O);if(C.some(function(N){return B(l.relatedFields,N)})){e.reRender();return}break}default:if(w||(!p.length||m.length||f)&&Ce(f,u,g,v,b,l)){e.reRender();return}break}f===!0&&e.reRender()},e.validateRules=function(u){var i=e.getNamePath(),l=e.getValue(),d=Promise.resolve().then(function(){if(!e.mounted)return[];var f=e.props,F=f.validateFirst,p=F===void 0?!1:F,h=f.messageVariables,g=u||{},m=g.triggerName,v=e.getRules();m&&(v=v.filter(function(w){var E=w.validateTrigger;if(!E)return!0;var C=se(E);return C.includes(m)}));var b=Je(i,l,v,u,p,h);return b.catch(function(w){return w}).then(function(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:I;if(e.validatePromise===d){var E;e.validatePromise=null;var C=[],N=[];(E=w.forEach)===null||E===void 0||E.call(w,function(R){var $=R.rule.warningOnly,M=R.errors,U=M===void 0?I:M;$?N.push.apply(N,P(U)):C.push.apply(C,P(U))}),e.errors=C,e.warnings=N,e.triggerMetaEvent(),e.reRender()}}),b});return e.validatePromise=d,e.dirty=!0,e.errors=I,e.warnings=I,e.triggerMetaEvent(),e.reRender(),d},e.isFieldValidating=function(){return!!e.validatePromise},e.isFieldTouched=function(){return e.touched},e.isFieldDirty=function(){if(e.dirty||e.props.initialValue!==void 0)return!0;var u=e.props.fieldContext,i=u.getInternalHooks(q),l=i.getInitialValue;return l(e.getNamePath())!==void 0},e.getErrors=function(){return e.errors},e.getWarnings=function(){return e.warnings},e.isListField=function(){return e.props.isListField},e.isList=function(){return e.props.isList},e.isPreserve=function(){return e.props.preserve},e.getMeta=function(){e.prevValidating=e.isFieldValidating();var u={touched:e.isFieldTouched(),validating:e.prevValidating,errors:e.errors,warnings:e.warnings,name:e.getNamePath()};return u},e.getOnlyChild=function(u){if(typeof u=="function"){var i=e.getMeta();return V(V({},e.getOnlyChild(u(e.getControlled(),i,e.props.fieldContext))),{},{isFunction:!0})}var l=We(u);return l.length!==1||!y.isValidElement(l[0])?{child:l,isFunction:!1}:{child:l[0],isFunction:!1}},e.getValue=function(u){var i=e.props.fieldContext.getFieldsValue,l=e.getNamePath();return j(u||i(!0),l)},e.getControlled=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=e.props,l=i.trigger,d=i.validateTrigger,f=i.getValueFromEvent,F=i.normalize,p=i.valuePropName,h=i.getValueProps,g=i.fieldContext,m=d!==void 0?d:g.validateTrigger,v=e.getNamePath(),b=g.getInternalHooks,w=g.getFieldsValue,E=b(q),C=E.dispatch,N=e.getValue(),R=h||function(S){return re({},p,S)},$=u[l],M=V(V({},u),R(N));M[l]=function(){e.touched=!0,e.dirty=!0,e.triggerMetaEvent();for(var S,z=arguments.length,A=new Array(z),L=0;L<z;L++)A[L]=arguments[L];f?S=f.apply(void 0,A):S=Ke.apply(void 0,[p].concat(A)),F&&(S=F(S,N,w(!0))),C({type:"updateValue",namePath:v,value:S}),$&&$.apply(void 0,A)};var U=se(m||[]);return U.forEach(function(S){var z=M[S];M[S]=function(){z&&z.apply(void 0,arguments);var A=e.props.rules;A&&A.length&&C({type:"validateField",namePath:v,triggerName:S})}}),M},t.fieldContext){var n=t.fieldContext.getInternalHooks,s=n(q),c=s.initEntityValue;c(xe(e))}return e}return ve(r,[{key:"componentDidMount",value:function(){var e=this.props,n=e.shouldUpdate,s=e.fieldContext;if(this.mounted=!0,s){var c=s.getInternalHooks,u=c(q),i=u.registerField;this.cancelRegisterFunc=i(this)}n===!0&&this.reRender()}},{key:"componentWillUnmount",value:function(){this.cancelRegister(),this.triggerMetaEvent(!0),this.mounted=!1}},{key:"reRender",value:function(){!this.mounted||this.forceUpdate()}},{key:"render",value:function(){this.state.resetCount;var e=this.props.children,n=this.getOnlyChild(e),s=n.child,c=n.isFunction,u;return c?u=s:y.isValidElement(s)?u=y.cloneElement(s,this.getControlled(s.props)):(H(!s,"`children` of Field is not validate ReactElement."),u=s),_(He,{children:u})}}]),r}(y.Component);he.contextType=Y;he.defaultProps={trigger:"onChange",valuePropName:"value"};function $e(o){var a=o.name,r=fe(o,Qe),t=y.useContext(Y),e=a!==void 0?O(a):void 0,n="keep";return r.isListField||(n="_".concat((e||[]).join("_"))),_(he,{name:e,...r,fieldContext:t},n)}var Xe=y.createContext(null),Ze=function(a){var r=a.name,t=a.initialValue,e=a.children,n=a.rules,s=a.validateTrigger,c=y.useContext(Y),u=y.useRef({keys:[],id:0}),i=u.current,l=y.useMemo(function(){var p=O(c.prefixName)||[];return[].concat(P(p),P(O(r)))},[c.prefixName,r]),d=y.useMemo(function(){return V(V({},c),{},{prefixName:l})},[c,l]),f=y.useMemo(function(){return{getKey:function(h){var g=l.length,m=h[g];return[i.keys[m],h.slice(g+1)]}}},[l]);if(typeof e!="function")return H(!1,"Form.List only accepts function as children."),null;var F=function(h,g,m){var v=m.source;return v==="internal"?!1:h!==g};return _(Xe.Provider,{value:f,children:_(Y.Provider,{value:d,children:_($e,{name:[],shouldUpdate:F,rules:n,validateTrigger:s,initialValue:t,isList:!0,children:function(p,h){var g=p.value,m=g===void 0?[]:g,v=p.onChange,b=c.getFieldValue,w=function(){var R=b(l||[]);return R||[]},E={add:function(R,$){var M=w();$>=0&&$<=M.length?(i.keys=[].concat(P(i.keys.slice(0,$)),[i.id],P(i.keys.slice($))),v([].concat(P(M.slice(0,$)),[R],P(M.slice($))))):(i.keys=[].concat(P(i.keys),[i.id]),v([].concat(P(M),[R]))),i.id+=1},remove:function(R){var $=w(),M=new Set(Array.isArray(R)?R:[R]);M.size<=0||(i.keys=i.keys.filter(function(U,S){return!M.has(S)}),v($.filter(function(U,S){return!M.has(S)})))},move:function(R,$){if(R!==$){var M=w();R<0||R>=M.length||$<0||$>=M.length||(i.keys=be(i.keys,R,$),v(be(M,R,$)))}}},C=m||[];return Array.isArray(C)||(C=[]),e(C.map(function(N,R){var $=i.keys[R];return $===void 0&&(i.keys[R]=i.id,$=i.keys[R],i.id+=1),{name:R,key:$,isListField:!0}}),E,h)}})})})};function er(o){var a=!1,r=o.length,t=[];return o.length?new Promise(function(e,n){o.forEach(function(s,c){s.catch(function(u){return a=!0,u}).then(function(u){r-=1,t[c]=u,!(r>0)&&(a&&n(t),e(t))})})}):Promise.resolve([])}var Me="__@field_split__";function ae(o){return o.map(function(a){return"".concat(J(a),":").concat(a)}).join(Me)}var G=function(){function o(){ge(this,o),this.kvs=new Map}return ve(o,[{key:"set",value:function(r,t){this.kvs.set(ae(r),t)}},{key:"get",value:function(r){return this.kvs.get(ae(r))}},{key:"update",value:function(r,t){var e=this.get(r),n=t(e);n?this.set(r,n):this.delete(r)}},{key:"delete",value:function(r){this.kvs.delete(ae(r))}},{key:"map",value:function(r){return P(this.kvs.entries()).map(function(t){var e=Q(t,2),n=e[0],s=e[1],c=n.split(Me);return r({key:c.map(function(u){var i=u.match(/^([^:]*):(.*)$/),l=Q(i,3),d=l[1],f=l[2];return d==="number"?Number(f):f}),value:s})})}},{key:"toJSON",value:function(){var r={};return this.map(function(t){var e=t.key,n=t.value;return r[e.join(".")]=n,null}),r}}]),o}(),rr=["name","errors"],tr=ve(function o(a){var r=this;ge(this,o),this.formHooked=!1,this.forceRootUpdate=void 0,this.subscribable=!0,this.store={},this.fieldEntities=[],this.initialValues={},this.callbacks={},this.validateMessages=null,this.preserve=null,this.lastValidatePromise=null,this.getForm=function(){return{getFieldValue:r.getFieldValue,getFieldsValue:r.getFieldsValue,getFieldError:r.getFieldError,getFieldWarning:r.getFieldWarning,getFieldsError:r.getFieldsError,isFieldsTouched:r.isFieldsTouched,isFieldTouched:r.isFieldTouched,isFieldValidating:r.isFieldValidating,isFieldsValidating:r.isFieldsValidating,resetFields:r.resetFields,setFields:r.setFields,setFieldValue:r.setFieldValue,setFieldsValue:r.setFieldsValue,validateFields:r.validateFields,submit:r.submit,_init:!0,getInternalHooks:r.getInternalHooks}},this.getInternalHooks=function(t){return t===q?(r.formHooked=!0,{dispatch:r.dispatch,initEntityValue:r.initEntityValue,registerField:r.registerField,useSubscribe:r.useSubscribe,setInitialValues:r.setInitialValues,destroyForm:r.destroyForm,setCallbacks:r.setCallbacks,setValidateMessages:r.setValidateMessages,getFields:r.getFields,setPreserve:r.setPreserve,getInitialValue:r.getInitialValue,registerWatch:r.registerWatch}):(H(!1,"`getInternalHooks` is internal usage. Should not call directly."),null)},this.useSubscribe=function(t){r.subscribable=t},this.prevWithoutPreserves=null,this.setInitialValues=function(t,e){if(r.initialValues=t||{},e){var n,s=ee({},t,r.store);(n=r.prevWithoutPreserves)===null||n===void 0||n.map(function(c){var u=c.key;s=W(s,u,j(t,u))}),r.prevWithoutPreserves=null,r.updateStore(s)}},this.destroyForm=function(){var t=new G;r.getFieldEntities(!0).forEach(function(e){r.isMergedPreserve(e.isPreserve())||t.set(e.getNamePath(),!0)}),r.prevWithoutPreserves=t},this.getInitialValue=function(t){var e=j(r.initialValues,t);return t.length?ne(e):e},this.setCallbacks=function(t){r.callbacks=t},this.setValidateMessages=function(t){r.validateMessages=t},this.setPreserve=function(t){r.preserve=t},this.watchList=[],this.registerWatch=function(t){return r.watchList.push(t),function(){r.watchList=r.watchList.filter(function(e){return e!==t})}},this.notifyWatch=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];if(r.watchList.length){var e=r.getFieldsValue();r.watchList.forEach(function(n){n(e,t)})}},this.timeoutId=null,this.warningUnhooked=function(){},this.updateStore=function(t){r.store=t},this.getFieldEntities=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return t?r.fieldEntities.filter(function(e){return e.getNamePath().length}):r.fieldEntities},this.getFieldsMap=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=new G;return r.getFieldEntities(t).forEach(function(n){var s=n.getNamePath();e.set(s,n)}),e},this.getFieldEntitiesForNamePathList=function(t){if(!t)return r.getFieldEntities(!0);var e=r.getFieldsMap(!0);return t.map(function(n){var s=O(n);return e.get(s)||{INVALIDATE_NAME_PATH:O(n)}})},this.getFieldsValue=function(t,e){if(r.warningUnhooked(),t===!0&&!e)return r.store;var n=r.getFieldEntitiesForNamePathList(Array.isArray(t)?t:null),s=[];return n.forEach(function(c){var u,i="INVALIDATE_NAME_PATH"in c?c.INVALIDATE_NAME_PATH:c.getNamePath();if(!(!t&&((u=c.isListField)===null||u===void 0?void 0:u.call(c))))if(!e)s.push(i);else{var l="getMeta"in c?c.getMeta():null;e(l)&&s.push(i)}}),Ve(r.store,s.map(O))},this.getFieldValue=function(t){r.warningUnhooked();var e=O(t);return j(r.store,e)},this.getFieldsError=function(t){r.warningUnhooked();var e=r.getFieldEntitiesForNamePathList(t);return e.map(function(n,s){return n&&!("INVALIDATE_NAME_PATH"in n)?{name:n.getNamePath(),errors:n.getErrors(),warnings:n.getWarnings()}:{name:O(t[s]),errors:[],warnings:[]}})},this.getFieldError=function(t){r.warningUnhooked();var e=O(t),n=r.getFieldsError([e])[0];return n.errors},this.getFieldWarning=function(t){r.warningUnhooked();var e=O(t),n=r.getFieldsError([e])[0];return n.warnings},this.isFieldsTouched=function(){r.warningUnhooked();for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var s=e[0],c=e[1],u,i=!1;e.length===0?u=null:e.length===1?Array.isArray(s)?(u=s.map(O),i=!1):(u=null,i=s):(u=s.map(O),i=c);var l=r.getFieldEntities(!0),d=function(g){return g.isFieldTouched()};if(!u)return i?l.every(d):l.some(d);var f=new G;u.forEach(function(h){f.set(h,[])}),l.forEach(function(h){var g=h.getNamePath();u.forEach(function(m){m.every(function(v,b){return g[b]===v})&&f.update(m,function(v){return[].concat(P(v),[h])})})});var F=function(g){return g.some(d)},p=f.map(function(h){var g=h.value;return g});return i?p.every(F):p.some(F)},this.isFieldTouched=function(t){return r.warningUnhooked(),r.isFieldsTouched([t])},this.isFieldsValidating=function(t){r.warningUnhooked();var e=r.getFieldEntities();if(!t)return e.some(function(s){return s.isFieldValidating()});var n=t.map(O);return e.some(function(s){var c=s.getNamePath();return B(n,c)&&s.isFieldValidating()})},this.isFieldValidating=function(t){return r.warningUnhooked(),r.isFieldsValidating([t])},this.resetWithFieldInitialValue=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=new G,n=r.getFieldEntities(!0);n.forEach(function(u){var i=u.props.initialValue,l=u.getNamePath();if(i!==void 0){var d=e.get(l)||new Set;d.add({entity:u,value:i}),e.set(l,d)}});var s=function(i){i.forEach(function(l){var d=l.props.initialValue;if(d!==void 0){var f=l.getNamePath(),F=r.getInitialValue(f);if(F!==void 0)H(!1,"Form already set 'initialValues' with path '".concat(f.join("."),"'. Field can not overwrite it."));else{var p=e.get(f);if(p&&p.size>1)H(!1,"Multiple Field with path '".concat(f.join("."),"' set 'initialValue'. Can not decide which one to pick."));else if(p){var h=r.getFieldValue(f);(!t.skipExist||h===void 0)&&r.updateStore(W(r.store,f,P(p)[0].value))}}}})},c;t.entities?c=t.entities:t.namePathList?(c=[],t.namePathList.forEach(function(u){var i=e.get(u);if(i){var l;(l=c).push.apply(l,P(P(i).map(function(d){return d.entity})))}})):c=n,s(c)},this.resetFields=function(t){r.warningUnhooked();var e=r.store;if(!t){r.updateStore(ee({},r.initialValues)),r.resetWithFieldInitialValue(),r.notifyObservers(e,null,{type:"reset"}),r.notifyWatch();return}var n=t.map(O);n.forEach(function(s){var c=r.getInitialValue(s);r.updateStore(W(r.store,s,c))}),r.resetWithFieldInitialValue({namePathList:n}),r.notifyObservers(e,n,{type:"reset"}),r.notifyWatch(n)},this.setFields=function(t){r.warningUnhooked();var e=r.store,n=[];t.forEach(function(s){var c=s.name;s.errors;var u=fe(s,rr),i=O(c);n.push(i),"value"in u&&r.updateStore(W(r.store,i,u.value)),r.notifyObservers(e,[i],{type:"setField",data:s})}),r.notifyWatch(n)},this.getFields=function(){var t=r.getFieldEntities(!0),e=t.map(function(n){var s=n.getNamePath(),c=n.getMeta(),u=V(V({},c),{},{name:s,value:r.getFieldValue(s)});return Object.defineProperty(u,"originRCField",{value:!0}),u});return e},this.initEntityValue=function(t){var e=t.props.initialValue;if(e!==void 0){var n=t.getNamePath(),s=j(r.store,n);s===void 0&&r.updateStore(W(r.store,n,e))}},this.isMergedPreserve=function(t){var e=t!==void 0?t:r.preserve;return e!=null?e:!0},this.registerField=function(t){r.fieldEntities.push(t);var e=t.getNamePath();if(r.notifyWatch([e]),t.props.initialValue!==void 0){var n=r.store;r.resetWithFieldInitialValue({entities:[t],skipExist:!0}),r.notifyObservers(n,[t.getNamePath()],{type:"valueUpdate",source:"internal"})}return function(s,c){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];if(r.fieldEntities=r.fieldEntities.filter(function(d){return d!==t}),!r.isMergedPreserve(c)&&(!s||u.length>1)){var i=s?void 0:r.getInitialValue(e);if(e.length&&r.getFieldValue(e)!==i&&r.fieldEntities.every(function(d){return!Ne(d.getNamePath(),e)})){var l=r.store;r.updateStore(W(l,e,i,!0)),r.notifyObservers(l,[e],{type:"remove"}),r.triggerDependenciesUpdate(l,e)}}r.notifyWatch([e])}},this.dispatch=function(t){switch(t.type){case"updateValue":{var e=t.namePath,n=t.value;r.updateValue(e,n);break}case"validateField":{var s=t.namePath,c=t.triggerName;r.validateFields([s],{triggerName:c});break}}},this.notifyObservers=function(t,e,n){if(r.subscribable){var s=V(V({},n),{},{store:r.getFieldsValue(!0)});r.getFieldEntities().forEach(function(c){var u=c.onStoreChange;u(t,e,s)})}else r.forceRootUpdate()},this.triggerDependenciesUpdate=function(t,e){var n=r.getDependencyChildrenFields(e);return n.length&&r.validateFields(n),r.notifyObservers(t,n,{type:"dependenciesUpdate",relatedFields:[e].concat(P(n))}),n},this.updateValue=function(t,e){var n=O(t),s=r.store;r.updateStore(W(r.store,n,e)),r.notifyObservers(s,[n],{type:"valueUpdate",source:"internal"}),r.notifyWatch([n]);var c=r.triggerDependenciesUpdate(s,n),u=r.callbacks.onValuesChange;if(u){var i=Ve(r.store,[n]);u(i,r.getFieldsValue())}r.triggerOnFieldsChange([n].concat(P(c)))},this.setFieldsValue=function(t){r.warningUnhooked();var e=r.store;if(t){var n=ee(r.store,t);r.updateStore(n)}r.notifyObservers(e,null,{type:"valueUpdate",source:"external"}),r.notifyWatch()},this.setFieldValue=function(t,e){r.setFields([{name:t,value:e}])},this.getDependencyChildrenFields=function(t){var e=new Set,n=[],s=new G;r.getFieldEntities().forEach(function(u){var i=u.props.dependencies;(i||[]).forEach(function(l){var d=O(l);s.update(d,function(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Set;return f.add(u),f})})});var c=function u(i){var l=s.get(i)||new Set;l.forEach(function(d){if(!e.has(d)){e.add(d);var f=d.getNamePath();d.isFieldDirty()&&f.length&&(n.push(f),u(f))}})};return c(t),n},this.triggerOnFieldsChange=function(t,e){var n=r.callbacks.onFieldsChange;if(n){var s=r.getFields();if(e){var c=new G;e.forEach(function(i){var l=i.name,d=i.errors;c.set(l,d)}),s.forEach(function(i){i.errors=c.get(i.name)||i.errors})}var u=s.filter(function(i){var l=i.name;return B(t,l)});n(u,s)}},this.validateFields=function(t,e){r.warningUnhooked();var n=!!t,s=n?t.map(O):[],c=[];r.getFieldEntities(!0).forEach(function(l){if(n||s.push(l.getNamePath()),(e==null?void 0:e.recursive)&&n){var d=l.getNamePath();d.every(function(p,h){return t[h]===p||t[h]===void 0})&&s.push(d)}if(!(!l.props.rules||!l.props.rules.length)){var f=l.getNamePath();if(!n||B(s,f)){var F=l.validateRules(V({validateMessages:V(V({},ke),r.validateMessages)},e));c.push(F.then(function(){return{name:f,errors:[],warnings:[]}}).catch(function(p){var h,g=[],m=[];return(h=p.forEach)===null||h===void 0||h.call(p,function(v){var b=v.rule.warningOnly,w=v.errors;b?m.push.apply(m,P(w)):g.push.apply(g,P(w))}),g.length?Promise.reject({name:f,errors:g,warnings:m}):{name:f,errors:g,warnings:m}}))}}});var u=er(c);r.lastValidatePromise=u,u.catch(function(l){return l}).then(function(l){var d=l.map(function(f){var F=f.name;return F});r.notifyObservers(r.store,d,{type:"validateFinish"}),r.triggerOnFieldsChange(d,l)});var i=u.then(function(){return r.lastValidatePromise===u?Promise.resolve(r.getFieldsValue(s)):Promise.reject([])}).catch(function(l){var d=l.filter(function(f){return f&&f.errors.length});return Promise.reject({values:r.getFieldsValue(s),errorFields:d,outOfDate:r.lastValidatePromise!==u})});return i.catch(function(l){return l}),i},this.submit=function(){r.warningUnhooked(),r.validateFields().then(function(t){var e=r.callbacks.onFinish;if(e)try{e(t)}catch(n){console.error(n)}}).catch(function(t){var e=r.callbacks.onFinishFailed;e&&e(t)})},this.forceRootUpdate=a});function Oe(o){var a=y.useRef(),r=y.useState({}),t=Q(r,2),e=t[1];if(!a.current)if(o)a.current=o;else{var n=function(){e({})},s=new tr(n);a.current=s.getForm()}return[a.current]}var de=y.createContext({triggerFormChange:function(){},triggerFormFinish:function(){},registerForm:function(){},unregisterForm:function(){}}),nr=function(a){var r=a.validateMessages,t=a.onFormChange,e=a.onFormFinish,n=a.children,s=y.useContext(de),c=y.useRef({});return _(de.Provider,{value:V(V({},s),{},{validateMessages:V(V({},s.validateMessages),r),triggerFormChange:function(i,l){t&&t(i,{changedFields:l,forms:c.current}),s.triggerFormChange(i,l)},triggerFormFinish:function(i,l){e&&e(i,{values:l,forms:c.current}),s.triggerFormFinish(i,l)},registerForm:function(i,l){i&&(c.current=V(V({},c.current),{},re({},i,l))),s.registerForm(i,l)},unregisterForm:function(i){var l=V({},c.current);delete l[i],c.current=l,s.unregisterForm(i)}}),children:n})},ir=["name","initialValues","fields","form","preserve","children","component","validateMessages","validateTrigger","onValuesChange","onFieldsChange","onFinish","onFinishFailed"],ar=function(a,r){var t=a.name,e=a.initialValues,n=a.fields,s=a.form,c=a.preserve,u=a.children,i=a.component,l=i===void 0?"form":i,d=a.validateMessages,f=a.validateTrigger,F=f===void 0?"onChange":f,p=a.onValuesChange,h=a.onFieldsChange,g=a.onFinish,m=a.onFinishFailed,v=fe(a,ir),b=y.useContext(de),w=Oe(s),E=Q(w,1),C=E[0],N=C.getInternalHooks(q),R=N.useSubscribe,$=N.setInitialValues,M=N.setCallbacks,U=N.setValidateMessages,S=N.setPreserve,z=N.destroyForm;y.useImperativeHandle(r,function(){return C}),y.useEffect(function(){return b.registerForm(t,C),function(){b.unregisterForm(t)}},[b,C,t]),U(V(V({},b.validateMessages),d)),M({onValuesChange:p,onFieldsChange:function(x){if(b.triggerFormChange(t,x),h){for(var K=arguments.length,ye=new Array(K>1?K-1:0),Z=1;Z<K;Z++)ye[Z-1]=arguments[Z];h.apply(void 0,[x].concat(ye))}},onFinish:function(x){b.triggerFormFinish(t,x),g&&g(x)},onFinishFailed:m}),S(c);var A=y.useRef(null);$(e,!A.current),A.current||(A.current=!0),y.useEffect(function(){return z},[]);var L,me=typeof u=="function";if(me){var Se=C.getFieldsValue(!0);L=u(Se,C)}else L=u;R(!me);var pe=y.useRef();y.useEffect(function(){ze(pe.current||[],n||[])||C.setFields(n||[]),pe.current=n},[n,C]);var Te=y.useMemo(function(){return V(V({},C),{},{validateTrigger:F})},[C,F]),Fe=_(Y.Provider,{value:Te,children:L});return l===!1?Fe:_(l,{...v,onSubmit:function(x){x.preventDefault(),x.stopPropagation(),C.submit()},onReset:function(x){var K;x.preventDefault(),C.resetFields(),(K=v.onReset)===null||K===void 0||K.call(v,x)},children:Fe})};function Ee(o){try{return JSON.stringify(o)}catch{return Math.random()}}function sr(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=arguments.length>1?arguments[1]:void 0,r=y.useState(),t=Q(r,2),e=t[0],n=t[1],s=y.useMemo(function(){return Ee(e)},[e]),c=y.useRef(s);c.current=s;var u=y.useContext(Y),i=a||u,l=i&&i._init,d=O(o),f=y.useRef(d);return f.current=d,y.useEffect(function(){if(!!l){var F=i.getFieldsValue,p=i.getInternalHooks,h=p(q),g=h.registerWatch,m=g(function(b){var w=j(b,f.current),E=Ee(w);c.current!==E&&(c.current=E,n(w))}),v=j(F(),f.current);return n(v),m}},[]),e}var ur=y.forwardRef(ar),X=ur;X.FormProvider=nr;X.Field=$e;X.List=Ze;X.useForm=Oe;X.useWatch=sr;export{Y as C,nr as F,Xe as L,X as R,$e as W,Ze as a,sr as b,Oe as u};
