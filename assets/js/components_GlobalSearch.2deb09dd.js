import{j as a,r as m}from"./react.981c89a4.js";import{I as p}from"./@iconify_react.d009e835.js";import{u as q}from"./ahooks.ef7fba82.js";import{a as C}from"./react-redux.013ca0b6.js";import{c as L}from"./@reduxjs_toolkit.a647311b.js";import{u as R}from"./components_Fullscreen.5c803250.js";import{u as T}from"./react-router.c2da9238.js";import{M as H,I as Q,T as W}from"./antd.c52db168.js";const X=[{label:"系统管理",key:"system",icon:"ion:settings-outline",children:[{label:"用户管理",key:"/system/user",rule:"/authority/user"},{label:"菜单管理",key:"/system/menu",rule:"/authority/menu"}]}],Y=[{label:"组件",key:"demo",icon:"fluent:box-20-regular",children:[{label:"剪切板",key:"/demo/copy",rule:"/demo/copy"},{label:"水印",key:"/demo/watermark",rule:"/demo/watermark"},{label:"虚拟滚动",key:"/demo/virtualScroll",rule:"/demo/virtualScroll"},{label:"富文本",key:"/demo/editor",rule:"/demo/editor"},{label:"层级1",key:"/demo/level1",children:[{label:"层级2",key:"/demo/level1/level2",children:[{label:"层级3",key:"/demo/level1/level2/level3",rule:"/demo/watermark"}]}]}]}],Z=[{label:"内容管理",key:"content",icon:"majesticons:article-search-line",children:[{label:"文章管理",key:"/content/article",rule:"/content/article"}]}],S=[{label:"仪表盘",key:"dashboard",icon:"la:tachometer-alt",children:[{label:"数据总览",key:"/dashboard",rule:"/dashboard"}]},...Y,...X,...Z];function E(s){const e=j(s),n=[];if(e.length>0&&n.push(e[0]),e.length>2){let l="/"+e[0];for(let t=1;t<e.length-1;t++)l+="/"+e[t],n.push(l)}return n}function V(s,e){const n=[],l=j(s);let t=0;const c=l.length;for(let r=0;r<e.length;r++){const{path:o}=e[r];if((o==null?void 0:o[t])===l[t]&&(n.push(e[r].label),t<c-1&&t++),t===c)return n}return n}function j(s){if(!s||typeof s!="string")return[];const e=(s==null?void 0:s.split("/"))||[];return(e==null?void 0:e[0])===""&&e.shift(),e}function D(s){var r,o;const{menus:e,permissions:n,value:l}=s;let{currentPath:t,result:c}=s;if(!(e!=null&&e.length)||!l)return[];t||(t=[]),c||(c=[]);for(let i=0;i<e.length;i++)if(v(e[i])){t.push({label:e[i].label,path:j(e[i].key)});const u={menus:e[i].children,permissions:n,value:l,currentPath:t,result:c},d=D(u);d.length?c.concat(d):t.pop()}else if((o=(r=e[i])==null?void 0:r.label)!=null&&o.includes(l)&&K(e[i],n)){t.push({label:e[i].label,path:j(e[i].key)});const u=V(e[i].key,t),{label:d,key:y}=e[i];c.push({label:d,key:y,nav:u})}return c}function P(s){var r;const{menus:e,permissions:n,key:l}=s;let{fatherNav:t,result:c}=s;if(!(e!=null&&e.length))return c;t||(t=[]),c!=null&&c.key||(c={key:"",label:"",nav:[]});for(let o=0;o<e.length;o++){if(!l||c.key)return c;if(v(e[o])){t.push(e[o].label);const i={menus:e[o].children,permissions:n,key:l,fatherNav:t,result:c},u=P(i);u!=null&&u.key?c=u:t.pop()}else if(((r=e[o])==null?void 0:r.key)===l&&K(e[o],n)){t.push(e[o].label);const{label:i,key:u}=e[o];u&&(c={label:i,key:u,nav:t})}}return c}function ee(s,e){const n=[],l=JSON.parse(JSON.stringify(s));for(let t=0;t<l.length;t++){if(v(l[t])){const c=ee(l[t].children,e);l[t].children=c!=null&&c.length?c:void 0}(K(l[t],e)||v(l[t]))&&n.push(l[t])}return n}function ne(s,e,n=""){if(n)return n;for(let l=0;l<s.length;l++){if(v(s[l])&&!n){const t=ne(s[l].children,e,n);if(t)return n=t,n}K(s[l],e)&&!v(s[l])&&(n=s[l].key)}return n}function K(s,e){return e==null?void 0:e.includes((s==null?void 0:s.rule)||"")}function v(s){var e;return!!((e=s.children)!=null&&e.length)}const I=L({name:"tabs",initialState:{isLock:!1,isMaximize:!1,activeKey:"",nav:[],tabs:[]},reducers:{toggleLock:(s,e)=>{s.isLock=!!e.payload},toggleMaximize:(s,e)=>{s.isMaximize=!!e.payload},setActiveKey:(s,e)=>{s.activeKey=e.payload},setNav:(s,e)=>{s.nav=e.payload},addTabs:(s,e)=>{const{tabs:n}=s,{payload:l}=e;n.find(c=>c.key===l.key)||n.push(l),n!=null&&n.length&&(n[0].closable=(n==null?void 0:n.length)>1)},closeTabs:(s,e)=>{var c;const{tabs:n}=s,{payload:l}=e,t=n.findIndex(r=>r.key===l);if(t>=0&&n.splice(t,1),l===s.activeKey){let r="";t===0?r=((c=n==null?void 0:n[t])==null?void 0:c.key)||"":r=n[t-1].key,s.activeKey=r,s.isLock=!0}n!=null&&n.length&&(n[0].closable=(n==null?void 0:n.length)>1)},closeTabGoNext:(s,e)=>{const{tabs:n}=s,{payload:l}=e,{key:t,nextPath:c}=l,r=n.findIndex(o=>o.key===t);r>=0&&n.splice(r,1),t===s.activeKey&&(s.activeKey=c,s.isLock=!0),n!=null&&n.length&&(n[0].closable=(n==null?void 0:n.length)>1)},closeLeft:(s,e)=>{const{tabs:n}=s,{payload:l}=e,t=n.findIndex(c=>c.key===l);t>=0&&n.splice(0,t),s.activeKey=n[0].key,n!=null&&n.length&&(n[0].closable=(n==null?void 0:n.length)>1)},closeRight:(s,e)=>{const{tabs:n}=s,{payload:l}=e,t=n.findIndex(c=>c.key===l);t>=0&&n.splice(t+1,n.length-t-1),s.activeKey=n[n.length-1].key,n!=null&&n.length&&(n[0].closable=(n==null?void 0:n.length)>1)},closeOther:(s,e)=>{const{tabs:n}=s,{payload:l}=e,t=n.find(c=>c.key===l);t&&(s.tabs=[t],s.activeKey=t.key,s.isLock=!0),n[0].closable=!1},closeAllTab:s=>{s.tabs=[]}}}),{toggleLock:xe,toggleMaximize:me,setActiveKey:O,setNav:pe,addTabs:B,closeTabs:ge,closeTabGoNext:ke,closeLeft:ve,closeRight:be,closeOther:we,closeAllTab:je}=I.actions,Ke=I.reducer,F=L({name:"menu",initialState:{isPhone:!1,isCollapsed:!1,selectedKeys:"dashboard",openKeys:["Dashboard"]},reducers:{toggleCollapsed:(s,e)=>{s.isCollapsed=!!e.payload},togglePhone:(s,e)=>{s.isPhone=!!e.payload},setSelectedKeys:(s,e)=>{s.selectedKeys=e.payload},setOpenKeys:(s,e)=>{s.openKeys=e.payload}}}),{toggleCollapsed:Ne,togglePhone:Ae,setSelectedKeys:Se,setOpenKeys:$}=F.actions,Pe=F.reducer;function se(s){return[n=>{var l,t,c,r,o;switch(n.key){case"ArrowUp":(l=s.ArrowUp)==null||l.call(s);break;case"ArrowDown":(t=s.ArrowDown)==null||t.call(s);break;case"ArrowLeft":(c=s.ArrowLeft)==null||c.call(s);break;case"ArrowRight":(r=s.ArrowRight)==null||r.call(s);break;case"Enter":(o=s.Enter)==null||o.call(s);break}}]}function te(s){const{list:e,active:n,onCancel:l,changActive:t}=s,{permissions:c}=R(),r=T(),o=C(),i=d=>{r(d);const g=P({menus:S,permissions:c,key:d});o(B(g)),o(O(d));const k=E(d);o($(k)),l()},u=d=>{t(d)};return a.jsxs(a.Fragment,{children:[!(e!=null&&e.length)&&a.jsxs("div",{className:"flex flex-col items-center pt-5 text-warm-gray-400",children:[a.jsx(p,{className:"text-40px",icon:"mdi:archive-cancel-outline"}),a.jsx("span",{className:"mt-1",children:"暂无搜索结构"})]}),(e==null?void 0:e.length)>0&&a.jsx("div",{className:"mt-5",children:e==null?void 0:e.map(d=>{var y;return a.jsxs("div",{className:`
                h-56px
                mt-8px
                px-14px
                rounded-4px
                cursor-pointer
                flex
                items-center
                justify-between
                shadow-md
                border
                border-light-500
                ${n===d.key?"bg-blue-500 text-white":""}
              `,onClick:()=>i(d.key),onMouseEnter:()=>u(d.key),children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(p,{className:"text-lg mr-1",icon:"gg:menu-boxed"}),d.nav&&((y=d.nav)==null?void 0:y.length)>0&&d.nav.map((g,k)=>a.jsxs(m.Fragment,{children:[k>0&&a.jsx("span",{className:"mx-5px",children:">"}),a.jsx("span",{children:g})]},g)),!d.nav&&a.jsx("span",{children:d.label})]}),a.jsx(p,{className:"icon text-20px p-2px mr-5px",icon:"ant-design:enter-outlined"})]},d.key)})})]})}const le="_icon_1eshe_1",w={icon:le};function ce(){return a.jsxs("div",{className:"flex items-center text-dark-50",children:[a.jsxs("span",{className:"mr-14px flex items-center",children:[a.jsx(p,{className:`${w.icon} text-20px p-2px mr-5px`,icon:"ant-design:enter-outlined"}),a.jsx("span",{children:"确认"})]}),a.jsxs("span",{className:"mr-14px flex items-center",children:[a.jsx(p,{className:`${w.icon} text-20px p-2px mr-5px`,icon:"mdi-arrow-up-thin"}),a.jsx(p,{className:`${w.icon} text-20px p-2px mr-5px`,icon:"mdi-arrow-down-thin"}),a.jsx("span",{children:"切换"})]}),a.jsxs("span",{className:"flex items-center",children:[a.jsx(p,{className:`${w.icon} text-20px p-2px mr-5px`,icon:"mdi:keyboard-esc"}),a.jsx("span",{children:"关闭"})]})]})}function oe(s){const e=T(),n=m.useRef(null),{modalRef:l}=s,{permissions:t}=R(),[c,r]=m.useState(""),[o,i]=m.useState(""),[u,d]=m.useState([]),[y,g]=m.useState(!1),k=C();m.useImperativeHandle(l,()=>({toggle:()=>{g(!y)}})),m.useLayoutEffect(()=>(y&&setTimeout(()=>{var h;(h=n.current)==null||h.focus({cursor:"end"})},0),()=>{r(""),i(""),d([])}),[y]);const z=h=>{i(h)},N=()=>{g(!1)},M=()=>{if(o){e(o);const x=P({menus:S,permissions:t,key:o});k(B(x)),k(O(o));const f=E(o);k($(f)),N()}},G=q(h=>{var b;const f=D({menus:S,permissions:t,value:h});f!=null&&f.length?(i(((b=f==null?void 0:f[0])==null?void 0:b.key)||""),d(f)):(i(""),d([]))},{wait:200}),U=h=>{const{value:x}=h.target;r(x),G.run(x)},_=()=>{if(!u.length)return null;const h=u.findIndex(f=>f.key===o);if(h===0)return null;const x=u[h-1].key;i(x)},J=()=>{if(!u.length)return null;const h=u.length-1,x=u.findIndex(b=>b.key===o);if(x===h)return null;const f=u[x+1].key;i(f)},[A]=se({ArrowUp:_,ArrowDown:J,Enter:M});return m.useEffect(()=>{if(u.length)return window.addEventListener("keydown",A),()=>{window.removeEventListener("keydown",A)}},[u,o,A]),a.jsxs(H,{className:"rounded-100px",open:y,closable:!1,onCancel:N,footer:a.jsx(ce,{}),children:[a.jsx(Q,{ref:n,value:c,placeholder:"请输入关键词搜索",allowClear:!0,prefix:a.jsx(p,{className:"text-lg text-warm-gray-400",icon:"ant-design:search-outlined"}),onChange:U,onPressEnter:M}),a.jsx(te,{list:u,active:o,onCancel:N,changActive:z})]})}function Me(){const s=m.useRef(null),e=()=>{var n;(n=s.current)==null||n.toggle()};return a.jsxs(a.Fragment,{children:[a.jsx(W,{title:"搜索",children:a.jsx(p,{className:"flex items-center justify-center text-lg mr-3 cursor-pointer",icon:"uil-search",onClick:e})}),a.jsx(oe,{modalRef:s})]})}export{Me as G,Se as a,j as b,ne as c,S as d,P as e,ee as f,E as g,O as h,pe as i,B as j,je as k,be as l,ve as m,we as n,ge as o,me as p,xe as q,Ae as r,$ as s,Ne as t,ke as u,Pe as v,Ke as w};
