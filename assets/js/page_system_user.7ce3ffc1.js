import{j as r,a as _,F}from"./components_Bottom.8e587700.js";import{r as a}from"./react.4fb287ef.js";import{I as w,S as me,r as y,A as K,d as ue}from"./components_Business.a738b39b.js";import{O as de}from"./components_Dates.a1071699.js";import{u as pe}from"./page_content_article.825bf483.js";import{a as fe}from"./react-redux.6833b3bd.js";import{c as g}from"./layouts.5d9d1eb3.js";import{U as he,D as ge}from"./components_Buttons.f49aeb21.js";import{s as ye,g as Se}from"./page_system_menu.68eccd5e.js";import{B as Ce}from"./components_Content.9295680e.js";import{B as Ie}from"./components_Search.a43e6943.js";import{B as be}from"./components_Modal.d91dd35f.js";import{B as Pe}from"./components_Form.fbc6bc54.js";import{B as De}from"./components_Table.a7c298d3.js";import{B as xe}from"./components_Pagination.1647659c.js";import{q as ke,r as Be,B as N,m as E}from"./antd.5aea764c.js";const Te=[{label:"年龄",name:"age",component:"InputNumber"},{label:"名字",name:"keyword",component:"Input"}],we=s=>[{title:"ID",dataIndex:"id",width:400,fixed:"left"},{title:"用户名",dataIndex:"username",width:400,fixed:"left"},{title:"姓名",dataIndex:"real_name",width:400},{title:"角色",dataIndex:"roles_name",width:400},{title:"手机号",dataIndex:"phone",width:400},{title:"状态",dataIndex:"status",width:200,render:o=>r("span",{children:o?"开启":"关闭"})},{title:"操作",dataIndex:"operate",width:200,fixed:"right",render:(o,i)=>s(o,i)}],Ee=[{label:"用户名",name:"username",rules:w,component:"Input"},{label:"姓名",name:"real_name",rules:w,component:"Input"},{label:"角色",name:"roles_name",rules:w,component:"Input"},{label:"状态",name:"status",rules:me,component:"Select",componentProps:{options:de}}];function Re(s){return y.get("/authority/user/index",{params:s})}function $e(s){return y.get(`/authority/user/${s}`)}function Le(s){return y.post("/authority/user",s)}function Ue(s,o){return y.put(`/authority/user/${s}`,o)}function _e(s){return y.delete(`/authority/user/${s}`)}function Fe(s){const{title:o,isVisible:i,treeData:c,checkedKeys:C,onClose:u,onSubmit:I}=s,[l,b]=a.useState(C);return r(ke,{open:i,title:o||"权限配置",placement:"right",extra:r(N,{type:"primary",onClick:()=>{I(l)},children:"提交"}),onClose:u,children:r(Be,{checkable:!0,checkedKeys:l,treeData:c,onCheck:k=>{b(k)}})})}const S={page:1,pageSize:20},O={status:1};function Ye(){pe("用户管理");const s=a.useRef(null),o=a.useRef(null),[i,c]=a.useState(!1),[C,u]=a.useState(!1),[I,l]=a.useState(!1),[b,P]=a.useState(K),[D,x]=a.useState(""),[k,R]=a.useState(O),[$,L]=a.useState(S.page),[B,V]=a.useState(S.pageSize),[j,z]=a.useState(0),[q,A]=a.useState([]),[Q,v]=a.useState(""),[M,T]=a.useState(!1),[G,H]=a.useState([]),[J,W]=a.useState([]),p=fe(e=>e.user.permissions),f="/authority/user",m={page:g(`${f}/index`,p),create:g(`${f}/create`,p),update:g(`${f}/update`,p),delete:g(`${f}/delete`,p),permission:g(`${f}/authority`,p)},X=e=>{L(1),h({page:1,pageSize:B,...e})},h=a.useCallback(async e=>{try{c(!0);const{data:{data:t}}=await Re(e),{items:n,total:d}=t;z(d),A(n)}finally{c(!1)}},[]);a.useEffect(()=>{m.page&&h({...S})},[h,m.page]);const Y=async e=>{try{c(!0);const t={userId:e},{data:n}=await Se(t),{data:{defaultCheckedKeys:d,treeData:le}}=n;v(e),W(le),H(Object.values(d)),T(!0)}finally{c(!1)}},Z=()=>{T(!1)},ee=async e=>{try{c(!0);const t={menuIds:e,userId:Q},{data:n}=await ye(t);E.success(n.message||"授权成功"),T(!1)}finally{c(!1)}},te=()=>{l(!0),P(K),x(""),R(O)},ae=async e=>{try{l(!0),P(ue(e)),x(e),u(!0);const{data:{data:t}}=await $e(e);R(t)}finally{u(!1)}},se=()=>{var e;(e=o.current)==null||e.handleSubmit()},ne=()=>{l(!1)},U=()=>{var n;const t={...((n=s.current)==null?void 0:n.getFieldsValue())||{},page:$,pageSize:B};h(t)},re=async e=>{try{u(!0);const t=()=>D?Ue(D,e):Le(e),{data:n}=await t();E.success((n==null?void 0:n.message)||"操作成功"),l(!1),U()}finally{u(!1)}},oe=async e=>{try{c(!0);const{data:t}=await _e(e);(t==null?void 0:t.code)===200&&(E.success((t==null?void 0:t.message)||"删除成功"),U())}finally{c(!1)}},ie=(e,t)=>{var d;L(e),V(t);const n=(d=s.current)==null?void 0:d.getFieldsValue();h({...n,page:e,pageSize:t})},ce=(e,t)=>_(F,{children:[m.permission===!0&&r(N,{className:"mr-2",loading:i,onClick:()=>Y(t.id),children:"权限"}),m.update===!0&&r(he,{className:"mr-5px",isLoading:i,onClick:()=>ae(t.id)}),m.delete===!0&&r(ge,{className:"mr-5px",isLoading:i,handleDelete:()=>oe(t.id)})]});return r(Ce,{isPermission:m.page,children:_(F,{children:[r(Ie,{formRef:s,list:Te,data:S,isLoading:i,isCreate:m.create,onCreate:te,handleFinish:X}),r(De,{loading:i,columns:we(ce),dataSource:q}),r(xe,{disabled:i,current:$,pageSize:B,total:j,onChange:ie}),r(be,{title:b,open:I,confirmLoading:C,onOk:se,onCancel:ne,children:r(Pe,{formRef:o,list:Ee,data:k,labelCol:{span:6},handleFinish:re})}),r(Fe,{isVisible:M,treeData:J,checkedKeys:G,onClose:Z,onSubmit:ee})]})})}export{Ye as P};
