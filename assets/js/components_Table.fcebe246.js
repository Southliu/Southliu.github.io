import{j as e,r as t}from"./react.a7da97a2.js";import{E as l}from"./components_Business.13a3a6ce.js";import{R as r}from"./react-resizable.98b97b0f.js";import{a as o}from"./ahooks.93e76957.js";import{j as n,k as i}from"./antd.850acb68.js";function s(e){switch(e){case"large":return 54;case"middle":return 46;default:return 38}}function c(e){for(let t=0;t<e.length;t++){const r=e[t];void 0===r.ellipsis&&(r.ellipsis=!0),r.render||(r.render=e=>e||(0===e?e:l))}return e}function a(t){const{onResize:l,width:o,...n}=t;return o?e.jsx(r,{width:o,height:0,handle:e.jsx("span",{className:"react-resizable-handle",onClick:e=>{e.stopPropagation()}}),onResize:l,draggableOpts:{enableUserSelectHack:!1},children:e.jsx("th",{...n})}):e.jsx("th",{...n})}function u(e,t){switch(t.type){case"changeScroll":let l=t.curScrollTop||0,r=t.scrollHeight||0;const o=t.tableScrollY||0;return r<=0&&(r=0),0!==r&&o===e.tableScrollY&&(r=e.scrollHeight),e.scrollHeight&&l>e.scrollHeight&&(l=e.scrollHeight),{...e,curScrollTop:l,scrollHeight:r,tableScrollY:o};case"reset":return{...e,curScrollTop:0,scrollHeight:0};default:throw new Error("表格：未知错误类型!")}}function d(e){return"number"==typeof e&&isFinite(e)}const h=t.createContext({dispatch:void 0,renderLen:1,start:0,offsetStart:0,rowHeight:46,totalLen:0});function g(l){const{children:r,...o}=l,{renderLen:n,start:i,offsetStart:s}=t.useContext(h);let c=null;if(r&&null!==r){const e=null==r?void 0:r[1];c=Array.isArray(e)&&e.length?[null==r?void 0:r[0],e.slice(i,i+n).map((e=>Array.isArray(e)?e[0]:e))]:r}return e.jsx("tbody",{...o,style:{transform:`translateY(-${s}px)`},children:c})}const p={rowHeight:38,curScrollTop:0,scrollHeight:0,tableScrollY:0};let f=0;function v(l){var r,n,i,s,c;const{style:a,children:g,...v}=l,{width:m,...w}=a,[H,b]=t.useReducer(u,p),S=t.useRef(null),y=t.useRef(null),[x,j]=t.useState((null==(i=null==(n=null==(r=null==g?void 0:g[2])?void 0:r.props)?void 0:n.data)?void 0:i.length)??0);t.useEffect((()=>{var e,t,l,r,o,n;d(null==(l=null==(t=null==(e=null==g?void 0:g[1])?void 0:e.props)?void 0:t.data)?void 0:l.length)&&j(null==(n=null==(o=null==(r=null==g?void 0:g[1])?void 0:r.props)?void 0:o.data)?void 0:n.length)}),[g]);const T=t.useMemo((()=>{let e="auto";return H.rowHeight&&x&&(e=H.rowHeight*x),e}),[H.rowHeight,x]);let z=0;z="string"==typeof f?null==(c=null==(s=S.current)?void 0:s.parentNode)?void 0:c.offsetHeight:f,d(T)&&Number(T)<z&&(z=T),z<=0&&(z=0);const R=t.useMemo((()=>{let e=1;if(H.rowHeight&&x&&z)if(z<=0)e=0;else{const t=5+(z/H.rowHeight|0);e=t>x?x:t}return e}),[H.rowHeight,x,z]);let E=H.rowHeight?H.curScrollTop/H.rowHeight|0:0,N=H.rowHeight?H.curScrollTop%H.rowHeight:0;H.curScrollTop&&H.rowHeight&&H.curScrollTop>H.rowHeight?E>x-R?N=0:E>1&&(E-=1,N+=H.rowHeight):E=0,t.useEffect((()=>{var e;const t=null==(e=S.current)?void 0:e.parentNode;t&&(t.scrollTop=0),b({type:"reset"})}),[x]);const C=o((e=>{var t,l;const r=(null==(t=null==e?void 0:e.target)?void 0:t.scrollTop)??0;if(r!==H.curScrollTop){const t=(null==(l=null==e?void 0:e.target)?void 0:l.scrollHeight)-z;b({type:"changeScroll",curScrollTop:r,scrollHeight:t,tableScrollY:z})}}),{wait:60});return t.useEffect((()=>{var e;const t=null==(e=null==S?void 0:S.current)?void 0:e.parentNode;return t&&t.addEventListener("scroll",(e=>C.run(e))),()=>{t.removeEventListener("scroll",(e=>C.run(e)))}}),[S,H.curScrollTop,z,H.scrollHeight,C]),e.jsx("div",{className:"virtualTable",ref:S,style:{width:"100%",position:"relative",height:T,boxSizing:"border-box",paddingTop:H.curScrollTop},children:e.jsx(h.Provider,{value:{dispatch:b,rowHeight:H.rowHeight,start:E,offsetStart:N,renderLen:R,totalLen:x},children:e.jsx("table",{...v,ref:y,style:{...w,width:m,position:"relative"},children:g})})})}const m=t.memo((function(l){const{loading:r,isZebra:o,isBordered:u,isVirtual:d,scrollX:h,scrollY:m,rowClassName:w,size:H}=l,[b,S]=t.useState(c(l.columns)),y=t.useRef(null);t.useEffect((()=>{S(c(l.columns))}),[l.columns]);const x=function(e){var t,l;const r=document.documentElement.clientHeight||document.body.clientHeight,o=(null==(l=null==(t=null==e?void 0:e.getBoundingClientRect)?void 0:t.call(e))?void 0:l.top)||0,n=document.getElementById("pagination"),i=r-o-((null==n?void 0:n.offsetHeight)||0);return i>0?i-55:450}(y.current),j=e=>(t,{size:l})=>{const r=[...b];r[e]={...r[e],width:l.width},S(r)},T=b.map(((e,t)=>({...e,onHeaderCell:e=>({width:e.width,onResize:j(t)})}))),z=function(e){const{height:t,size:l}=e;return f=t,p.rowHeight=s(l),{table:v,body:{wrapper:g}}}({height:x,size:H||"small"}),R=t.useMemo((()=>({header:{cell:a},body:{wrapper:z.body.wrapper},table:z.table})),[z]),E=!0===d?R:{header:{cell:a}},N={...l.scroll,x:h??"max-content",y:m||x||void 0};return e.jsxs("div",{id:"table",className:`\n        overflow-auto\n        ${!1!==u?"bordered":""}\n        ${!1!==o?"zebra":""}\n      `,children:[!x&&e.jsx(n,{}),x&&e.jsx(i,{ref:y,size:"small",rowKey:"id",pagination:!1,loading:r,...l,rowClassName:(e,t,l)=>`${("string"==typeof w?w:null==w?void 0:w(e,t,l))||""} ${`!h-${s(H)}px`}`,style:{borderRadius:10,borderRight:"1px solid rgba(0, 0, 0, .05)",borderBottom:"1px solid rgba(0, 0, 0, .05)",overflow:"auto",...l.style},bordered:!1!==u,scroll:N,components:E,columns:T})]})}));export{m as B};
