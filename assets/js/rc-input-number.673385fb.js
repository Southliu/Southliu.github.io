import{b as y,g as ee,n as We,e as B,c as Ae}from"./@babel_runtime.d5939a32.js";import{r}from"./react.402eeaf7.js";import{c as ne}from"./classnames.e70b85e0.js";import{t as je,b as Je,o as Ie,J as X,p as Ye,K as F}from"./rc-util.aac9ba6f.js";import{n as De,t as Ee,g as N,a as Re,v as ze,b as Z}from"./@rc-component_mini-decimal.f4c7fe24.js";var Ge=200,Qe=600;function Xe(e){var l=e.prefixCls,o=e.upNode,C=e.downNode,v=e.upDisabled,m=e.downDisabled,g=e.onStep,c=r.useRef(),p=r.useRef();p.current=g;var b=function(R,O){R.preventDefault(),p.current(O);function _(){p.current(O),c.current=setTimeout(_,Ge)}c.current=setTimeout(_,Qe)},s=function(){clearTimeout(c.current)};if(r.useEffect(function(){return s},[]),je())return null;var f="".concat(l,"-handler"),d=ne(f,"".concat(f,"-up"),y({},"".concat(f,"-up-disabled"),v)),E=ne(f,"".concat(f,"-down"),y({},"".concat(f,"-down-disabled"),m)),w={unselectable:"on",role:"button",onMouseUp:s,onMouseLeave:s};return r.createElement("div",{className:"".concat(f,"-wrap")},r.createElement("span",ee({},w,{onMouseDown:function(R){b(R,!0)},"aria-label":"Increase Value","aria-disabled":v,className:d}),o||r.createElement("span",{unselectable:"on",className:"".concat(l,"-handler-up-inner")})),r.createElement("span",ee({},w,{onMouseDown:function(R){b(R,!1)},"aria-label":"Decrease Value","aria-disabled":m,className:E}),C||r.createElement("span",{unselectable:"on",className:"".concat(l,"-handler-down-inner")})))}function ye(e){var l=typeof e=="number"?De(e):Ee(e).fullStr,o=l.includes(".");return o?Ee(l.replace(/(\d)\.(\d)/g,"$1$2.")).fullStr:e+"0"}function Ze(e,l){var o=r.useRef(null);function C(){try{var m=e.selectionStart,g=e.selectionEnd,c=e.value,p=c.substring(0,m),b=c.substring(g);o.current={start:m,end:g,value:c,beforeTxt:p,afterTxt:b}}catch{}}function v(){if(e&&o.current&&l)try{var m=e.value,g=o.current,c=g.beforeTxt,p=g.afterTxt,b=g.start,s=m.length;if(m.endsWith(p))s=m.length-o.current.afterTxt.length;else if(m.startsWith(c))s=c.length;else{var f=c[b-1],d=m.indexOf(f,b-1);d!==-1&&(s=d+1)}e.setSelectionRange(s,s)}catch(E){Je(!1,"Something warning of cursor restore. Please fire issue about this: ".concat(E.message))}}return[C,v]}const en=function(){var e=r.useRef(0),l=function(){Ie.cancel(e.current)};return r.useEffect(function(){return l},[]),function(o){l(),e.current=Ie(function(){o()})}};var nn=["prefixCls","className","style","min","max","step","defaultValue","value","disabled","readOnly","upHandler","downHandler","keyboard","controls","stringMode","parser","formatter","precision","decimalSeparator","onChange","onInput","onPressEnter","onStep"],Ce=function(l,o){return l||o.isEmpty()?o.toString():o.toNumber()},we=function(l){var o=N(l);return o.isInvalidate()?null:o},an=r.forwardRef(function(e,l){var o,C=e.prefixCls,v=C===void 0?"rc-input-number":C,m=e.className,g=e.style,c=e.min,p=e.max,b=e.step,s=b===void 0?1:b,f=e.defaultValue,d=e.value,E=e.disabled,w=e.readOnly,M=e.upHandler,R=e.downHandler,O=e.keyboard,_=e.controls,he=_===void 0?!0:_,ae=e.stringMode,k=e.parser,U=e.formatter,D=e.precision,h=e.decimalSeparator,L=e.onChange,W=e.onInput,A=e.onPressEnter,j=e.onStep,Ve=We(e,nn),te="".concat(v,"-input"),q=r.useRef(null),xe=r.useState(!1),re=B(xe,2),ue=re[0],oe=re[1],I=r.useRef(!1),K=r.useRef(!1),P=r.useRef(!1),Me=r.useState(function(){return N(d??f)}),ie=B(Me,2),i=ie[0],se=ie[1];function _e(a){d===void 0&&se(a)}var J=r.useCallback(function(a,n){if(!n)return D>=0?D:Math.max(Re(a),Re(s))},[D,s]),Y=r.useCallback(function(a){var n=String(a);if(k)return k(n);var u=n;return h&&(u=u.replace(h,".")),u.replace(/[^\w.-]+/g,"")},[k,h]),le=r.useRef(""),ce=r.useCallback(function(a,n){if(U)return U(a,{userTyping:n,input:String(le.current)});var u=typeof a=="number"?De(a):a;if(!n){var t=J(u,n);if(ze(u)&&(h||t>=0)){var S=h||".";u=Z(u,S,t)}}return u},[U,J,h]),Ue=r.useState(function(){var a=f??d;return i.isInvalidate()&&["string","number"].includes(Ae(a))?Number.isNaN(a)?"":a:ce(i.toString(),!1)}),fe=B(Ue,2),$=fe[0],de=fe[1];le.current=$;function T(a,n){de(ce(a.isInvalidate()?a.toString(!1):a.toString(!n),n))}var V=r.useMemo(function(){return we(p)},[p,D]),x=r.useMemo(function(){return we(c)},[c,D]),ve=r.useMemo(function(){return!V||!i||i.isInvalidate()?!1:V.lessEquals(i)},[V,i]),me=r.useMemo(function(){return!x||!i||i.isInvalidate()?!1:i.lessEquals(x)},[x,i]),Ke=Ze(q.current,ue),pe=B(Ke,2),Pe=pe[0],$e=pe[1],ge=function(n){return V&&!n.lessEquals(V)?V:x&&!x.lessEquals(n)?x:null},z=function(n){return!ge(n)},G=function(n,u){var t=n,S=z(t)||t.isEmpty();if(!t.isEmpty()&&!u&&(t=ge(t)||t,S=!0),!w&&!E&&S){var H=t.toString(),Q=J(H,u);return Q>=0&&(t=N(Z(H,".",Q)),z(t)||(t=N(Z(H,".",Q,!0)))),t.equals(i)||(_e(t),L==null||L(t.isEmpty()?null:Ce(ae,t)),d===void 0&&T(t,u)),t}return i},Te=en(),be=function a(n){if(Pe(),de(n),!K.current){var u=Y(n),t=N(u);t.isNaN()||G(t,!0)}W==null||W(n),Te(function(){var S=n;k||(S=n.replace(/ã€‚/g,".")),S!==n&&a(S)})},He=function(){K.current=!0},Oe=function(){K.current=!1,be(q.current.value)},ke=function(n){be(n.target.value)},Se=function(n){var u;if(!(n&&ve||!n&&me)){I.current=!1;var t=N(P.current?ye(s):s);n||(t=t.negate());var S=(i||N(0)).add(t.toString()),H=G(S,!1);j==null||j(Ce(ae,H),{offset:P.current?ye(s):s,type:n?"up":"down"}),(u=q.current)===null||u===void 0||u.focus()}},Ne=function(n){var u=N(Y($)),t=u;u.isNaN()?t=i:t=G(u,n),d!==void 0?T(i,!1):t.isNaN()||T(t,!1)},qe=function(){I.current=!0},Be=function(n){var u=n.which,t=n.shiftKey;I.current=!0,t?P.current=!0:P.current=!1,u===F.ENTER&&(K.current||(I.current=!1),Ne(!1),A==null||A(n)),O!==!1&&!K.current&&[F.UP,F.DOWN].includes(u)&&(Se(F.UP===u),n.preventDefault())},Fe=function(){I.current=!1,P.current=!1},Le=function(){Ne(!1),oe(!1),I.current=!1};return X(function(){i.isInvalidate()||T(i,!1)},[D]),X(function(){var a=N(d);se(a);var n=N(Y($));(!a.equals(n)||!I.current||U)&&T(a,I.current)},[d]),X(function(){U&&$e()},[$]),r.createElement("div",{className:ne(v,m,(o={},y(o,"".concat(v,"-focused"),ue),y(o,"".concat(v,"-disabled"),E),y(o,"".concat(v,"-readonly"),w),y(o,"".concat(v,"-not-a-number"),i.isNaN()),y(o,"".concat(v,"-out-of-range"),!i.isInvalidate()&&!z(i)),o)),style:g,onFocus:function(){oe(!0)},onBlur:Le,onKeyDown:Be,onKeyUp:Fe,onCompositionStart:He,onCompositionEnd:Oe,onBeforeInput:qe},he&&r.createElement(Xe,{prefixCls:v,upNode:M,downNode:R,upDisabled:ve,downDisabled:me,onStep:Se}),r.createElement("div",{className:"".concat(te,"-wrap")},r.createElement("input",ee({autoComplete:"off",role:"spinbutton","aria-valuemin":c,"aria-valuemax":p,"aria-valuenow":i.isInvalidate()?null:i.toString(),step:s},Ve,{ref:Ye(q,l),className:te,value:$,onChange:ke,disabled:E,readOnly:w}))))});an.displayName="InputNumber";export{an as I};
