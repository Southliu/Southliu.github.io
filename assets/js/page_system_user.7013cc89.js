import{r as e,j as t}from"./react.a7da97a2.js";import{I as s,S as a,b as n,A as o,d as r}from"./components_Business.81c2cf98.js";import{O as i}from"./components_Dates.13b0bc4e.js";import{u as l}from"./page_content_article.45146584.js";import{c as u,j as c,k as m}from"./layouts.61543391.js";import{u as d}from"./components_Fullscreen.8cfdd543.js";import{U as p,D as f}from"./components_Buttons.19c6045b.js";import{B as y}from"./components_Content.8bfa5b7f.js";import{B as g}from"./components_Search.ff141a4e.js";import{B as h}from"./components_Modal.ba600df6.js";import{B as b}from"./components_Form.45cc755f.js";import{B as j}from"./components_Table.52f4cba1.js";import{B as S}from"./components_Pagination.732bb587.js";import{u as x}from"./react-i18next.1d91db1a.js";import{B as _,s as I,t as C,m as k}from"./antd.850acb68.js";function w(s){const{title:a,isVisible:n,treeData:o,checkedKeys:r,onClose:i,onSubmit:l}=s,{t:u}=x(),[c,m]=e.useState(r);e.useEffect((()=>{m(s.checkedKeys)}),[s.checkedKeys]);const d=t.jsx(_,{type:"primary",onClick:()=>{l(c)},children:u("public.submit")});return t.jsx(I,{open:n,title:a||u("system.rightsProfile"),placement:"right",extra:d,onClose:i,children:t.jsx(C,{checkable:!0,checkedKeys:c,treeData:o,onCheck:e=>{m(e)}})})}const v=Object.freeze(Object.defineProperty({__proto__:null,default:w},Symbol.toStringTag,{value:"Module"})),z=e=>[{label:e("system.age"),name:"age",component:"InputNumber"},{label:e("public.name"),name:"keyword",component:"Input"}],N=(e,s)=>[{title:"ID",dataIndex:"id",width:400,fixed:"left"},{title:e("login.username"),dataIndex:"username",width:400,fixed:"left"},{title:e("public.name"),dataIndex:"real_name",width:400},{title:e("system.role"),dataIndex:"roles_name",width:400},{title:e("system.phone"),dataIndex:"phone",width:400},{title:e("system.state"),dataIndex:"status",width:200,render:s=>t.jsx("span",{children:e(s?"public.open":"public.close")})},{title:e("public.operate"),dataIndex:"operate",width:200,fixed:"right",render:(e,t)=>s(e,t)}],B=e=>[{label:e("login.username"),name:"username",rules:s(e),component:"Input"},{label:e("public.name"),name:"real_name",rules:s(e),component:"Input"},{label:e("system.role"),name:"roles_name",rules:s(e),component:"Input"},{label:e("system.state"),name:"status",rules:a(e),component:"Select",componentProps:{options:i}}],D=Object.freeze(Object.defineProperty({__proto__:null,createList:B,searchList:z,tableColumns:N},Symbol.toStringTag,{value:"Module"}));const F={page:1,pageSize:20},O={status:1};const P=Object.freeze(Object.defineProperty({__proto__:null,default:function(){const{t:s}=x();l(s,s("system.userTitle"));const a=e.useRef(null),i=e.useRef(null),[I,C]=k.useMessage(),[v,D]=e.useState(!1),[P,$]=e.useState(!1),[K,L]=e.useState(!1),[M,T]=e.useState(o(s)),[R,V]=e.useState(""),[E,A]=e.useState(O),[Q,U]=e.useState(F.page),[Z,q]=e.useState(F.pageSize),[G,H]=e.useState(0),[J,W]=e.useState([]),[X,Y]=e.useState(""),[ee,te]=e.useState(!1),[se,ae]=e.useState([]),[ne,oe]=e.useState([]),{permissions:re}=d(),ie="/authority/user",le={page:u(`${ie}/index`,re),create:u(`${ie}/create`,re),update:u(`${ie}/update`,re),delete:u(`${ie}/delete`,re),permission:u(`${ie}/authority`,re)},ue=e.useCallback((async e=>{try{D(!0);const{code:t,data:s}=await function(e){return n.get("/authority/user/page",{params:e})}(e);if(200!==Number(t))return;const{items:a,total:o}=s;H(o),W(a)}finally{D(!1)}}),[]);e.useEffect((()=>{le.page&&ue({...F})}),[ue,le.page]);const ce=async e=>{try{L(!0),T(r(s,e)),V(e),$(!0);const{code:t,data:a}=await function(e){return n.get(`/authority/user/detail?id=${e}`)}(e);if(200!==Number(t))return;A(a)}finally{$(!1)}},me=()=>{var e;const t={...(null==(e=a.current)?void 0:e.getFieldsValue())||{},page:Q,pageSize:Z};ue(t)},de=async e=>{try{D(!0);const{code:t,message:a}=await function(e){return n.delete(`/authority/user/${e}`)}(e);200===Number(t)&&(I.success(a||s("public.successfullyDeleted")),me())}finally{D(!1)}};return t.jsx(y,{isPermission:le.page,children:t.jsxs(t.Fragment,{children:[C,t.jsx(g,{formRef:a,list:z(s),data:F,isLoading:v,isCreate:le.create,onCreate:()=>{L(!0),T(o(s)),V(""),A(O)},handleFinish:e=>{U(1),ue({page:1,pageSize:Z,...e})}}),t.jsx(j,{loading:v,columns:N(s,((e,a)=>t.jsxs(t.Fragment,{children:[!0===le.permission&&t.jsx(_,{className:"mr-2",loading:v,onClick:()=>(async e=>{try{D(!0);const t={userId:e},{code:s,data:a}=await m(t);if(200!==Number(s))return;const{defaultCheckedKeys:n,treeData:o}=a;Y(e),oe(o),ae(n),te(!0)}finally{D(!1)}})(a.id),children:s("system.permissions")}),!0===le.update&&t.jsx(p,{className:"mr-5px",isLoading:v,onClick:()=>ce(a.id)}),!0===le.delete&&t.jsx(f,{className:"mr-5px",isLoading:v,handleDelete:()=>de(a.id)})]}))),dataSource:J}),t.jsx(S,{disabled:v,current:Q,pageSize:Z,total:G,onChange:(e,t)=>{var s;U(e),q(t);const n=null==(s=a.current)?void 0:s.getFieldsValue();ue({...n,page:e,pageSize:t})}}),t.jsx(h,{title:M,open:K,confirmLoading:P,onOk:()=>{var e;null==(e=i.current)||e.handleSubmit()},onCancel:()=>{L(!1)},children:t.jsx(b,{formRef:i,list:B(s),data:E,labelCol:{span:6},handleFinish:async e=>{try{$(!0);const t=()=>{return R?(t=R,s=e,n.put(`/authority/user/${t}`,s)):function(e){return n.post("/authority/user",e)}(e);var t,s},{code:a,message:o}=await t();if(200!==Number(a))return;I.success(o||s("public.successfulOperation")),L(!1),me()}finally{$(!1)}}})}),t.jsx(w,{isVisible:ee,treeData:ne,checkedKeys:se,onClose:()=>{te(!1)},onSubmit:async e=>{try{D(!0);const t={menuIds:e,userId:X},{code:a,message:n}=await c(t);if(200!==Number(a))return;I.success(n||s("system.authorizationSuccessful")),te(!1)}finally{D(!1)}}})]})})}},Symbol.toStringTag,{value:"Module"}));export{v as P,P as i,D as m};
