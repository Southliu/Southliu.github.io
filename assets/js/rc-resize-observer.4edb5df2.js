import{A as j,B as K,i as T,h as X,l as B,C as Y,y as q,z as G,a as J,_ as Q,f as D,g as U}from"./@babel_runtime.e68bd868.js";import{r as t}from"./react.ab566f72.js";import{C as Z,D as ee,a1 as S,F as re,s as te,t as ne,$ as N,V as ie}from"./rc-util.1a6f23f3.js";import{i as L}from"./resize-observer-polyfill.0f9f8adb.js";var g=new Map;function oe(e){e.forEach(function(n){var r,i=n.target;(r=g.get(i))===null||r===void 0||r.forEach(function(o){return o(i)})})}var A=new L(oe);function ae(e,n){g.has(e)||(g.set(e,new Set),A.observe(e)),g.get(e).add(n)}function se(e,n){g.has(e)&&(g.get(e).delete(n),g.get(e).size||(A.unobserve(e),g.delete(e)))}var fe=function(e){j(r,e);var n=K(r);function r(){return T(this,r),n.apply(this,arguments)}return X(r,[{key:"render",value:function(){return this.props.children}}]),r}(t.Component),I=t.createContext(null);function ue(e){var n=e.children,r=e.onBatchResize,i=t.useRef(0),o=t.useRef([]),a=t.useContext(I),v=t.useCallback(function(f,s,u){i.current+=1;var d=i.current;o.current.push({size:f,element:s,data:u}),Promise.resolve().then(function(){d===i.current&&(r==null||r(o.current),o.current=[])}),a==null||a(f,s,u)},[r,a]);return t.createElement(I.Provider,{value:v},n)}function ce(e){var n=e.children,r=e.disabled,i=t.useRef(null),o=t.useRef(null),a=t.useContext(I),v=typeof n=="function",f=v?n(i):n,s=t.useRef({width:-1,height:-1,offsetWidth:-1,offsetHeight:-1}),u=!v&&t.isValidElement(f)&&Z(f),d=u?f.ref:null,y=t.useMemo(function(){return ee(d,i)},[d,i]),W=t.useRef(e);W.current=e;var z=t.useCallback(function(l){var $=W.current,c=$.onResize,k=$.data,E=l.getBoundingClientRect(),_=E.width,b=E.height,h=l.offsetWidth,R=l.offsetHeight,C=Math.floor(_),m=Math.floor(b);if(s.current.width!==C||s.current.height!==m||s.current.offsetWidth!==h||s.current.offsetHeight!==R){var w={width:C,height:m,offsetWidth:h,offsetHeight:R};s.current=w;var x=h===Math.round(_)?_:h,H=R===Math.round(b)?b:R,M=B(B({},w),{},{offsetWidth:x,offsetHeight:H});a==null||a(M,l,k),c&&Promise.resolve().then(function(){c(M,l)})}},[]);return t.useEffect(function(){var l=S(i.current)||S(o.current);return l&&!r&&ae(l,z),function(){return se(l,z)}},[i.current,r]),t.createElement(fe,{ref:o},u?t.cloneElement(f,{ref:y}):f)}var ve="rc-observer-key";function le(e){var n=e.children,r=typeof n=="function"?[n]:re(n);return r.map(function(i,o){var a=(i==null?void 0:i.key)||"".concat(ve,"-").concat(o);return t.createElement(ce,Y({},e,{key:a}),i)})}le.Collection=ue;var p=new Map;function de(e){e.forEach(function(n){var r,i=n.target;(r=p.get(i))===null||r===void 0||r.forEach(function(o){return o(i)})})}var F=new L(de);function he(e,n){p.has(e)||(p.set(e,new Set),F.observe(e)),p.get(e).add(n)}function Re(e,n){p.has(e)&&(p.get(e).delete(n),p.get(e).size||(F.unobserve(e),p.delete(e)))}var ge=function(e){q(r,e);var n=G(r);function r(){return J(this,r),n.apply(this,arguments)}return Q(r,[{key:"render",value:function(){return this.props.children}}]),r}(t.Component),O=t.createContext(null);function pe(e){var n=e.children,r=e.onBatchResize,i=t.useRef(0),o=t.useRef([]),a=t.useContext(O),v=t.useCallback(function(f,s,u){i.current+=1;var d=i.current;o.current.push({size:f,element:s,data:u}),Promise.resolve().then(function(){d===i.current&&(r==null||r(o.current),o.current=[])}),a==null||a(f,s,u)},[r,a]);return t.createElement(O.Provider,{value:v},n)}function Ce(e,n){var r=e.children,i=e.disabled,o=t.useRef(null),a=t.useRef(null),v=t.useContext(O),f=typeof r=="function",s=f?r(o):r,u=t.useRef({width:-1,height:-1,offsetWidth:-1,offsetHeight:-1}),d=!f&&t.isValidElement(s)&&te(s),y=d?s.ref:null,W=t.useMemo(function(){return ne(y,o)},[y,o]),z=function(){return N(o.current)||N(a.current)};t.useImperativeHandle(n,function(){return z()});var l=t.useRef(e);l.current=e;var $=t.useCallback(function(c){var k=l.current,E=k.onResize,_=k.data,b=c.getBoundingClientRect(),h=b.width,R=b.height,C=c.offsetWidth,m=c.offsetHeight,w=Math.floor(h),x=Math.floor(R);if(u.current.width!==w||u.current.height!==x||u.current.offsetWidth!==C||u.current.offsetHeight!==m){var H={width:w,height:x,offsetWidth:C,offsetHeight:m};u.current=H;var M=C===Math.round(h)?h:C,V=m===Math.round(R)?R:m,P=D(D({},H),{},{offsetWidth:M,offsetHeight:V});v==null||v(P,c,_),E&&Promise.resolve().then(function(){E(P,c)})}},[]);return t.useEffect(function(){var c=z();return c&&!i&&he(c,$),function(){return Re(c,$)}},[o.current,i]),t.createElement(ge,{ref:a},d?t.cloneElement(s,{ref:W}):s)}var me=t.forwardRef(Ce),be="rc-observer-key";function ze(e,n){var r=e.children,i=typeof r=="function"?[r]:ie(r);return i.map(function(o,a){var v=(o==null?void 0:o.key)||"".concat(be,"-").concat(a);return t.createElement(me,U({},e,{key:v,ref:a===0?n:void 0}),o)})}var $e=t.forwardRef(ze);$e.Collection=pe;export{$e as R,le as a};
