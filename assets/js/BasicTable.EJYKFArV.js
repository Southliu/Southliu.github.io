import{j as e,r as t}from"./react@18.3.1.zIIbIvjs.js";import{G as r}from"./index.8PTvPspU.js";import{R as l}from"./react-resizable@3.0.5_react-dom@18.3.1_react@18.3.1.QDb3Dlw0.js";import{a as o}from"./ahooks@3.7.11_react@18.3.1.DsS9i37R.js";import{S as n,x as i}from"./antd@5.19.1_react-dom@18.3.1_react@18.3.1.jFZ5n7rI.js";function s(e){switch(e){case"large":return 54;case"middle":return 46;default:return 38}}function c(e){for(let t=0;t<e.length;t++){const l=e[t];void 0===l.ellipsis&&(l.ellipsis=!0),l.render||(l.render=e=>e||(0===e?e:r))}return e}function a(t){const{onResize:r,width:o,...n}=t;return o?e.jsx(l,{width:o,height:0,handle:e.jsx("span",{className:"react-resizable-handle",onClick:e=>{e.stopPropagation()}}),onResize:r,draggableOpts:{enableUserSelectHack:!1},children:e.jsx("th",{...n})}):e.jsx("th",{...n})}function d(e,t){switch(t.type){case"changeScroll":let r=t.curScrollTop||0,l=t.scrollHeight||0;const o=t.tableScrollY||0;return l<=0&&(l=0),0!==l&&o===e.tableScrollY&&(l=e.scrollHeight),e.scrollHeight&&r>e.scrollHeight&&(r=e.scrollHeight),{...e,curScrollTop:r,scrollHeight:l,tableScrollY:o};case"reset":return{...e,curScrollTop:0,scrollHeight:0};default:throw new Error("表格：未知错误类型!")}}function u(e){return"number"==typeof e&&isFinite(e)}const h=t.createContext({dispatch:void 0,renderLen:1,start:0,offsetStart:0,rowHeight:46,totalLen:0});function g(r){const{children:l,...o}=r,{renderLen:n,start:i,offsetStart:s}=t.useContext(h);let c=null;if(l&&null!==l){const e=null==l?void 0:l[1];c=Array.isArray(e)&&e.length?[null==l?void 0:l[0],e.slice(i,i+n).map((e=>Array.isArray(e)?e[0]:e))]:l}return e.jsx("tbody",{...o,style:{transform:`translateY(-${s}px)`},children:c})}const p={rowHeight:38,curScrollTop:0,scrollHeight:0,tableScrollY:0};let f=0;function v(r){var l,n,i,s,c;const{style:a,children:g,...v}=r,{width:m,...w}=a,[H,b]=t.useReducer(d,p),S=t.useRef(null),x=t.useRef(null),[y,j]=t.useState((null==(i=null==(n=null==(l=null==g?void 0:g[2])?void 0:l.props)?void 0:n.data)?void 0:i.length)??0);t.useEffect((()=>{var e,t,r,l,o,n;u(null==(r=null==(t=null==(e=null==g?void 0:g[1])?void 0:e.props)?void 0:t.data)?void 0:r.length)&&j(null==(n=null==(o=null==(l=null==g?void 0:g[1])?void 0:l.props)?void 0:o.data)?void 0:n.length)}),[g]);const T=t.useMemo((()=>{let e="auto";return H.rowHeight&&y&&(e=H.rowHeight*y),e}),[H.rowHeight,y]);let z=0;z="string"==typeof f?null==(c=null==(s=S.current)?void 0:s.parentNode)?void 0:c.offsetHeight:f,u(T)&&Number(T)<z&&(z=T),z<=0&&(z=0);const R=t.useMemo((()=>{let e=1;if(H.rowHeight&&y&&z)if(z<=0)e=0;else{const t=5+(z/H.rowHeight|0);e=t>y?y:t}return e}),[H.rowHeight,y,z]);let E=H.rowHeight?H.curScrollTop/H.rowHeight|0:0,N=H.rowHeight?H.curScrollTop%H.rowHeight:0;H.curScrollTop&&H.rowHeight&&H.curScrollTop>H.rowHeight?E>y-R?N=0:E>1&&(E-=1,N+=H.rowHeight):E=0,t.useEffect((()=>{var e;const t=null==(e=S.current)?void 0:e.parentNode;t&&(t.scrollTop=0),b({type:"reset"})}),[y]);const C=o((e=>{var t,r;const l=(null==(t=null==e?void 0:e.target)?void 0:t.scrollTop)??0;if(l!==H.curScrollTop){const t=(null==(r=null==e?void 0:e.target)?void 0:r.scrollHeight)-z;b({type:"changeScroll",curScrollTop:l,scrollHeight:t,tableScrollY:z})}}),{wait:60});return t.useEffect((()=>{var e;const t=null==(e=null==S?void 0:S.current)?void 0:e.parentNode;return t&&t.addEventListener("scroll",(e=>C.run(e))),()=>{t.removeEventListener("scroll",(e=>C.run(e)))}}),[S,H.curScrollTop,z,H.scrollHeight,C]),e.jsx("div",{className:"virtualTable",ref:S,style:{width:"100%",position:"relative",height:T,boxSizing:"border-box",paddingTop:H.curScrollTop},children:e.jsx(h.Provider,{value:{dispatch:b,rowHeight:H.rowHeight,start:E,offsetStart:N,renderLen:R,totalLen:y},children:e.jsx("table",{...v,ref:x,style:{...w,width:m,position:"relative"},children:g})})})}function m(r){const{loading:l,isZebra:o,isBordered:d,isVirtual:u,scrollX:h,scrollY:m,rowClassName:w,size:H}=r,[b,S]=t.useState(c(r.columns)),x=t.useRef(null);t.useEffect((()=>{S(c(r.columns))}),[r.columns]);const y=function(e){var t,r;const l=document.documentElement.clientHeight||document.body.clientHeight,o=(null==(r=null==(t=null==e?void 0:e.getBoundingClientRect)?void 0:t.call(e))?void 0:r.top)||0,n=document.getElementById("pagination"),i=l-o-((null==n?void 0:n.offsetHeight)||0);return i>0?i-65:450}(x.current),j=e=>(t,{size:r})=>{const l=[...b];l[e]={...l[e],width:r.width},S(l)},T=b.map(((e,t)=>({...e,onHeaderCell:e=>({width:e.width,onResize:j(t)})}))),z=function(e){const{height:t,size:r}=e;return f=t,p.rowHeight=s(r),{table:v,body:{wrapper:g}}}({height:y,size:H||"small"}),R=t.useMemo((()=>({header:{cell:a},body:{wrapper:z.body.wrapper},table:z.table})),[z]),E=!0===u?R:{header:{cell:a}},N={...r.scroll,x:h??"max-content",y:m||y||void 0};return e.jsxs("div",{id:"table",className:`\n        overflow-auto\n        ${!1!==d?"bordered":""}\n        ${!1!==o?"zebra":""}\n      `,children:[!y&&e.jsx(n,{}),y&&e.jsx("div",{ref:x,children:e.jsx(i,{size:"small",rowKey:"id",pagination:!1,loading:l,...r,rowClassName:(e,t,r)=>`${("string"==typeof w?w:null==w?void 0:w(e,t,r))||""} ${`!h-${s(H)}px`}`,style:{borderRadius:10,borderRight:"1px solid rgba(0, 0, 0, .05)",borderBottom:"1px solid rgba(0, 0, 0, .05)",overflow:"auto",...r.style},bordered:!1!==d,scroll:N,components:E,columns:T})})]})}export{m as B};
