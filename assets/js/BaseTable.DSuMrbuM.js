import{r as e,j as t}from"./react@18.2.0.CwGjMYfB.js";import{w as l}from"./index.SJbFXdoq.js";import{R as r}from"./react-resizable@3.0.5_react-dom@18.2.0_react@18.2.0.BqjaEpGj.js";import{l as n}from"./lodash@4.17.21.CdzfGhvh.js";import{u as o}from"./react-i18next@14.1.1_i18next@23.11.4_react-dom@18.2.0_react@18.2.0.CoFanrD1.js";import{v as s,o as i,w as c,B as a,s as d,x as u}from"./antd@5.20.2_react-dom@18.2.0_react@18.2.0.kysB8RSl.js";import{o as h,p,g}from"./@ant-design_icons@5.3.7_react-dom@18.2.0_react@18.2.0.1hpSyJyf.js";function m(e){switch(e){case"large":return 54;case"middle":return 46;default:return 38}}function f(e){for(let t=0;t<e.length;t++){const r=e[t];void 0===r.ellipsis&&(r.ellipsis=!0),r.render||(r.render=e=>e||(0===e?e:l))}return e}function v(e){const{onResize:l,width:n,...o}=e;return n?t.jsx(r,{width:n,height:0,handle:t.jsx("span",{className:"react-resizable-handle",onClick:e=>{e.stopPropagation()}}),onResize:l,draggableOpts:{enableUserSelectHack:!1},children:t.jsx("th",{...o})}):t.jsx("th",{...o})}function x(e,t){switch(t.type){case"changeScroll":let l=t.curScrollTop||0,r=t.scrollHeight||0;const n=t.tableScrollY||0;return r<=0&&(r=0),0!==r&&n===e.tableScrollY&&(r=e.scrollHeight),e.scrollHeight&&l>e.scrollHeight&&(l=e.scrollHeight),{...e,curScrollTop:l,scrollHeight:r,tableScrollY:n};case"reset":return{...e,curScrollTop:0,scrollHeight:0};default:throw new Error("表格：未知错误类型!")}}function b(e){return"number"==typeof e&&isFinite(e)}const w=e.createContext({dispatch:void 0,renderLen:1,start:0,offsetStart:0,rowHeight:46,totalLen:0});function j(l){const{children:r,...n}=l,{renderLen:o,start:s,offsetStart:i}=e.useContext(w);let c=null;if(r&&null!==r){const e=null==r?void 0:r[1];c=Array.isArray(e)&&e.length?[null==r?void 0:r[0],e.slice(s,s+o).map((e=>Array.isArray(e)?e[0]:e))]:r}return t.jsx("tbody",{...n,style:{transform:`translateY(-${i}px)`},children:c})}const H={rowHeight:38,curScrollTop:0,scrollHeight:0,tableScrollY:0};let y=0;function S(l){var r,o,s,i,c;const{style:a,children:d,...u}=l,{width:h,...p}=a,[g,m]=e.useReducer(x,H),f=e.useRef(null),v=e.useRef(null),[j,S]=e.useState((null==(s=null==(o=null==(r=null==d?void 0:d[2])?void 0:r.props)?void 0:o.data)?void 0:s.length)??0);e.useEffect((()=>{var e,t,l,r,n,o;b(null==(l=null==(t=null==(e=null==d?void 0:d[1])?void 0:e.props)?void 0:t.data)?void 0:l.length)&&S(null==(o=null==(n=null==(r=null==d?void 0:d[1])?void 0:r.props)?void 0:n.data)?void 0:o.length)}),[d]);const N=e.useMemo((()=>{let e="auto";return g.rowHeight&&j&&(e=g.rowHeight*j),e}),[g.rowHeight,j]);let C=0;C="string"==typeof y?null==(c=null==(i=f.current)?void 0:i.parentNode)?void 0:c.offsetHeight:y,b(N)&&Number(N)<C&&(C=N),C<=0&&(C=0);const T=e.useMemo((()=>{let e=1;if(g.rowHeight&&j&&C)if(C<=0)e=0;else{const t=5+(C/g.rowHeight|0);e=t>j?j:t}return e}),[g.rowHeight,j,C]);let k=g.rowHeight?g.curScrollTop/g.rowHeight|0:0,z=g.rowHeight?g.curScrollTop%g.rowHeight:0;g.curScrollTop&&g.rowHeight&&g.curScrollTop>g.rowHeight?k>j-T?z=0:k>1&&(k-=1,z+=g.rowHeight):k=0,e.useEffect((()=>{var e;const t=null==(e=f.current)?void 0:e.parentNode;t&&(t.scrollTop=0),m({type:"reset"})}),[j]);const E=n.throttle((e=>{var t,l;const r=(null==(t=null==e?void 0:e.target)?void 0:t.scrollTop)??0;if(r!==g.curScrollTop){const t=(null==(l=null==e?void 0:e.target)?void 0:l.scrollHeight)-C;m({type:"changeScroll",curScrollTop:r,scrollHeight:t,tableScrollY:C})}}),60);return e.useEffect((()=>{var e;const t=null==(e=null==f?void 0:f.current)?void 0:e.parentNode;return t&&t.addEventListener("scroll",(e=>E(e))),()=>{t.removeEventListener("scroll",(e=>E(e)))}}),[f,g.curScrollTop,C,g.scrollHeight,E]),t.jsx("div",{className:"virtualTable",ref:f,style:{width:"100%",position:"relative",height:N,boxSizing:"border-box",paddingTop:g.curScrollTop},children:t.jsx(w.Provider,{value:{dispatch:m,rowHeight:g.rowHeight,start:k,offsetStart:z,renderLen:T,totalLen:j},children:t.jsx("table",{...u,ref:v,style:{...p,width:h,position:"relative"},children:d})})})}function N(l){const{columns:r,className:n,getTableChecks:u}=l,{t:p}=o(),[g,m]=e.useState(!1),[f,v]=e.useState([]),[x,b]=e.useState([]),w=f.length===x.length,j=x.length>0&&x.length<f.length,H={...l};delete H.getTableChecks,e.useEffect((()=>{S(r)}),[r]);const y=()=>{m(!g)},S=e=>{if(!(null==e?void 0:e.length))return[];const t=[],l=[];for(let r=0;r<(null==e?void 0:e.length);r++){const n=e[r],{dataIndex:o}=n;!n.hidden&&o&&(null==l||l.push(o)),t.push({label:n.title,value:o})}v(t),b(l)},N=e=>{b(e)},C=()=>{if(!(null==x?void 0:x.length))return d.warning({content:p("public.checkAllWarning"),key:"filter"});y(),u(x)},T=e=>{const t=e.target.checked?f.map((e=>e.value)):[];b(t)};return t.jsx(s,{content:()=>t.jsxs("div",{className:"min-w-130px",children:[t.jsx(i,{className:"!px-12px",indeterminate:j,onChange:T,checked:w,children:p("public.checkAll")}),t.jsx(i.Group,{className:"flex flex-col !px-12px",value:x,onChange:N,children:null==f?void 0:f.map((e=>t.jsx("div",{children:t.jsx(i,{value:e.value,children:e.label})},e.value)))}),t.jsx(c,{className:"!mt-10px !mb-5px"}),t.jsxs("div",{className:"flex justify-end px-10px",children:[t.jsx(a,{size:"small",className:"mr-5px",onClick:y,children:"取消"}),t.jsx(a,{type:"primary",size:"small",onClick:C,children:"筛选"})]})]}),trigger:"click",placement:"bottom",overlayInnerStyle:{padding:"12px 0 10px"},open:g,onOpenChange:y,children:t.jsx("div",{...H,className:`${n} inline-block cursor-pointer`,children:t.jsx(h,{})})})}function C(l){const{isLoading:r,isVirtual:n,isCreate:s,isZebra:i=!0,isBordered:c=!0,isOperate:h=!0,isAuthHeight:x,scrollX:b,scrollY:w,rowClassName:C,size:T,leftContent:k,rightContent:z,getPage:E,onCreate:R}=l,{t:_}=o(),[A]=function(){const[t,l]=e.useState(!0);return[(e,r)=>{if(!(null==r?void 0:r.length)||!(null==e?void 0:e.length))return e||[];if(t)return l(!1),e||[];for(let t=0;t<(null==e?void 0:e.length);t++){const l=e[t];l.hidden=!r.includes(l.dataIndex)}return e}]}(),[L,B]=e.useState(f(l.columns)),Y=e.useRef(null),[$,I]=e.useState([]);e.useEffect((()=>{B(f(l.columns))}),[l.columns]),e.useEffect((()=>{s&&!R&&d.warning(_("public.createMethodWarning"))}),[s]),e.useEffect((()=>{h&&!E&&d.warning(_("public.getPageWarning"))}),[E]);const M=function(e){var t,l;const r=document.documentElement.clientHeight||document.body.clientHeight,n=(null==(l=null==(t=null==e?void 0:e.getBoundingClientRect)?void 0:t.call(e))?void 0:l.top)||0,o=document.getElementById("pagination"),s=r-n-((null==o?void 0:o.offsetHeight)||0);return s>0?s-65:450}(Y.current),P=e=>(t,{size:l})=>{const r=[...L];r[e]={...r[e],width:l.width},B(r)},O=function(e){const{height:t,size:l}=e;return y=t,H.rowHeight=m(l),{table:S,body:{wrapper:j}}}({height:M,size:T||"small"}),W=e.useMemo((()=>({header:{cell:v},body:{wrapper:O.body.wrapper},table:O.table})),[O]),F=n?W:{header:{cell:v}},G={...l.scroll,x:b??"max-content",y:w??(x?M:void 0)};return t.jsxs("div",{id:"table",className:`\n        overflow-auto\n        ${!1!==c?"bordered":""}\n        ${!1!==i?"zebra":""}\n      `,children:[h&&t.jsxs("div",{className:"flex justify-between !mb-10px",children:[t.jsxs("div",{className:"flex flex-wrap items-center",children:[!!s&&t.jsx(a,{type:"primary",className:"mr-10px",icon:t.jsx(p,{}),onClick:R,children:_("public.create")}),k]}),t.jsxs("div",{className:"flex flex-wrap items-center",children:[z?t.jsx("div",{className:"mr-10px",children:z}):void 0,t.jsx(g,{className:"mr-10px transform rotate-270 cursor-pointer",disabled:!!r,onClick:E}),t.jsx(N,{className:"mr-10px",columns:L,getTableChecks:e=>{I(e)}})]})]}),t.jsx("div",{ref:Y,children:t.jsx(u,{size:"small",rowKey:"id",pagination:!1,loading:r,...l,rowClassName:(e,t,l)=>`${("string"==typeof C?C:null==C?void 0:C(e,t,l))||""} ${`!h-${m(T)}px`}`,style:{borderRadius:10,borderRight:"1px solid rgba(0, 0, 0, .05)",borderBottom:"1px solid rgba(0, 0, 0, .05)",overflow:"auto",...l.style},bordered:!1!==c,scroll:G,components:F,columns:A(L,$).map(((e,t)=>({onCell:()=>({style:{width:e.width}}),...e,onHeaderCell:e=>({width:e.width,onResize:P(t)})})))})})]})}export{C as B};
