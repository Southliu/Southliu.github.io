import{a as w,F,j as i,S as X}from"./components_Bottom.b6a39c54.js";import{r as s}from"./react.75970298.js";import{u as O,a as I}from"./react-redux.df11dbf8.js";import{b as V}from"./components_Fullscreen.4db7e05c.js";import{c as b}from"./layouts.a9a30c12.js";import{U as H,D as J}from"./components_Buttons.9e23d5c1.js";import{B as q}from"./components_Content.225b3cd7.js";import{B as W}from"./components_Search.95ece36e.js";import{B as Y}from"./components_Table.1feef0ad.js";import{B as Z}from"./components_Pagination.cae73e50.js";import{u as ee,a as te}from"./react-router.61105173.js";import{I as ae,m as G,g as se}from"./antd.04139c5f.js";import{c as j,I as z,r as y,g as ne,A as oe,d as ce}from"./components_Business.9c2eaebd.js";import{r as M}from"./react-activation.1dc20a55.js";import{g as ie,s as re,a as le,h as ue,i as de,j as me,u as pe}from"./components_GlobalSearch.efb878ed.js";import{B as fe}from"./components_Form.2ea9a913.js";function Q(t){const o=j+t?`${t} - ${j}`:"";s.useEffect(()=>{document.title=o},[o]),M.useActivate(()=>{document.title=o})}function he(t){return w(F,{children:[i(ae,{...t,placeholder:"请输入"}),i("div",{className:"mb-5px text-red",children:"注：标题不能含有敏感信息!"})]})}const ge=[{label:"用户名",name:"username",component:"Input"},{label:"标题",name:"title",component:"Input"}],be=t=>[{title:"ID",dataIndex:"id",width:400,fixed:"left"},{title:"用户名",dataIndex:"username",width:400,fixed:"left"},{title:"标题",dataIndex:"title",width:400},{title:"内容",dataIndex:"content",width:400},{title:"操作",dataIndex:"operate",width:200,fixed:"right",render:(o,m)=>t(o,m)}],Pe=[{label:"用户名",name:"username",rules:z,component:"Input"},{label:"嵌套数据",name:["user","name","test"],rules:z,component:"Input"},{label:"标题",name:"title",rules:z,component:"customize",render:he},{label:"内容",name:"content",component:"Editor"}];function Se(t){return y.get("/content/article/index",{params:t})}function xe(t){return y.get(`/content/article/${t}`)}function Ie(t){return y.post("/content/article",t)}function ye(t,o){return y.put(`/content/article/${t}`,o)}function $e(t){return y.delete(`/content/article/${t}`)}const v={page:1,pageSize:20};function je(){Q("文章管理");const t=ee(),o=O(),m=s.useRef(null),[c,u]=s.useState(!1),[r,P]=s.useState(v.page),[p,$]=s.useState(v.pageSize),[T,L]=s.useState(0),[B,C]=s.useState([]),g=I(a=>a.user.permissions),S=I(a=>a.public.isRefreshPage),f="/content/article",d={page:b(`${f}/index`,g),create:b(`${f}/create`,g),update:b(`${f}/update`,g),delete:b(`${f}/delete`,g)},D=a=>{P(1),h({page:1,pageSize:p,...a})},h=s.useCallback(async a=>{try{u(!0);const{data:{data:e}}=await Se(a),{items:n,total:l}=e;L(l),C(n)}finally{u(!1)}},[]);s.useEffect(()=>{d.page&&!S&&h({...v})},[d.page]),s.useEffect(()=>{S&&(o(V(!1)),R())},[S]);const E=()=>{t("/content/article/option?type=create")},x=a=>{t(`/content/article/option?type=update&id=${a}`)},R=()=>{var n;const e={...((n=m.current)==null?void 0:n.getFieldsValue())||{},page:r,pageSize:p};h(e)},k=async a=>{try{u(!0);const{data:e}=await $e(a);(e==null?void 0:e.code)===200&&(G.success((e==null?void 0:e.message)||"删除成功"),R())}finally{u(!1)}},N=(a,e)=>{var l;P(a),$(e);const n=(l=m.current)==null?void 0:l.getFieldsValue();h({...n,page:a,pageSize:e})},A=(a,e)=>w(F,{children:[d.update===!0&&i(H,{className:"mr-5px",isLoading:c,onClick:()=>x(e.id)}),d.delete===!0&&i(J,{className:"mr-5px",isLoading:c,handleDelete:()=>k(e.id)})]});return i(q,{isPermission:d.page,children:w(F,{children:[i(W,{formRef:m,list:ge,data:v,isLoading:c,isCreate:d.create,onCreate:E,handleFinish:D}),i(Y,{loading:c,columns:be(A),dataSource:B}),i(Z,{disabled:c,current:r,pageSize:p,total:T,onChange:N})]})})}const K={content:"<h4>初始化内容</h4>"},_="/content/article";function Ke(){const{pathname:t,search:o}=te(),m=t+o,c=ne(o,"id"),u=s.useRef(null),r=O(),[P,p]=s.useState(!1),[$,T]=s.useState(""),[L,B]=s.useState(K),C=I(e=>e.user.permissions),g=I(e=>e.menu.isCollapsed),S=I(e=>e.menu.isPhone),f="文章管理",d=`${oe}${f}`,D=`${ce(c,f)}`;Q(c?D:d);const h="/content/article",E={create:b(`${h}/create`,C),update:b(`${h}/update`,C)};s.useEffect(()=>{const e=ie(_);!S&&!g&&(r(re(e)),r(le(_)))},[]);const x=s.useCallback((e=t)=>{if(e==="/")return;const n=c?D:d,l={label:n,key:m,nav:["内容管理","文章管理",n]};r(ue(l.key)),r(de(l.nav)),r(me(l))},[c,t,o]);s.useEffect(()=>{x()},[x]),M.useActivate(()=>{x()}),s.useEffect(()=>{c?k(c):R()},[]);const R=()=>{T(""),B(K)},k=async e=>{try{T(e),p(!0);const{data:{data:n}}=await xe(e);B(n)}finally{p(!1)}},N=()=>{var e;(e=u.current)==null||e.handleSubmit()},A=e=>{var n;(n=u.current)==null||n.handleReset(),e&&r(V(!0)),r(pe({key:m,nextPath:_}))},a=async e=>{var n;try{p(!0);const l=()=>$?ye($,e):Ie(e),{data:U}=await l();G.success((U==null?void 0:U.message)||"操作成功"),(n=u.current)==null||n.handleReset(),A(!0)}finally{p(!1)}};return i(q,{isPermission:c?E.update:E.creae,children:w(F,{children:[i("div",{className:"mb-50px",children:i(se,{spinning:P,children:i(fe,{formRef:u,list:Pe,data:L,labelCol:{span:5},handleFinish:a})})}),i(X,{isLoading:P,goBack:()=>A(),handleSubmit:N})]})})}export{je as P,Ke as a,Q as u};
