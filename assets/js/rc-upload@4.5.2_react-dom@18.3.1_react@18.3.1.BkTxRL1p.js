import{c as e,d as t,a as n,b as r,e as a,i as o,_ as i,l as s,j as c,h as l,m as u,n as p,f}from"./@babel_runtime@7.24.7.uphKh7BM.js";import{e as d,r as h}from"./react@18.3.1.zIIbIvjs.js";import{c as v}from"./classnames@2.5.1.Xo58IrnT.js";import{E as m,z as y}from"./rc-util@5.43.0_react-dom@18.3.1_react@18.3.1.bvtOFkwB.js";const b=function(e,t){if(e&&t){var n=Array.isArray(t)?t:t.split(","),r=e.name||"",a=e.type||"",o=a.replace(/\/.*$/,"");return n.some((function(e){var t=e.trim();if(/^\*(\/\*)?$/.test(e))return!0;if("."===t.charAt(0)){var n=r.toLowerCase(),i=t.toLowerCase(),s=[i];return".jpg"!==i&&".jpeg"!==i||(s=[".jpg",".jpeg"]),s.some((function(e){return n.endsWith(e)}))}return/\/\*$/.test(t)?o===t.replace(/\/.*$/,""):a===t||!!/^\w+$/.test(t)&&(m(!1,"Upload takes an invalidate 'accept' type '".concat(t,"'.Skip for check.")),!0)}))}return!0};function k(e){var t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch(n){return t}}function w(e){var t=new XMLHttpRequest;e.onProgress&&t.upload&&(t.upload.onprogress=function(t){t.total>0&&(t.percent=t.loaded/t.total*100),e.onProgress(t)});var n=new FormData;e.data&&Object.keys(e.data).forEach((function(t){var r=e.data[t];Array.isArray(r)?r.forEach((function(e){n.append("".concat(t,"[]"),e)})):n.append(t,r)})),e.file instanceof Blob?n.append(e.filename,e.file,e.file.name):n.append(e.filename,e.file),t.onerror=function(t){e.onError(t)},t.onload=function(){return t.status<200||t.status>=300?e.onError(function(e,t){var n="cannot ".concat(e.method," ").concat(e.action," ").concat(t.status,"'"),r=new Error(n);return r.status=t.status,r.method=e.method,r.url=e.action,r}(e,t),k(t)):e.onSuccess(k(t),t)},t.open(e.method,e.action,!0),e.withCredentials&&"withCredentials"in t&&(t.withCredentials=!0);var r=e.headers||{};return null!==r["X-Requested-With"]&&t.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(r).forEach((function(e){null!==r[e]&&t.setRequestHeader(e,r[e])})),t.send(n),{abort:function(){t.abort()}}}var g=function(e,t,n){var r=function e(r,a){r&&(r.path=a||"",r.isFile?r.file((function(e){n(e)&&(r.fullPath&&!e.webkitRelativePath&&(Object.defineProperties(e,{webkitRelativePath:{writable:!0}}),e.webkitRelativePath=r.fullPath.replace(/^\//,""),Object.defineProperties(e,{webkitRelativePath:{writable:!1}})),t([e]))})):r.isDirectory&&function(e,t){var n=e.createReader(),r=[];!function e(){n.readEntries((function(n){var a=Array.prototype.slice.apply(n);r=r.concat(a),a.length?e():t(r)}))}()}(r,(function(t){t.forEach((function(t){e(t,"".concat(a).concat(r.name,"/"))}))})))};e.forEach((function(e){r(e.webkitGetAsEntry())}))},C=+new Date,F=0;function E(){return"rc-upload-".concat(C,"-").concat(++F)}var x=["component","prefixCls","className","classNames","disabled","id","style","styles","multiple","accept","capture","children","directory","openFileDialogOnClick","onMouseEnter","onMouseLeave","hasControlInside"],D=function(h){e(k,h);var m=t(k);function k(){var e;n(this,k);for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return e=m.call.apply(m,[this].concat(i)),r(a(e),"state",{uid:E()}),r(a(e),"reqs",{}),r(a(e),"fileInput",void 0),r(a(e),"_isMounted",void 0),r(a(e),"onChange",(function(t){var n=e.props,r=n.accept,a=n.directory,i=t.target.files,s=o(i).filter((function(e){return!a||b(e,r)}));e.uploadFiles(s),e.reset()})),r(a(e),"onClick",(function(t){var n=e.fileInput;if(n){var r=t.target,a=e.props.onClick;if(r&&"BUTTON"===r.tagName)n.parentNode.focus(),r.blur();n.click(),a&&a(t)}})),r(a(e),"onKeyDown",(function(t){"Enter"===t.key&&e.onClick(t)})),r(a(e),"onFileDrop",(function(t){var n=e.props.multiple;if(t.preventDefault(),"dragover"!==t.type)if(e.props.directory)g(Array.prototype.slice.call(t.dataTransfer.items),e.uploadFiles,(function(t){return b(t,e.props.accept)}));else{var r=o(t.dataTransfer.files).filter((function(t){return b(t,e.props.accept)}));!1===n&&(r=r.slice(0,1)),e.uploadFiles(r)}})),r(a(e),"uploadFiles",(function(t){var n=o(t),r=n.map((function(t){return t.uid=E(),e.processFile(t,n)}));Promise.all(r).then((function(t){var n=e.props.onBatchStart;null==n||n(t.map((function(e){return{file:e.origin,parsedFile:e.parsedFile}}))),t.filter((function(e){return null!==e.parsedFile})).forEach((function(t){e.post(t)}))}))})),r(a(e),"processFile",function(){var t=u(p().mark((function t(n,r){var a,o,i,s,c,l,u,d,h;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.props.beforeUpload,o=n,!a){t.next=14;break}return t.prev=3,t.next=6,a(n,r);case 6:o=t.sent,t.next=12;break;case 9:t.prev=9,t.t0=t.catch(3),o=!1;case 12:if(!1!==o){t.next=14;break}return t.abrupt("return",{origin:n,parsedFile:null,action:null,data:null});case 14:if("function"!=typeof(i=e.props.action)){t.next=21;break}return t.next=18,i(n);case 18:s=t.sent,t.next=22;break;case 21:s=i;case 22:if("function"!=typeof(c=e.props.data)){t.next=29;break}return t.next=26,c(n);case 26:l=t.sent,t.next=30;break;case 29:l=c;case 30:return u="object"!==f(o)&&"string"!=typeof o||!o?n:o,d=u instanceof File?u:new File([u],n.name,{type:n.type}),(h=d).uid=n.uid,t.abrupt("return",{origin:n,data:l,parsedFile:h,action:s});case 35:case"end":return t.stop()}}),t,null,[[3,9]])})));return function(e,n){return t.apply(this,arguments)}}()),r(a(e),"saveFileInput",(function(t){e.fileInput=t})),e}return i(k,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.abort()}},{key:"post",value:function(e){var t=this,n=e.data,r=e.origin,a=e.action,o=e.parsedFile;if(this._isMounted){var i=this.props,s=i.onStart,c=i.customRequest,l=i.name,u=i.headers,p=i.withCredentials,f=i.method,d=r.uid,h=c||w,v={action:a,filename:l,data:n,file:o,headers:u,withCredentials:p,method:f||"post",onProgress:function(e){var n=t.props.onProgress;null==n||n(e,o)},onSuccess:function(e,n){var r=t.props.onSuccess;null==r||r(e,o,n),delete t.reqs[d]},onError:function(e,n){var r=t.props.onError;null==r||r(e,n,o),delete t.reqs[d]}};s(r),this.reqs[d]=h(v)}}},{key:"reset",value:function(){this.setState({uid:E()})}},{key:"abort",value:function(e){var t=this.reqs;if(e){var n=e.uid?e.uid:e;t[n]&&t[n].abort&&t[n].abort(),delete t[n]}else Object.keys(t).forEach((function(e){t[e]&&t[e].abort&&t[e].abort(),delete t[e]}))}},{key:"render",value:function(){var e,t=this.props,n=t.component,a=t.prefixCls,o=t.className,i=t.classNames,u=void 0===i?{}:i,p=t.disabled,f=t.id,h=t.style,m=t.styles,b=void 0===m?{}:m,k=t.multiple,w=t.accept,g=t.capture,C=t.children,F=t.directory,E=t.openFileDialogOnClick,D=t.onMouseEnter,j=t.onMouseLeave,P=t.hasControlInside,q=s(t,x),M=v((r(e={},a,!0),r(e,"".concat(a,"-disabled"),p),r(e,o,o),e)),R=F?{directory:"directory",webkitdirectory:"webkitdirectory"}:{},O=p?{}:{onClick:E?this.onClick:function(){},onKeyDown:E?this.onKeyDown:function(){},onMouseEnter:D,onMouseLeave:j,onDrop:this.onFileDrop,onDragOver:this.onFileDrop,tabIndex:P?void 0:"0"};return d.createElement(n,c({},O,{className:M,role:P?void 0:"button",style:h}),d.createElement("input",c({},y(q,{aria:!0,data:!0}),{id:f,disabled:p,type:"file",ref:this.saveFileInput,onClick:function(e){return e.stopPropagation()},key:this.state.uid,style:l({display:"none"},b.input),className:u.input,accept:w},R,{multiple:k,onChange:this.onChange},null!=g?{capture:g}:{})),C)}}]),k}(h.Component);function j(){}var P=function(o){e(l,o);var s=t(l);function l(){var e;n(this,l);for(var t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];return e=s.call.apply(s,[this].concat(o)),r(a(e),"uploader",void 0),r(a(e),"saveUploader",(function(t){e.uploader=t})),e}return i(l,[{key:"abort",value:function(e){this.uploader.abort(e)}},{key:"render",value:function(){return d.createElement(D,c({},this.props,{ref:this.saveUploader}))}}]),l}(h.Component);r(P,"defaultProps",{component:"span",prefixCls:"rc-upload",data:{},headers:{},name:"file",multipart:!1,onStart:j,onError:j,onSuccess:j,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0,hasControlInside:!1});export{P as U};
