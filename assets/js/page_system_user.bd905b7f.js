import{r as s,j as n}from"./react.ab566f72.js";import{I as T,S as de,r as y,A as O,c as pe}from"./components_Business.e86afd58.js";import{O as fe}from"./components_Dates.84372df2.js";import{u as he}from"./page_content_article.2e2db743.js";import{c as g}from"./layouts.85ff6a98.js";import{u as ge}from"./components_Fullscreen.481a352b.js";import{U as ye,D as Se}from"./components_Buttons.327385ed.js";import{s as xe,g as be}from"./page_system_menu.0b5d633d.js";import{B as Ce}from"./components_Content.895e60b0.js";import{B as Pe}from"./components_Search.d2aa1755.js";import{B as Ie}from"./components_Modal.5308b120.js";import{B as De}from"./components_Form.27d9c057.js";import{B as je}from"./components_Table.13bbcbdb.js";import{B as _e}from"./components_Pagination.7c5a4ae7.js";import{r as ke,s as Te,B as U,m as w}from"./antd.48274a52.js";function K(a){const{title:o,isVisible:i,treeData:c,checkedKeys:I,onClose:m,onSubmit:D}=a,[l,S]=s.useState(I);s.useEffect(()=>{S(a.checkedKeys)},[a.checkedKeys]);const x=()=>{D(l)},b=n.jsx(U,{type:"primary",onClick:x,children:"提交"}),C=j=>{S(j)};return n.jsx(ke,{open:i,title:o||"权限配置",placement:"right",extra:b,onClose:m,children:n.jsx(Te,{checkable:!0,checkedKeys:l,treeData:c,onCheck:C})})}const We=Object.freeze(Object.defineProperty({__proto__:null,default:K},Symbol.toStringTag,{value:"Module"})),F=[{label:"年龄",name:"age",component:"InputNumber"},{label:"名字",name:"keyword",component:"Input"}],z=a=>[{title:"ID",dataIndex:"id",width:400,fixed:"left"},{title:"用户名",dataIndex:"username",width:400,fixed:"left"},{title:"姓名",dataIndex:"real_name",width:400},{title:"角色",dataIndex:"roles_name",width:400},{title:"手机号",dataIndex:"phone",width:400},{title:"状态",dataIndex:"status",width:200,render:o=>n.jsx("span",{children:o?"开启":"关闭"})},{title:"操作",dataIndex:"operate",width:200,fixed:"right",render:(o,i)=>a(o,i)}],N=[{label:"用户名",name:"username",rules:T,component:"Input"},{label:"姓名",name:"real_name",rules:T,component:"Input"},{label:"角色",name:"roles_name",rules:T,component:"Input"},{label:"状态",name:"status",rules:de,component:"Select",componentProps:{options:fe}}],Xe=Object.freeze(Object.defineProperty({__proto__:null,createList:N,searchList:F,tableColumns:z},Symbol.toStringTag,{value:"Module"}));function we(a){return y.get("/authority/user/index",{params:a})}function Be(a){return y.get(`/authority/user/${a}`)}function Ee(a){return y.post("/authority/user",a)}function Re(a,o){return y.put(`/authority/user/${a}`,o)}function $e(a){return y.delete(`/authority/user/${a}`)}const P={page:1,pageSize:20},L={status:1};function Oe(){he("用户管理");const a=s.useRef(null),o=s.useRef(null),[i,c]=s.useState(!1),[I,m]=s.useState(!1),[D,l]=s.useState(!1),[S,x]=s.useState(O),[b,C]=s.useState(""),[j,B]=s.useState(L),[E,R]=s.useState(P.page),[_,V]=s.useState(P.pageSize),[M,v]=s.useState(0),[A,Q]=s.useState([]),[q,G]=s.useState(""),[H,k]=s.useState(!1),[J,W]=s.useState([]),[X,Y]=s.useState([]),{permissions:p}=ge(),f="/authority/user",u={page:g(`${f}/index`,p),create:g(`${f}/create`,p),update:g(`${f}/update`,p),delete:g(`${f}/delete`,p),permission:g(`${f}/authority`,p)},Z=e=>{R(1),h({page:1,pageSize:_,...e})},h=s.useCallback(async e=>{try{c(!0);const{data:t}=await we(e),{items:r,total:d}=t;v(d),Q(r)}finally{c(!1)}},[]);s.useEffect(()=>{u.page&&h({...P})},[h,u.page]);const ee=async e=>{try{c(!0);const t={userId:e},{data:r}=await be(t),{defaultCheckedKeys:d,treeData:me}=r;G(e),Y(me),W(d),k(!0)}finally{c(!1)}},te=()=>{k(!1)},se=async e=>{try{c(!0);const r=await xe({menuIds:e,userId:q});w.success(r.message||"授权成功"),k(!1)}finally{c(!1)}},ae=()=>{l(!0),x(O),C(""),B(L)},ne=async e=>{try{l(!0),x(pe(e)),C(e),m(!0);const{data:t}=await Be(e);B(t)}finally{m(!1)}},re=()=>{var e;(e=o.current)==null||e.handleSubmit()},oe=()=>{l(!1)},$=()=>{var r;const t={...((r=a.current)==null?void 0:r.getFieldsValue())||{},page:E,pageSize:_};h(t)},ie=async e=>{try{m(!0);const t=()=>b?Re(b,e):Ee(e),{data:r}=await t();w.success((r==null?void 0:r.message)||"操作成功"),l(!1),$()}finally{m(!1)}},ce=async e=>{try{c(!0);const t=await $e(e);(t==null?void 0:t.code)===200&&(w.success((t==null?void 0:t.message)||"删除成功"),$())}finally{c(!1)}},le=(e,t)=>{var d;R(e),V(t);const r=(d=a.current)==null?void 0:d.getFieldsValue();h({...r,page:e,pageSize:t})},ue=(e,t)=>n.jsxs(n.Fragment,{children:[u.permission===!0&&n.jsx(U,{className:"mr-2",loading:i,onClick:()=>ee(t.id),children:"权限"}),u.update===!0&&n.jsx(ye,{className:"mr-5px",isLoading:i,onClick:()=>ne(t.id)}),u.delete===!0&&n.jsx(Se,{className:"mr-5px",isLoading:i,handleDelete:()=>ce(t.id)})]});return n.jsx(Ce,{isPermission:u.page,children:n.jsxs(n.Fragment,{children:[n.jsx(Pe,{formRef:a,list:F,data:P,isLoading:i,isCreate:u.create,onCreate:ae,handleFinish:Z}),n.jsx(je,{loading:i,columns:z(ue),dataSource:A}),n.jsx(_e,{disabled:i,current:E,pageSize:_,total:M,onChange:le}),n.jsx(Ie,{title:S,open:D,confirmLoading:I,onOk:re,onCancel:oe,children:n.jsx(De,{formRef:o,list:N,data:j,labelCol:{span:6},handleFinish:ie})}),n.jsx(K,{isVisible:H,treeData:X,checkedKeys:J,onClose:te,onSubmit:se})]})})}const Ye=Object.freeze(Object.defineProperty({__proto__:null,default:Oe},Symbol.toStringTag,{value:"Module"}));export{We as P,Ye as i,Xe as m};
