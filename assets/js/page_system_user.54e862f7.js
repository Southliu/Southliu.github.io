import{r as s,j as n}from"./react.76efb1e3.js";import{I as w,S as fe,c as S,A as O,e as ge}from"./components_Business.a1f9c3ad.js";import{O as he}from"./components_Dates.361b09a8.js";import{u as ye}from"./page_content_article.60d55226.js";import{c as y}from"./layouts.43869c63.js";import{u as Se}from"./components_Fullscreen.5db0d3c8.js";import{U as be,D as xe}from"./components_Buttons.45a932db.js";import{s as Ce,g as Pe}from"./page_system_menu.b066278d.js";import{B as Ie}from"./components_Content.c71bf899.js";import{B as De}from"./components_Search.4b6e031b.js";import{B as je}from"./components_Modal.5ee02306.js";import{B as _e}from"./components_Form.8f581885.js";import{B as ke}from"./components_Table.7421b869.js";import{B as Te}from"./components_Pagination.29811a9b.js";import{s as we,t as Be,B as U,m as Ee}from"./antd.469ebff6.js";function K(a){const{title:o,isVisible:u,treeData:I,checkedKeys:l,onClose:i,onSubmit:D}=a,[m,b]=s.useState(l);s.useEffect(()=>{b(a.checkedKeys)},[a.checkedKeys]);const p=()=>{D(m)},j=n.jsx(U,{type:"primary",onClick:p,children:"提交"}),x=C=>{b(C)};return n.jsx(we,{open:u,title:o||"权限配置",placement:"right",extra:j,onClose:i,children:n.jsx(Be,{checkable:!0,checkedKeys:m,treeData:I,onCheck:x})})}const Ze=Object.freeze(Object.defineProperty({__proto__:null,default:K},Symbol.toStringTag,{value:"Module"})),F=[{label:"年龄",name:"age",component:"InputNumber"},{label:"名字",name:"keyword",component:"Input"}],z=a=>[{title:"ID",dataIndex:"id",width:400,fixed:"left"},{title:"用户名",dataIndex:"username",width:400,fixed:"left"},{title:"姓名",dataIndex:"real_name",width:400},{title:"角色",dataIndex:"roles_name",width:400},{title:"手机号",dataIndex:"phone",width:400},{title:"状态",dataIndex:"status",width:200,render:o=>n.jsx("span",{children:o?"开启":"关闭"})},{title:"操作",dataIndex:"operate",width:200,fixed:"right",render:(o,u)=>a(o,u)}],V=[{label:"用户名",name:"username",rules:w,component:"Input"},{label:"姓名",name:"real_name",rules:w,component:"Input"},{label:"角色",name:"roles_name",rules:w,component:"Input"},{label:"状态",name:"status",rules:fe,component:"Select",componentProps:{options:he}}],et=Object.freeze(Object.defineProperty({__proto__:null,createList:V,searchList:F,tableColumns:z},Symbol.toStringTag,{value:"Module"}));function Re(a){return S.get("/authority/user/index",{params:a})}function $e(a){return S.get(`/authority/user/${a}`)}function Ne(a){return S.post("/authority/user",a)}function Oe(a,o){return S.put(`/authority/user/${a}`,o)}function Le(a){return S.delete(`/authority/user/${a}`)}const P={page:1,pageSize:20},L={status:1};function Ue(){ye("用户管理");const a=s.useRef(null),o=s.useRef(null),[u,I]=Ee.useMessage(),[l,i]=s.useState(!1),[D,m]=s.useState(!1),[b,p]=s.useState(!1),[j,x]=s.useState(O),[C,B]=s.useState(""),[M,E]=s.useState(L),[R,$]=s.useState(P.page),[_,v]=s.useState(P.pageSize),[A,Q]=s.useState(0),[q,H]=s.useState([]),[G,J]=s.useState(""),[W,k]=s.useState(!1),[X,Y]=s.useState([]),[Z,ee]=s.useState([]),{permissions:f}=Se(),g="/authority/user",d={page:y(`${g}/index`,f),create:y(`${g}/create`,f),update:y(`${g}/update`,f),delete:y(`${g}/delete`,f),permission:y(`${g}/authority`,f)},te=e=>{$(1),h({page:1,pageSize:_,...e})},h=s.useCallback(async e=>{try{i(!0);const{code:t,data:r}=await Re(e);if(Number(t)!==200)return;const{items:c,total:T}=r;Q(T),H(c)}finally{i(!1)}},[]);s.useEffect(()=>{d.page&&h({...P})},[h,d.page]);const se=async e=>{try{i(!0);const t={userId:e},{code:r,data:c}=await Pe(t);if(Number(r)!==200)return;const{defaultCheckedKeys:T,treeData:pe}=c;J(e),ee(pe),Y(T),k(!0)}finally{i(!1)}},ae=()=>{k(!1)},ne=async e=>{try{i(!0);const t={menuIds:e,userId:G},{code:r,message:c}=await Ce(t);if(Number(r)!==200)return;u.success(c||"授权成功"),k(!1)}finally{i(!1)}},re=()=>{p(!0),x(O),B(""),E(L)},oe=async e=>{try{p(!0),x(ge(e)),B(e),m(!0);const{code:t,data:r}=await $e(e);if(Number(t)!==200)return;E(r)}finally{m(!1)}},ie=()=>{var e;(e=o.current)==null||e.handleSubmit()},ce=()=>{p(!1)},N=()=>{var r;const t={...((r=a.current)==null?void 0:r.getFieldsValue())||{},page:R,pageSize:_};h(t)},le=async e=>{try{m(!0);const t=()=>C?Oe(C,e):Ne(e),{code:r,message:c}=await t();if(Number(r)!==200)return;u.success(c||"操作成功"),p(!1),N()}finally{m(!1)}},ue=async e=>{try{i(!0);const{code:t,message:r}=await Le(e);Number(t)===200&&(u.success(r||"删除成功"),N())}finally{i(!1)}},me=(e,t)=>{var c;$(e),v(t);const r=(c=a.current)==null?void 0:c.getFieldsValue();h({...r,page:e,pageSize:t})},de=(e,t)=>n.jsxs(n.Fragment,{children:[d.permission===!0&&n.jsx(U,{className:"mr-2",loading:l,onClick:()=>se(t.id),children:"权限"}),d.update===!0&&n.jsx(be,{className:"mr-5px",isLoading:l,onClick:()=>oe(t.id)}),d.delete===!0&&n.jsx(xe,{className:"mr-5px",isLoading:l,handleDelete:()=>ue(t.id)})]});return n.jsx(Ie,{isPermission:d.page,children:n.jsxs(n.Fragment,{children:[I,n.jsx(De,{formRef:a,list:F,data:P,isLoading:l,isCreate:d.create,onCreate:re,handleFinish:te}),n.jsx(ke,{loading:l,columns:z(de),dataSource:q}),n.jsx(Te,{disabled:l,current:R,pageSize:_,total:A,onChange:me}),n.jsx(je,{title:j,open:b,confirmLoading:D,onOk:ie,onCancel:ce,children:n.jsx(_e,{formRef:o,list:V,data:M,labelCol:{span:6},handleFinish:le})}),n.jsx(K,{isVisible:W,treeData:Z,checkedKeys:X,onClose:ae,onSubmit:ne})]})})}const tt=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"}));export{Ze as P,tt as i,et as m};
