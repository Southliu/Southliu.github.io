import{r as s,j as n}from"./react.402eeaf7.js";import{I as T,S as pe,r as S,A as O,c as fe}from"./components_Business.97a40718.js";import{O as he}from"./components_Dates.ce0ac0d1.js";import{u as ge}from"./page_content_article.b28bf86b.js";import{c as y}from"./layouts.81f68454.js";import{u as ye}from"./components_Fullscreen.dc33051e.js";import{U as Se,D as xe}from"./components_Buttons.72d70265.js";import{s as be,g as Ce}from"./page_system_menu.33230038.js";import{B as Pe}from"./components_Content.6a26484c.js";import{B as Ie}from"./components_Search.00df5fcf.js";import{B as De}from"./components_Modal.4a9be453.js";import{B as je}from"./components_Form.e497ef41.js";import{B as _e}from"./components_Table.240f2427.js";import{B as ke}from"./components_Pagination.752ec5df.js";import{s as Te,t as we,B as U,m as Be}from"./antd.2a715811.js";function K(a){const{title:o,isVisible:l,treeData:I,checkedKeys:c,onClose:i,onSubmit:D}=a,[u,x]=s.useState(c);s.useEffect(()=>{x(a.checkedKeys)},[a.checkedKeys]);const d=()=>{D(u)},j=n.jsx(U,{type:"primary",onClick:d,children:"提交"}),b=C=>{x(C)};return n.jsx(Te,{open:l,title:o||"权限配置",placement:"right",extra:j,onClose:i,children:n.jsx(we,{checkable:!0,checkedKeys:u,treeData:I,onCheck:b})})}const Ye=Object.freeze(Object.defineProperty({__proto__:null,default:K},Symbol.toStringTag,{value:"Module"})),F=[{label:"年龄",name:"age",component:"InputNumber"},{label:"名字",name:"keyword",component:"Input"}],z=a=>[{title:"ID",dataIndex:"id",width:400,fixed:"left"},{title:"用户名",dataIndex:"username",width:400,fixed:"left"},{title:"姓名",dataIndex:"real_name",width:400},{title:"角色",dataIndex:"roles_name",width:400},{title:"手机号",dataIndex:"phone",width:400},{title:"状态",dataIndex:"status",width:200,render:o=>n.jsx("span",{children:o?"开启":"关闭"})},{title:"操作",dataIndex:"operate",width:200,fixed:"right",render:(o,l)=>a(o,l)}],N=[{label:"用户名",name:"username",rules:T,component:"Input"},{label:"姓名",name:"real_name",rules:T,component:"Input"},{label:"角色",name:"roles_name",rules:T,component:"Input"},{label:"状态",name:"status",rules:pe,component:"Select",componentProps:{options:he}}],Ze=Object.freeze(Object.defineProperty({__proto__:null,createList:N,searchList:F,tableColumns:z},Symbol.toStringTag,{value:"Module"}));function Ee(a){return S.get("/authority/user/index",{params:a})}function Re(a){return S.get(`/authority/user/${a}`)}function $e(a){return S.post("/authority/user",a)}function Oe(a,o){return S.put(`/authority/user/${a}`,o)}function Le(a){return S.delete(`/authority/user/${a}`)}const P={page:1,pageSize:20},L={status:1};function Ue(){ge("用户管理");const a=s.useRef(null),o=s.useRef(null),[l,I]=Be.useMessage(),[c,i]=s.useState(!1),[D,u]=s.useState(!1),[x,d]=s.useState(!1),[j,b]=s.useState(O),[C,w]=s.useState(""),[V,B]=s.useState(L),[E,R]=s.useState(P.page),[_,M]=s.useState(P.pageSize),[v,A]=s.useState(0),[Q,q]=s.useState([]),[H,G]=s.useState(""),[J,k]=s.useState(!1),[W,X]=s.useState([]),[Y,Z]=s.useState([]),{permissions:f}=ye(),h="/authority/user",m={page:y(`${h}/index`,f),create:y(`${h}/create`,f),update:y(`${h}/update`,f),delete:y(`${h}/delete`,f),permission:y(`${h}/authority`,f)},ee=e=>{R(1),g({page:1,pageSize:_,...e})},g=s.useCallback(async e=>{try{i(!0);const{data:t}=await Ee(e),{items:r,total:p}=t;A(p),q(r)}finally{i(!1)}},[]);s.useEffect(()=>{m.page&&g({...P})},[g,m.page]);const te=async e=>{try{i(!0);const t={userId:e},{data:r}=await Ce(t),{defaultCheckedKeys:p,treeData:de}=r;G(e),Z(de),X(p),k(!0)}finally{i(!1)}},se=()=>{k(!1)},ae=async e=>{try{i(!0);const r=await be({menuIds:e,userId:H});l.success(r.message||"授权成功"),k(!1)}finally{i(!1)}},ne=()=>{d(!0),b(O),w(""),B(L)},re=async e=>{try{d(!0),b(fe(e)),w(e),u(!0);const{data:t}=await Re(e);B(t)}finally{u(!1)}},oe=()=>{var e;(e=o.current)==null||e.handleSubmit()},ie=()=>{d(!1)},$=()=>{var r;const t={...((r=a.current)==null?void 0:r.getFieldsValue())||{},page:E,pageSize:_};g(t)},ce=async e=>{try{u(!0);const t=()=>C?Oe(C,e):$e(e),{data:r}=await t();l.success((r==null?void 0:r.message)||"操作成功"),d(!1),$()}finally{u(!1)}},le=async e=>{try{i(!0);const t=await Le(e);(t==null?void 0:t.code)===200&&(l.success((t==null?void 0:t.message)||"删除成功"),$())}finally{i(!1)}},ue=(e,t)=>{var p;R(e),M(t);const r=(p=a.current)==null?void 0:p.getFieldsValue();g({...r,page:e,pageSize:t})},me=(e,t)=>n.jsxs(n.Fragment,{children:[m.permission===!0&&n.jsx(U,{className:"mr-2",loading:c,onClick:()=>te(t.id),children:"权限"}),m.update===!0&&n.jsx(Se,{className:"mr-5px",isLoading:c,onClick:()=>re(t.id)}),m.delete===!0&&n.jsx(xe,{className:"mr-5px",isLoading:c,handleDelete:()=>le(t.id)})]});return n.jsx(Pe,{isPermission:m.page,children:n.jsxs(n.Fragment,{children:[I,n.jsx(Ie,{formRef:a,list:F,data:P,isLoading:c,isCreate:m.create,onCreate:ne,handleFinish:ee}),n.jsx(_e,{loading:c,columns:z(me),dataSource:Q}),n.jsx(ke,{disabled:c,current:E,pageSize:_,total:v,onChange:ue}),n.jsx(De,{title:j,open:x,confirmLoading:D,onOk:oe,onCancel:ie,children:n.jsx(je,{formRef:o,list:N,data:V,labelCol:{span:6},handleFinish:ce})}),n.jsx(K,{isVisible:J,treeData:Y,checkedKeys:W,onClose:se,onSubmit:ae})]})})}const et=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"}));export{Ye as P,et as i,Ze as m};
