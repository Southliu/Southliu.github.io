import{b as e,h as n,c as r,e as t,f as a}from"./@babel_runtime.d775819b.js";import{n as u,t as s,g as o,a as i,v as c,b as l}from"./@rc-component_mini-decimal.bd81c0df.js";import{c as f}from"./classnames.71976509.js";import{B as d,t as p}from"./rc-input.8d9b8356.js";import{r as m}from"./react.a7da97a2.js";import{d as v,l as b,G as g,m as N,H as E}from"./rc-util.b2252098.js";function y(r){var t=r.prefixCls,a=r.upNode,u=r.downNode,s=r.upDisabled,o=r.downDisabled,i=r.onStep,c=m.useRef(),l=m.useRef([]),d=m.useRef();d.current=i;var p=function(){clearTimeout(c.current)},v=function(e,n){e.preventDefault(),p(),d.current(n),c.current=setTimeout((function e(){d.current(n),c.current=setTimeout(e,200)}),600)};if(m.useEffect((function(){return function(){p(),l.current.forEach((function(e){return b.cancel(e)}))}}),[]),g())return null;var N="".concat(t,"-handler"),E=f(N,"".concat(N,"-up"),e({},"".concat(N,"-up-disabled"),s)),y=f(N,"".concat(N,"-down"),e({},"".concat(N,"-down-disabled"),o)),w=function(){return l.current.push(b(p))},x={unselectable:"on",role:"button",onMouseUp:w,onMouseLeave:w};return m.createElement("div",{className:"".concat(N,"-wrap")},m.createElement("span",n({},x,{onMouseDown:function(e){v(e,!0)},"aria-label":"Increase Value","aria-disabled":s,className:E}),a||m.createElement("span",{unselectable:"on",className:"".concat(t,"-handler-up-inner")})),m.createElement("span",n({},x,{onMouseDown:function(e){v(e,!1)},"aria-label":"Decrease Value","aria-disabled":o,className:y}),u||m.createElement("span",{unselectable:"on",className:"".concat(t,"-handler-down-inner")})))}function w(e){var n="number"==typeof e?u(e):s(e).fullStr;return n.includes(".")?s(n.replace(/(\d)\.(\d)/g,"$1$2.")).fullStr:e+"0"}var x=["prefixCls","className","style","min","max","step","defaultValue","value","disabled","readOnly","upHandler","downHandler","keyboard","controls","classNames","stringMode","parser","formatter","precision","decimalSeparator","onChange","onInput","onPressEnter","onStep"],S=["disabled","style","prefixCls","value","prefix","suffix","addonBefore","addonAfter","classes","className","classNames"],h=function(e,n){return e||n.isEmpty()?n.toString():n.toNumber()},C=function(e){var n=o(e);return n.isInvalidate()?null:n},I=m.forwardRef((function(s,d){var p,g=s.prefixCls,S=void 0===g?"rc-input-number":g,I=s.className,R=s.style,D=s.min,M=s.max,T=s.step,A=void 0===T?1:T,j=s.defaultValue,k=s.value,q=s.disabled,B=s.readOnly,U=s.upHandler,H=s.downHandler,O=s.keyboard,V=s.controls,W=void 0===V||V,K=s.classNames,P=s.stringMode,F=s.parser,$=s.formatter,_=s.precision,G=s.decimalSeparator,L=s.onChange,Z=s.onInput,z=s.onPressEnter,J=s.onStep,Q=r(s,x),X="".concat(S,"-input"),Y=m.useRef(null),ee=m.useState(!1),ne=t(ee,2),re=ne[0],te=ne[1],ae=m.useRef(!1),ue=m.useRef(!1),se=m.useRef(!1),oe=m.useState((function(){return o(null!=k?k:j)})),ie=t(oe,2),ce=ie[0],le=ie[1];var fe=m.useCallback((function(e,n){if(!n)return _>=0?_:Math.max(i(e),i(A))}),[_,A]),de=m.useCallback((function(e){var n=String(e);if(F)return F(n);var r=n;return G&&(r=r.replace(G,".")),r.replace(/[^\w.-]+/g,"")}),[F,G]),pe=m.useRef(""),me=m.useCallback((function(e,n){if($)return $(e,{userTyping:n,input:String(pe.current)});var r="number"==typeof e?u(e):e;if(!n){var t=fe(r,n);if(c(r)&&(G||t>=0))r=l(r,G||".",t)}return r}),[$,fe,G]),ve=m.useState((function(){var e=null!=j?j:k;return ce.isInvalidate()&&["string","number"].includes(a(e))?Number.isNaN(e)?"":e:me(ce.toString(),!1)})),be=t(ve,2),ge=be[0],Ne=be[1];function Ee(e,n){Ne(me(e.isInvalidate()?e.toString(!1):e.toString(!n),n))}pe.current=ge;var ye,we,xe,Se,he,Ce=m.useMemo((function(){return C(M)}),[M,_]),Ie=m.useMemo((function(){return C(D)}),[D,_]),Re=m.useMemo((function(){return!(!Ce||!ce||ce.isInvalidate())&&Ce.lessEquals(ce)}),[Ce,ce]),De=m.useMemo((function(){return!(!Ie||!ce||ce.isInvalidate())&&ce.lessEquals(Ie)}),[Ie,ce]),Me=(ye=Y.current,we=re,xe=m.useRef(null),[function(){try{var e=ye.selectionStart,n=ye.selectionEnd,r=ye.value,t=r.substring(0,e),a=r.substring(n);xe.current={start:e,end:n,value:r,beforeTxt:t,afterTxt:a}}catch(u){}},function(){if(ye&&xe.current&&we)try{var e=ye.value,n=xe.current,r=n.beforeTxt,t=n.afterTxt,a=n.start,u=e.length;if(e.endsWith(t))u=e.length-xe.current.afterTxt.length;else if(e.startsWith(r))u=r.length;else{var s=r[a-1],o=e.indexOf(s,a-1);-1!==o&&(u=o+1)}ye.setSelectionRange(u,u)}catch(i){v(!1,"Something warning of cursor restore. Please fire issue about this: ".concat(i.message))}}]),Te=t(Me,2),Ae=Te[0],je=Te[1],ke=function(e){return Ce&&!e.lessEquals(Ce)?Ce:Ie&&!Ie.lessEquals(e)?Ie:null},qe=function(e){return!ke(e)},Be=function(e,n){var r,t=e,a=qe(t)||t.isEmpty();if(t.isEmpty()||n||(t=ke(t)||t,a=!0),!B&&!q&&a){var u=t.toString(),s=fe(u,n);return s>=0&&(t=o(l(u,".",s)),qe(t)||(t=o(l(u,".",s,!0)))),t.equals(ce)||(r=t,void 0===k&&le(r),null==L||L(t.isEmpty()?null:h(P,t)),void 0===k&&Ee(t,n)),t}return ce},Ue=(Se=m.useRef(0),he=function(){b.cancel(Se.current)},m.useEffect((function(){return he}),[]),function(e){he(),Se.current=b((function(){e()}))}),He=function e(n){if(Ae(),pe.current=n,Ne(n),!ue.current){var r=de(n),t=o(r);t.isNaN()||Be(t,!0)}null==Z||Z(n),Ue((function(){var r=n;F||(r=n.replace(/ã€‚/g,".")),r!==n&&e(r)}))},Oe=function(e){var n;if(!(e&&Re||!e&&De)){ae.current=!1;var r=o(se.current?w(A):A);e||(r=r.negate());var t=(ce||o(0)).add(r.toString()),a=Be(t,!1);null==J||J(h(P,a),{offset:se.current?w(A):A,type:e?"up":"down"}),null===(n=Y.current)||void 0===n||n.focus()}},Ve=function(e){var n=o(de(ge)),r=n;r=n.isNaN()?Be(ce,e):Be(n,e),void 0!==k?Ee(ce,!1):r.isNaN()||Ee(r,!1)};return E((function(){ce.isInvalidate()||Ee(ce,!1)}),[_]),E((function(){var e=o(k);le(e);var n=o(de(ge));e.equals(n)&&ae.current&&!$||Ee(e,ae.current)}),[k]),E((function(){$&&je()}),[ge]),m.createElement("div",{className:f(S,null==K?void 0:K.input,I,(p={},e(p,"".concat(S,"-focused"),re),e(p,"".concat(S,"-disabled"),q),e(p,"".concat(S,"-readonly"),B),e(p,"".concat(S,"-not-a-number"),ce.isNaN()),e(p,"".concat(S,"-out-of-range"),!ce.isInvalidate()&&!qe(ce)),p)),style:R,onFocus:function(){te(!0)},onBlur:function(){Ve(!1),te(!1),ae.current=!1},onKeyDown:function(e){var n=e.key,r=e.shiftKey;ae.current=!0,se.current=r,"Enter"===n&&(ue.current||(ae.current=!1),Ve(!1),null==z||z(e)),!1!==O&&!ue.current&&["Up","ArrowUp","Down","ArrowDown"].includes(n)&&(Oe("Up"===n||"ArrowUp"===n),e.preventDefault())},onKeyUp:function(){ae.current=!1,se.current=!1},onCompositionStart:function(){ue.current=!0},onCompositionEnd:function(){ue.current=!1,He(Y.current.value)},onBeforeInput:function(){ae.current=!0}},W&&m.createElement(y,{prefixCls:S,upNode:U,downNode:H,upDisabled:Re,downDisabled:De,onStep:Oe}),m.createElement("div",{className:"".concat(X,"-wrap")},m.createElement("input",n({autoComplete:"off",role:"spinbutton","aria-valuemin":D,"aria-valuemax":M,"aria-valuenow":ce.isInvalidate()?null:ce.toString(),step:A},Q,{ref:N(Y,d),className:X,value:ge,onChange:function(e){He(e.target.value)},disabled:q,readOnly:B}))))})),R=m.forwardRef((function(e,t){var a=e.disabled,u=e.style,s=e.prefixCls,o=e.value,i=e.prefix,c=e.suffix,l=e.addonBefore,f=e.addonAfter,v=e.classes,b=e.className,g=e.classNames,E=r(e,S),y=m.useRef(null);return m.createElement(d,{inputElement:m.createElement(I,n({prefixCls:s,disabled:a,classNames:g,ref:N(y,t)},E)),className:b,triggerFocus:function(e){y.current&&p(y.current,e)},prefixCls:s,value:o,disabled:a,style:u,prefix:i,suffix:c,addonAfter:f,addonBefore:l,classes:v,classNames:g,components:{affixWrapper:"div",groupWrapper:"div",wrapper:"div",groupAddon:"div"}})}));R.displayName="InputNumber";export{R as I};
