import{a as C,c as k,q as Te,m as se,b as Me,g as Pe,h as ye,i as be,k as ke,j as Se}from"./@babel_runtime@7.19.0-130d17ca.js";import{r as l}from"./react@18.2.0-9cdefec6.js";import{R as xe}from"./react-dom@18.2.0_react@18.2.0-e0b0c786.js";import{j as we,e as N,a as re,A as De,m as q,D as Ne,n as I,s as Ae,i as Oe,P as Re}from"./rc-util@5.24.4_biqbaboplfbrettd7655fr4n2y-ae37cd3a.js";import{c as F}from"./classnames@2.3.2-d75d9a59.js";import{C as Q}from"./rc-motion@2.6.2_biqbaboplfbrettd7655fr4n2y-091ca629.js";import{j as T,b as le}from"./@ant-design_icons@4.7.0_biqbaboplfbrettd7655fr4n2y-770bcbdb.js";import{R as Ee}from"./rc-align@4.0.12_biqbaboplfbrettd7655fr4n2y-9e701f3c.js";function He(n,p,u){return u?n[0]===p[0]:n[0]===p[0]&&n[1]===p[1]}function Ve(n,p,u){var c=n[p]||{};return C(C({},c),u)}function _e(n,p,u,c){for(var f=u.points,s=Object.keys(n),e=0;e<s.length;e+=1){var i=s[e];if(He(n[i].points,f,c))return"".concat(p,"-placement-").concat(i)}return""}function pe(n){var p=n.prefixCls,u=n.motion,c=n.animation,f=n.transitionName;return u||(c?{motionName:"".concat(p,"-").concat(c)}:f?{motionName:f}:null)}function Le(n){var p=n.prefixCls,u=n.visible,c=n.zIndex,f=n.mask,s=n.maskMotion,e=n.maskAnimation,i=n.maskTransitionName;if(!f)return null;var o={};return(s||i||e)&&(o=C({motionAppear:!0},pe({motion:s,prefixCls:p,transitionName:i,animation:e}))),T(Q,{...o,visible:u,removeOnLeave:!0,children:function(t){var r=t.className;return T("div",{style:{zIndex:c},className:F("".concat(p,"-mask"),r)})}})}var ae=["measure","alignPre","align",null,"motion"];const Ie=function(n,p){var u=we(null),c=k(u,2),f=c[0],s=c[1],e=l.useRef();function i(r){s(r,!0)}function o(){N.cancel(e.current)}function t(r){o(),e.current=N(function(){i(function(d){switch(f){case"align":return"motion";case"motion":return"stable"}return d}),r==null||r()})}return l.useEffect(function(){i("measure")},[n]),l.useEffect(function(){switch(f){case"measure":p();break}f&&(e.current=N(Te(se().mark(function r(){var d,h;return se().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:d=ae.indexOf(f),h=ae[d+1],h&&d!==-1&&i(h);case 3:case"end":return a.stop()}},r)}))))},[f]),l.useEffect(function(){return function(){o()}},[]),[f,t]},Fe=function(n){var p=l.useState({width:0,height:0}),u=k(p,2),c=u[0],f=u[1];function s(i){f({width:i.offsetWidth,height:i.offsetHeight})}var e=l.useMemo(function(){var i={};if(n){var o=c.width,t=c.height;n.indexOf("height")!==-1&&t?i.height=t:n.indexOf("minHeight")!==-1&&t&&(i.minHeight=t),n.indexOf("width")!==-1&&o?i.width=o:n.indexOf("minWidth")!==-1&&o&&(i.minWidth=o)}return i},[n,c]);return[e,s]};var ce=l.forwardRef(function(n,p){var u=n.visible,c=n.prefixCls,f=n.className,s=n.style,e=n.children,i=n.zIndex,o=n.stretch,t=n.destroyPopupOnHide,r=n.forceRender,d=n.align,h=n.point,m=n.getRootDomNode,a=n.getClassNameFromAlign,g=n.onAlign,M=n.onMouseEnter,S=n.onMouseLeave,y=n.onMouseDown,A=n.onTouchStart,O=n.onClick,V=l.useRef(),w=l.useRef(),$=l.useState(),_=k($,2),L=_[0],z=_[1],B=Fe(o),R=k(B,2),j=R[0],U=R[1];function W(){o&&U(m())}var x=Ie(u,W),J=k(x,2),P=J[0],X=J[1],me=l.useState(0),K=k(me,2),Z=K[0],ee=K[1],Y=l.useRef();re(function(){P==="alignPre"&&ee(0)},[P]);function he(){return h||m}function oe(){var v;(v=V.current)===null||v===void 0||v.forceAlign()}function ve(v,b){var D=a(b);L!==D&&z(D),ee(function(H){return H+1}),P==="align"&&(g==null||g(v,b))}re(function(){P==="align"&&(Z<2?oe():X(function(){var v;(v=Y.current)===null||v===void 0||v.call(Y)}))},[Z]);var E=C({},pe(n));["onAppearEnd","onEnterEnd","onLeaveEnd"].forEach(function(v){var b=E[v];E[v]=function(D,H){return X(),b==null?void 0:b(D,H)}});function te(){return new Promise(function(v){Y.current=v})}l.useEffect(function(){!E.motionName&&P==="motion"&&X()},[E.motionName,P]),l.useImperativeHandle(p,function(){return{forceAlign:oe,getElement:function(){return w.current}}});var ge=C(C({},j),{},{zIndex:i,opacity:P==="motion"||P==="stable"||!u?void 0:0,pointerEvents:!u&&P!=="stable"?"none":void 0},s),ie=!0;(d==null?void 0:d.points)&&(P==="align"||P==="stable")&&(ie=!1);var ne=e;return l.Children.count(e)>1&&(ne=T("div",{className:"".concat(c,"-content"),children:e})),T(Q,{visible:u,ref:w,leavedClassName:"".concat(c,"-hidden"),...E,onAppearPrepare:te,onEnterPrepare:te,removeOnLeave:t,forceRender:r,children:function(v,b){var D=v.className,H=v.style,Ce=F(c,f,L,D);return T(Ee,{target:he(),ref:V,monitorWindowResize:!0,disabled:ie,align:d,onAlign:ve,children:T("div",{ref:b,className:Ce,onMouseEnter:M,onMouseLeave:S,onMouseDownCapture:y,onTouchStartCapture:A,onClick:O,style:C(C({},H),ge),children:ne})},"popup")}})});ce.displayName="PopupInner";var fe=l.forwardRef(function(n,p){var u=n.prefixCls,c=n.visible,f=n.zIndex,s=n.children,e=n.mobile;e=e===void 0?{}:e;var i=e.popupClassName,o=e.popupStyle,t=e.popupMotion,r=t===void 0?{}:t,d=e.popupRender,h=n.onClick,m=l.useRef();l.useImperativeHandle(p,function(){return{forceAlign:function(){},getElement:function(){return m.current}}});var a=C({zIndex:f},o),g=s;return l.Children.count(s)>1&&(g=T("div",{className:"".concat(u,"-content"),children:s})),d&&(g=d(g)),T(Q,{visible:c,ref:m,removeOnLeave:!0,...r,children:function(M,S){var y=M.className,A=M.style,O=F(u,i,y);return T("div",{ref:S,className:O,onClick:h,style:C(C({},A),a),children:g})}})});fe.displayName="MobilePopupInner";var $e=["visible","mobile"],de=l.forwardRef(function(n,p){var u=n.visible,c=n.mobile,f=Me(n,$e),s=l.useState(u),e=k(s,2),i=e[0],o=e[1],t=l.useState(!1),r=k(t,2),d=r[0],h=r[1],m=C(C({},f),{},{visible:i});l.useEffect(function(){o(u),u&&c&&h(De())},[u,c]);var a=d?T(fe,{...m,mobile:c,ref:p}):T(ce,{...m,ref:p});return le("div",{children:[T(Le,{...m}),a]})});de.displayName="Popup";var ue=l.createContext(null);function G(){}function ze(){return""}function Be(n){return n?n.ownerDocument:window.document}var je=["onClick","onMouseDown","onTouchStart","onMouseEnter","onMouseLeave","onFocus","onBlur","onContextMenu"];function Ue(n){var p=function(u){Pe(f,u);var c=ye(f);function f(s){var e;be(this,f),e=c.call(this,s),e.popupRef=l.createRef(),e.triggerRef=l.createRef(),e.portalContainer=void 0,e.attachId=void 0,e.clickOutsideHandler=void 0,e.touchOutsideHandler=void 0,e.contextMenuOutsideHandler1=void 0,e.contextMenuOutsideHandler2=void 0,e.mouseDownTimeout=void 0,e.focusTime=void 0,e.preClickTime=void 0,e.preTouchTime=void 0,e.delayTimer=void 0,e.hasPopupMouseDown=void 0,e.onMouseEnter=function(o){var t=e.props.mouseEnterDelay;e.fireEvents("onMouseEnter",o),e.delaySetPopupVisible(!0,t,t?null:o)},e.onMouseMove=function(o){e.fireEvents("onMouseMove",o),e.setPoint(o)},e.onMouseLeave=function(o){e.fireEvents("onMouseLeave",o),e.delaySetPopupVisible(!1,e.props.mouseLeaveDelay)},e.onPopupMouseEnter=function(){e.clearDelayTimer()},e.onPopupMouseLeave=function(o){var t;o.relatedTarget&&!o.relatedTarget.setTimeout&&q((t=e.popupRef.current)===null||t===void 0?void 0:t.getElement(),o.relatedTarget)||e.delaySetPopupVisible(!1,e.props.mouseLeaveDelay)},e.onFocus=function(o){e.fireEvents("onFocus",o),e.clearDelayTimer(),e.isFocusToShow()&&(e.focusTime=Date.now(),e.delaySetPopupVisible(!0,e.props.focusDelay))},e.onMouseDown=function(o){e.fireEvents("onMouseDown",o),e.preClickTime=Date.now()},e.onTouchStart=function(o){e.fireEvents("onTouchStart",o),e.preTouchTime=Date.now()},e.onBlur=function(o){e.fireEvents("onBlur",o),e.clearDelayTimer(),e.isBlurToHide()&&e.delaySetPopupVisible(!1,e.props.blurDelay)},e.onContextMenu=function(o){o.preventDefault(),e.fireEvents("onContextMenu",o),e.setPopupVisible(!0,o)},e.onContextMenuClose=function(){e.isContextMenuToShow()&&e.close()},e.onClick=function(o){if(e.fireEvents("onClick",o),e.focusTime){var t;if(e.preClickTime&&e.preTouchTime?t=Math.min(e.preClickTime,e.preTouchTime):e.preClickTime?t=e.preClickTime:e.preTouchTime&&(t=e.preTouchTime),Math.abs(t-e.focusTime)<20)return;e.focusTime=0}e.preClickTime=0,e.preTouchTime=0,e.isClickToShow()&&(e.isClickToHide()||e.isBlurToHide())&&o&&o.preventDefault&&o.preventDefault();var r=!e.state.popupVisible;(e.isClickToHide()&&!r||r&&e.isClickToShow())&&e.setPopupVisible(!e.state.popupVisible,o)},e.onPopupMouseDown=function(){if(e.hasPopupMouseDown=!0,clearTimeout(e.mouseDownTimeout),e.mouseDownTimeout=window.setTimeout(function(){e.hasPopupMouseDown=!1},0),e.context){var o;(o=e.context).onPopupMouseDown.apply(o,arguments)}},e.onDocumentClick=function(o){if(!(e.props.mask&&!e.props.maskClosable)){var t=o.target,r=e.getRootDomNode(),d=e.getPopupDomNode();(!q(r,t)||e.isContextMenuOnly())&&!q(d,t)&&!e.hasPopupMouseDown&&e.close()}},e.getRootDomNode=function(){var o=e.props.getTriggerDOMNode;if(o)return o(e.triggerRef.current);try{var t=Ne(e.triggerRef.current);if(t)return t}catch{}return xe.findDOMNode(ke(e))},e.getPopupClassNameFromAlign=function(o){var t=[],r=e.props,d=r.popupPlacement,h=r.builtinPlacements,m=r.prefixCls,a=r.alignPoint,g=r.getPopupClassNameFromAlign;return d&&h&&t.push(_e(h,m,o,a)),g&&t.push(g(o)),t.join(" ")},e.getComponent=function(){var o=e.props,t=o.prefixCls,r=o.destroyPopupOnHide,d=o.popupClassName,h=o.onPopupAlign,m=o.popupMotion,a=o.popupAnimation,g=o.popupTransitionName,M=o.popupStyle,S=o.mask,y=o.maskAnimation,A=o.maskTransitionName,O=o.maskMotion,V=o.zIndex,w=o.popup,$=o.stretch,_=o.alignPoint,L=o.mobile,z=o.forceRender,B=o.onPopupClick,R=e.state,j=R.popupVisible,U=R.point,W=e.getPopupAlign(),x={};return e.isMouseEnterToShow()&&(x.onMouseEnter=e.onPopupMouseEnter),e.isMouseLeaveToHide()&&(x.onMouseLeave=e.onPopupMouseLeave),x.onMouseDown=e.onPopupMouseDown,x.onTouchStart=e.onPopupMouseDown,T(de,{prefixCls:t,destroyPopupOnHide:r,visible:j,point:_&&U,className:d,align:W,onAlign:h,animation:a,getClassNameFromAlign:e.getPopupClassNameFromAlign,...x,stretch:$,getRootDomNode:e.getRootDomNode,style:M,mask:S,zIndex:V,transitionName:g,maskAnimation:y,maskTransitionName:A,maskMotion:O,ref:e.popupRef,motion:m,mobile:L,forceRender:z,onClick:B,children:typeof w=="function"?w():w})},e.attachParent=function(o){N.cancel(e.attachId);var t=e.props,r=t.getPopupContainer,d=t.getDocument,h=e.getRootDomNode(),m;r?(h||r.length===0)&&(m=r(h)):m=d(e.getRootDomNode()).body,m?m.appendChild(o):e.attachId=N(function(){e.attachParent(o)})},e.getContainer=function(){if(!e.portalContainer){var o=e.props.getDocument,t=o(e.getRootDomNode()).createElement("div");t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",e.portalContainer=t}return e.attachParent(e.portalContainer),e.portalContainer},e.setPoint=function(o){var t=e.props.alignPoint;!t||!o||e.setState({point:{pageX:o.pageX,pageY:o.pageY}})},e.handlePortalUpdate=function(){e.state.prevPopupVisible!==e.state.popupVisible&&e.props.afterPopupVisibleChange(e.state.popupVisible)},e.triggerContextValue={onPopupMouseDown:e.onPopupMouseDown};var i;return"popupVisible"in s?i=!!s.popupVisible:i=!!s.defaultPopupVisible,e.state={prevPopupVisible:i,popupVisible:i},je.forEach(function(o){e["fire".concat(o)]=function(t){e.fireEvents(o,t)}}),e}return Se(f,[{key:"componentDidMount",value:function(){this.componentDidUpdate()}},{key:"componentDidUpdate",value:function(){var e=this.props,i=this.state;if(i.popupVisible){var o;!this.clickOutsideHandler&&(this.isClickToHide()||this.isContextMenuToShow())&&(o=e.getDocument(this.getRootDomNode()),this.clickOutsideHandler=I(o,"mousedown",this.onDocumentClick)),this.touchOutsideHandler||(o=o||e.getDocument(this.getRootDomNode()),this.touchOutsideHandler=I(o,"touchstart",this.onDocumentClick)),!this.contextMenuOutsideHandler1&&this.isContextMenuToShow()&&(o=o||e.getDocument(this.getRootDomNode()),this.contextMenuOutsideHandler1=I(o,"scroll",this.onContextMenuClose)),!this.contextMenuOutsideHandler2&&this.isContextMenuToShow()&&(this.contextMenuOutsideHandler2=I(window,"blur",this.onContextMenuClose));return}this.clearOutsideHandler()}},{key:"componentWillUnmount",value:function(){this.clearDelayTimer(),this.clearOutsideHandler(),clearTimeout(this.mouseDownTimeout),N.cancel(this.attachId)}},{key:"getPopupDomNode",value:function(){var e;return((e=this.popupRef.current)===null||e===void 0?void 0:e.getElement())||null}},{key:"getPopupAlign",value:function(){var e=this.props,i=e.popupPlacement,o=e.popupAlign,t=e.builtinPlacements;return i&&t?Ve(t,i,o):o}},{key:"setPopupVisible",value:function(e,i){var o=this.props.alignPoint,t=this.state.popupVisible;this.clearDelayTimer(),t!==e&&("popupVisible"in this.props||this.setState({popupVisible:e,prevPopupVisible:t}),this.props.onPopupVisibleChange(e)),o&&i&&e&&this.setPoint(i)}},{key:"delaySetPopupVisible",value:function(e,i,o){var t=this,r=i*1e3;if(this.clearDelayTimer(),r){var d=o?{pageX:o.pageX,pageY:o.pageY}:null;this.delayTimer=window.setTimeout(function(){t.setPopupVisible(e,d),t.clearDelayTimer()},r)}else this.setPopupVisible(e,o)}},{key:"clearDelayTimer",value:function(){this.delayTimer&&(clearTimeout(this.delayTimer),this.delayTimer=null)}},{key:"clearOutsideHandler",value:function(){this.clickOutsideHandler&&(this.clickOutsideHandler.remove(),this.clickOutsideHandler=null),this.contextMenuOutsideHandler1&&(this.contextMenuOutsideHandler1.remove(),this.contextMenuOutsideHandler1=null),this.contextMenuOutsideHandler2&&(this.contextMenuOutsideHandler2.remove(),this.contextMenuOutsideHandler2=null),this.touchOutsideHandler&&(this.touchOutsideHandler.remove(),this.touchOutsideHandler=null)}},{key:"createTwoChains",value:function(e){var i=this.props.children.props,o=this.props;return i[e]&&o[e]?this["fire".concat(e)]:i[e]||o[e]}},{key:"isClickToShow",value:function(){var e=this.props,i=e.action,o=e.showAction;return i.indexOf("click")!==-1||o.indexOf("click")!==-1}},{key:"isContextMenuOnly",value:function(){var e=this.props.action;return e==="contextMenu"||e.length===1&&e[0]==="contextMenu"}},{key:"isContextMenuToShow",value:function(){var e=this.props,i=e.action,o=e.showAction;return i.indexOf("contextMenu")!==-1||o.indexOf("contextMenu")!==-1}},{key:"isClickToHide",value:function(){var e=this.props,i=e.action,o=e.hideAction;return i.indexOf("click")!==-1||o.indexOf("click")!==-1}},{key:"isMouseEnterToShow",value:function(){var e=this.props,i=e.action,o=e.showAction;return i.indexOf("hover")!==-1||o.indexOf("mouseEnter")!==-1}},{key:"isMouseLeaveToHide",value:function(){var e=this.props,i=e.action,o=e.hideAction;return i.indexOf("hover")!==-1||o.indexOf("mouseLeave")!==-1}},{key:"isFocusToShow",value:function(){var e=this.props,i=e.action,o=e.showAction;return i.indexOf("focus")!==-1||o.indexOf("focus")!==-1}},{key:"isBlurToHide",value:function(){var e=this.props,i=e.action,o=e.hideAction;return i.indexOf("focus")!==-1||o.indexOf("blur")!==-1}},{key:"forcePopupAlign",value:function(){if(this.state.popupVisible){var e;(e=this.popupRef.current)===null||e===void 0||e.forceAlign()}}},{key:"fireEvents",value:function(e,i){var o=this.props.children.props[e];o&&o(i);var t=this.props[e];t&&t(i)}},{key:"close",value:function(){this.setPopupVisible(!1)}},{key:"render",value:function(){var e=this.state.popupVisible,i=this.props,o=i.children,t=i.forceRender,r=i.alignPoint,d=i.className,h=i.autoDestroy,m=l.Children.only(o),a={key:"trigger"};this.isContextMenuToShow()?a.onContextMenu=this.onContextMenu:a.onContextMenu=this.createTwoChains("onContextMenu"),this.isClickToHide()||this.isClickToShow()?(a.onClick=this.onClick,a.onMouseDown=this.onMouseDown,a.onTouchStart=this.onTouchStart):(a.onClick=this.createTwoChains("onClick"),a.onMouseDown=this.createTwoChains("onMouseDown"),a.onTouchStart=this.createTwoChains("onTouchStart")),this.isMouseEnterToShow()?(a.onMouseEnter=this.onMouseEnter,r&&(a.onMouseMove=this.onMouseMove)):a.onMouseEnter=this.createTwoChains("onMouseEnter"),this.isMouseLeaveToHide()?a.onMouseLeave=this.onMouseLeave:a.onMouseLeave=this.createTwoChains("onMouseLeave"),this.isFocusToShow()||this.isBlurToHide()?(a.onFocus=this.onFocus,a.onBlur=this.onBlur):(a.onFocus=this.createTwoChains("onFocus"),a.onBlur=this.createTwoChains("onBlur"));var g=F(m&&m.props&&m.props.className,d);g&&(a.className=g);var M=C({},a);Ae(m)&&(M.ref=Oe(this.triggerRef,m.ref));var S=l.cloneElement(m,M),y;return(e||this.popupRef.current||t)&&(y=T(n,{getContainer:this.getContainer,didUpdate:this.handlePortalUpdate,children:this.getComponent()},"portal")),!e&&h&&(y=null),le(ue.Provider,{value:this.triggerContextValue,children:[S,y]})}}],[{key:"getDerivedStateFromProps",value:function(e,i){var o=e.popupVisible,t={};return o!==void 0&&i.popupVisible!==o&&(t.popupVisible=o,t.prevPopupVisible=i.popupVisible),t}}]),f}(l.Component);return p.contextType=ue,p.defaultProps={prefixCls:"rc-trigger-popup",getPopupClassNameFromAlign:ze,getDocument:Be,onPopupVisibleChange:G,afterPopupVisibleChange:G,onPopupAlign:G,popupClassName:"",mouseEnterDelay:0,mouseLeaveDelay:.1,focusDelay:0,blurDelay:.15,popupStyle:{},destroyPopupOnHide:!1,popupAlign:{},defaultPopupVisible:!1,mask:!1,maskClosable:!0,action:[],showAction:[],hideAction:[],autoDestroy:!1},p}const Ze=Ue(Re);export{Ze as T};
