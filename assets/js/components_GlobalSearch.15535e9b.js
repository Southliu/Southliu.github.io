import{j as o,r as x}from"./react.e58b2294.js";import{I as m}from"./@iconify_react.fa3c46fd.js";import{u as q}from"./ahooks.251fad70.js";import{u as L,a as R}from"./react-redux.72b6d945.js";import{c as C}from"./@reduxjs_toolkit.c56278b4.js";import{u as T}from"./react-router.d965eaa6.js";import{M as H,I as Q,T as W}from"./antd.2930504f.js";const X=[{label:"系统管理",key:"system",icon:"ion:settings-outline",children:[{label:"用户管理",key:"/system/user",rule:"/authority/user"},{label:"菜单管理",key:"/system/menu",rule:"/authority/menu"}]}],Y=[{label:"组件",key:"demo",icon:"fluent:box-20-regular",children:[{label:"剪切板",key:"/demo/copy",rule:"/demo/copy"},{label:"水印",key:"/demo/watermark",rule:"/demo/watermark"},{label:"虚拟滚动",key:"/demo/virtualScroll",rule:"/demo/virtualScroll"},{label:"富文本",key:"/demo/editor",rule:"/demo/editor"},{label:"层级1",key:"/demo/level1",children:[{label:"层级2",key:"/demo/level1/level2",children:[{label:"层级3",key:"/demo/level1/level2/level3",rule:"/demo/watermark"}]}]}]}],Z=[{label:"内容管理",key:"content",icon:"majesticons:article-search-line",children:[{label:"文章管理",key:"/content/article",rule:"/content/article"}]}],S=[{label:"仪表盘",key:"dashboard",icon:"la:tachometer-alt",children:[{label:"数据总览",key:"/dashboard",rule:"/dashboard"}]},...Y,...X,...Z];function E(s){const e=j(s),n=[];if(e.length>0&&n.push(e[0]),e.length>2){let l="/"+e[0];for(let t=1;t<e.length-1;t++)l+="/"+e[t],n.push(l)}return n}function V(s,e){const n=[],l=j(s);let t=0;const c=l.length;for(let a=0;a<e.length;a++){const{path:r}=e[a];if((r==null?void 0:r[t])===l[t]&&(n.push(e[a].label),t<c-1&&t++),t===c)return n}return n}function j(s){if(!s||typeof s!="string")return[];const e=(s==null?void 0:s.split("/"))||[];return(e==null?void 0:e[0])===""&&e.shift(),e}function D(s){var a,r;const{menus:e,permissions:n,value:l}=s;let{currentPath:t,result:c}=s;if(!(e!=null&&e.length)||!l)return[];t||(t=[]),c||(c=[]);for(let i=0;i<e.length;i++)if(v(e[i])){t.push({label:e[i].label,path:j(e[i].key)});const u={menus:e[i].children,permissions:n,value:l,currentPath:t,result:c},d=D(u);d.length?c.concat(d):t.pop()}else if((r=(a=e[i])==null?void 0:a.label)!=null&&r.includes(l)&&K(e[i],n)){t.push({label:e[i].label,path:j(e[i].key)});const u=V(e[i].key,t),{label:d,key:p}=e[i];c.push({label:d,key:p,nav:u})}return c}function P(s){var a;const{menus:e,permissions:n,key:l}=s;let{fatherNav:t,result:c}=s;if(!(e!=null&&e.length))return c;t||(t=[]),c!=null&&c.key||(c={key:"",label:"",nav:[]});for(let r=0;r<e.length;r++){if(!l||c.key)return c;if(v(e[r])){t.push(e[r].label);const i={menus:e[r].children,permissions:n,key:l,fatherNav:t,result:c},u=P(i);u!=null&&u.key?c=u:t.pop()}else if(((a=e[r])==null?void 0:a.key)===l&&K(e[r],n)){t.push(e[r].label);const{label:i,key:u}=e[r];u&&(c={label:i,key:u,nav:t})}}return c}function ee(s,e){const n=[],l=JSON.parse(JSON.stringify(s));for(let t=0;t<l.length;t++){if(v(l[t])){const c=ee(l[t].children,e);l[t].children=c!=null&&c.length?c:void 0}(K(l[t],e)||v(l[t]))&&n.push(l[t])}return n}function ne(s,e,n=""){if(n)return n;for(let l=0;l<s.length;l++){if(v(s[l])&&!n){const t=ne(s[l].children,e,n);if(t)return n=t,n}K(s[l],e)&&!v(s[l])&&(n=s[l].key)}return n}function K(s,e){return e==null?void 0:e.includes((s==null?void 0:s.rule)||"")}function v(s){var e;return!!((e=s.children)!=null&&e.length)}const I=C({name:"tabs",initialState:{isLock:!1,isMaximize:!1,activeKey:"",nav:[],tabs:[]},reducers:{toggleLock:(s,e)=>{s.isLock=!!e.payload},toggleMaximize:(s,e)=>{s.isMaximize=!!e.payload},setActiveKey:(s,e)=>{s.activeKey=e.payload},setNav:(s,e)=>{s.nav=e.payload},addTabs:(s,e)=>{const{tabs:n}=s,{payload:l}=e;n.find(c=>c.key===l.key)||n.push(l),n!=null&&n.length&&(n[0].closable=(n==null?void 0:n.length)>1)},closeTabs:(s,e)=>{var c;const{tabs:n}=s,{payload:l}=e,t=n.findIndex(a=>a.key===l);if(t>=0&&n.splice(t,1),l===s.activeKey){let a="";t===0?a=((c=n==null?void 0:n[t])==null?void 0:c.key)||"":a=n[t-1].key,s.activeKey=a,s.isLock=!0}n!=null&&n.length&&(n[0].closable=(n==null?void 0:n.length)>1)},closeTabGoNext:(s,e)=>{const{tabs:n}=s,{payload:l}=e,{key:t,nextPath:c}=l,a=n.findIndex(r=>r.key===t);a>=0&&n.splice(a,1),t===s.activeKey&&(s.activeKey=c,s.isLock=!0),n!=null&&n.length&&(n[0].closable=(n==null?void 0:n.length)>1)},closeLeft:(s,e)=>{const{tabs:n}=s,{payload:l}=e,t=n.findIndex(c=>c.key===l);t>=0&&n.splice(0,t),s.activeKey=n[0].key,n!=null&&n.length&&(n[0].closable=(n==null?void 0:n.length)>1)},closeRight:(s,e)=>{const{tabs:n}=s,{payload:l}=e,t=n.findIndex(c=>c.key===l);t>=0&&n.splice(t+1,n.length-t-1),s.activeKey=n[n.length-1].key,n!=null&&n.length&&(n[0].closable=(n==null?void 0:n.length)>1)},closeOther:(s,e)=>{const{tabs:n}=s,{payload:l}=e,t=n.find(c=>c.key===l);t&&(s.tabs=[t],s.activeKey=t.key,s.isLock=!0),n[0].closable=!1},closeAllTab:s=>{s.tabs=[]}}}),{toggleLock:ye,toggleMaximize:xe,setActiveKey:O,setNav:me,addTabs:B,closeTabs:pe,closeTabGoNext:ge,closeLeft:ke,closeRight:ve,closeOther:be,closeAllTab:we}=I.actions,je=I.reducer,F=C({name:"menu",initialState:{isPhone:!1,isCollapsed:!1,selectedKeys:"dashboard",openKeys:["Dashboard"]},reducers:{toggleCollapsed:(s,e)=>{s.isCollapsed=!!e.payload},togglePhone:(s,e)=>{s.isPhone=!!e.payload},setSelectedKeys:(s,e)=>{s.selectedKeys=e.payload},setOpenKeys:(s,e)=>{s.openKeys=e.payload}}}),{toggleCollapsed:Ke,togglePhone:Ne,setSelectedKeys:Ae,setOpenKeys:$}=F.actions,Se=F.reducer;function se(s){return[n=>{var l,t,c,a,r;switch(n.key){case"ArrowUp":(l=s.ArrowUp)==null||l.call(s);break;case"ArrowDown":(t=s.ArrowDown)==null||t.call(s);break;case"ArrowLeft":(c=s.ArrowLeft)==null||c.call(s);break;case"ArrowRight":(a=s.ArrowRight)==null||a.call(s);break;case"Enter":(r=s.Enter)==null||r.call(s);break}}]}function te(s){const{list:e,active:n,onCancel:l,changActive:t}=s,c=T(),a=L(),r=R(d=>d.user.permissions),i=d=>{c(d);const g=P({menus:S,permissions:r,key:d});a(B(g)),a(O(d));const k=E(d);a($(k)),l()},u=d=>{t(d)};return o.jsxs(o.Fragment,{children:[!(e!=null&&e.length)&&o.jsxs("div",{className:"flex flex-col items-center pt-5 text-warm-gray-400",children:[o.jsx(m,{className:"text-40px",icon:"mdi:archive-cancel-outline"}),o.jsx("span",{className:"mt-1",children:"暂无搜索结构"})]}),(e==null?void 0:e.length)>0&&o.jsx("div",{className:"mt-5",children:e==null?void 0:e.map(d=>{var p;return o.jsxs("div",{className:`
                h-56px
                mt-8px
                px-14px
                rounded-4px
                cursor-pointer
                flex
                items-center
                justify-between
                shadow-md
                border
                border-light-500
                ${n===d.key?"bg-blue-500 text-white":""}
              `,onClick:()=>i(d.key),onMouseEnter:()=>u(d.key),children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx(m,{className:"text-lg mr-1",icon:"gg:menu-boxed"}),d.nav&&((p=d.nav)==null?void 0:p.length)>0&&d.nav.map((g,k)=>o.jsxs(x.Fragment,{children:[k>0&&o.jsx("span",{className:"mx-5px",children:">"}),o.jsx("span",{children:g})]},g)),!d.nav&&o.jsx("span",{children:d.label})]}),o.jsx(m,{className:"icon text-20px p-2px mr-5px",icon:"ant-design:enter-outlined"})]},d.key)})})]})}const le="_icon_1eshe_1",w={icon:le};function ce(){return o.jsxs("div",{className:"flex items-center text-dark-50",children:[o.jsxs("span",{className:"mr-14px flex items-center",children:[o.jsx(m,{className:`${w.icon} text-20px p-2px mr-5px`,icon:"ant-design:enter-outlined"}),o.jsx("span",{children:"确认"})]}),o.jsxs("span",{className:"mr-14px flex items-center",children:[o.jsx(m,{className:`${w.icon} text-20px p-2px mr-5px`,icon:"mdi-arrow-up-thin"}),o.jsx(m,{className:`${w.icon} text-20px p-2px mr-5px`,icon:"mdi-arrow-down-thin"}),o.jsx("span",{children:"切换"})]}),o.jsxs("span",{className:"flex items-center",children:[o.jsx(m,{className:`${w.icon} text-20px p-2px mr-5px`,icon:"mdi:keyboard-esc"}),o.jsx("span",{children:"关闭"})]})]})}function ae(s){const e=T(),n=x.useRef(null),{modalRef:l}=s,[t,c]=x.useState(""),[a,r]=x.useState(""),[i,u]=x.useState([]),[d,p]=x.useState(!1),g=L(),k=R(h=>h.user.permissions);x.useImperativeHandle(l,()=>({toggle:()=>{p(!d)}})),x.useLayoutEffect(()=>(d&&setTimeout(()=>{var h;(h=n.current)==null||h.focus({cursor:"end"})},0),()=>{c(""),r(""),u([])}),[d]);const z=h=>{r(h)},N=()=>{p(!1)},M=()=>{if(a){e(a);const y=P({menus:S,permissions:k,key:a});g(B(y)),g(O(a));const f=E(a);g($(f)),N()}},G=q(h=>{var b;const f=D({menus:S,permissions:k,value:h});f!=null&&f.length?(r(((b=f==null?void 0:f[0])==null?void 0:b.key)||""),u(f)):(r(""),u([]))},{wait:200}),U=h=>{const{value:y}=h.target;c(y),G.run(y)},_=()=>{if(!i.length)return null;const h=i.findIndex(f=>f.key===a);if(h===0)return null;const y=i[h-1].key;r(y)},J=()=>{if(!i.length)return null;const h=i.length-1,y=i.findIndex(b=>b.key===a);if(y===h)return null;const f=i[y+1].key;r(f)},[A]=se({ArrowUp:_,ArrowDown:J,Enter:M});return x.useEffect(()=>{if(i.length)return window.addEventListener("keydown",A),()=>{window.removeEventListener("keydown",A)}},[i,a,A]),o.jsxs(H,{className:"rounded-100px",open:d,closable:!1,onCancel:N,footer:o.jsx(ce,{}),children:[o.jsx(Q,{ref:n,value:t,placeholder:"请输入关键词搜索",allowClear:!0,prefix:o.jsx(m,{className:"text-lg text-warm-gray-400",icon:"ant-design:search-outlined"}),onChange:U,onPressEnter:M}),o.jsx(te,{list:i,active:a,onCancel:N,changActive:z})]})}function Pe(){const s=x.useRef(null),e=()=>{var n;(n=s.current)==null||n.toggle()};return o.jsxs(o.Fragment,{children:[o.jsx(W,{title:"搜索",children:o.jsx(m,{className:"flex items-center justify-center text-lg mr-3 cursor-pointer",icon:"uil-search",onClick:e})}),o.jsx(ae,{modalRef:s})]})}export{Pe as G,Ae as a,j as b,ne as c,S as d,P as e,ee as f,E as g,O as h,me as i,B as j,we as k,ve as l,ke as m,be as n,pe as o,xe as p,ye as q,Ne as r,$ as s,Ke as t,ge as u,Se as v,je as w};
